(()=>{var t={609:()=>{String.prototype.hashcode||(String.prototype.hashcode=function(){if(0===this.length)return 0;let t=0;const e=this.length;for(let n=0;n<e;n++){t=(t<<5)-t+this.charCodeAt(n),t|=0}return t})}},e={};function n(a){var i=e[a];if(void 0!==i)return i.exports;var r=e[a]={exports:{}};return t[a](r,r.exports,n),r.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{"use strict";const t="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{},e=t.fetch,a=t.location.origin;const i=new class{#t={};#e={};#n={};#a=!1;#i=[];#r=[];#s;constructor(){}set ignoreDocumentOrigin(t){this.#a=t}addOriginToIgnore(t){if(t instanceof Array)for(let e of t)this.#n[e.toString()]=!0;else this.#n[t.toString()]=!0}addUrlToIgnore(t){if(t instanceof Array)for(let e of t)this.#e[e.toString()]=!0;else this.#e[t.toString()]=!0}setup(t){("function"==typeof t||t instanceof Promise)&&this.#r.push(t)}addInterceptor(t){if(t instanceof Array)return t.forEach((t=>this.addInterceptor(t)));if("object"!=typeof t)throw new Error("function required an interceptor");if("function"!=typeof t.doAccept)throw new Error('The interceptor required a "doAccept" function!');if("function"!=typeof t.doHandle)throw new Error('The interceptor required a "doHandle" function!');this.#i.push(t),this.reset()}get ready(){return(async()=>0==this.#r.length||(this.#s||(this.#s=(async()=>{for(;0!=this.#r.length;){const t=this.#r[0];if(t){const e=t instanceof Promise?await t:await t();e&&(e instanceof Array?e.forEach((t=>this.addInterceptor(t))):this.addInterceptor(e))}this.#r.shift()}return this.#s=null,this.ready})()),this.#s))()}async doIntercept(t){await this.ready;const e=t.metadata.origin;if(this.#o(e,t.url.toString()))return t;const{url:n,metadata:a}=t,i=await this.#c(e,{url:n,metadata:a});if(!i)return t;for(let e of i)t=await e.doHandle(t);return t}reset(){this.#t={}}async uncheckedFetch(t,n){return e(t,n)}#o(t,e){return!!this.#e[e]||(!(!this.#a||t!=a)||!!this.#n[t])}async#c(t,e){let n=this.#t[t];return n||(n=this.#l(t,e),this.#t[t]=n),n}async#l(t,e){const n=[];for(let t of this.#i)await t.doAccept(e)&&n.push(t);return n}};setTimeout((()=>i.ready),10);const r=i;if(void 0!==t.XMLHttpRequest){const e=t.XMLHttpRequest,n=function(t){e.prototype.open.call(this,t.request.method,t.url,t.metadata.async,t.metadata.username,t.metadata.password),void 0!==t.request.headers&&Object.getOwnPropertyNames(t.request.headers).forEach((n=>{e.prototype.setRequestHeader.call(this,n,t.request.headers[n])})),e.prototype.send.call(this,t.request.body)},a=function(){const a=new e(arguments);let i;return a.setRequestHeader=function(t,e){i.request.headers=i.request.headers||{},i.request.headers[t]=e},a.open=function(e,n,a,r,s){const o=new URL(n,t.location.origin);i={url:new URL(n,location),request:{method:e},metadata:{method:e,origin:o.origin,protocol:o.protocol,hostname:o.hostname,port:o.port,path:o.pathname,query:o.search,hash:o.hash,async:"boolean"!=typeof a||a,username:r,password:s}}},a.send=function(t){i.metadata.async?(i.request.body=t,r.doIntercept(i).then(n.bind(a)).catch(console.error)):n.call(a,i)},a};t.XMLHttpRequest=a,t.XMLHttpRequest.prototype=e.prototype,t.XMLHttpRequest.prototype.constructor=a}t.fetch=async function(n,a){const i=new URL(n,t.location),s=await r.doIntercept({url:new URL(n,location),request:a||{},metadata:{method:void 0===a?"GET":a.method||"GET",origin:i.origin,protocol:i.protocol,hostname:i.hostname,port:i.port,path:i.pathname,hash:i.hash,query:i.search,async:!0}});return e(s.url,s.request)};class s{async doAccept(t){}async doHandle(t){}async unceckedFetch(t,n){return e(t,n)}}const o=async(t,e)=>(e.request.headers=e.request.headers||{},e.request.headers.Authorization=`Bearer ${t}`,e);class c extends s{#u=null;#h={};#d;#p;#f;#g;#m;constructor({condition:t,fetchToken:e,appendToken:n,refreshInterval:a=6e4,refreshToken:i}){if(super(),"string"!=typeof t&&!(t instanceof Array)&&"function"!=typeof t)throw new Error('Parameter "condition" must be a "string", "array" or "function"!');if(this.#d=t,"function"!=typeof e)throw new Error('Parameter "fetchToken" must be a "function"!');if(this.#p=e,n&&"function"!=typeof n)throw new Error('Parameter "appendToken" must be a "function"!');this.#f=n||o,this.#g=a,this.#m=i}async doAccept(t){const e=typeof this.#d,n=this.#d,a=t.metadata.origin;return"function"===e?await n(t):"string"===e?n==a:n instanceof Array&&n.includes(a)}async doHandle(t){if(!this.#u){const{url:e,metadata:n}=t;this.#h={url:e,metadata:n},this.#u=this.#p({url:e,metadata:n}),this.#y()}return this.#w(t)}async#w(t){const e=this.#f,n=await this.#u,a=await e(n,t);return a||t}#y(){if(this.#g>0){this.#m;const t=async()=>{this.#m?await this.#m(this.#h):await this.#p(this.#h),setTimeout(t,this.#g)};setTimeout(t,this.#g)}}}const l={OAuthInterceptor:function(t){const e=t;return e.fetchToken=async()=>{const t=await fetch(e.login.url,{method:e.login.method||"get"});return t=await t.json(),t[e.login.response.valueSelector]},c(t)},TokenInterceptor:c};t.defaultjs=t.defaultjs||{},t.defaultjs.httpinterceptor=t.defaultjs.httpinterceptor||{VERSION:"${version}",Manager:r,Interceptor:s,interceptors:l};const u="/templates",h="global:action:reload-parent",d=(new URL(location),{ROLEMAPPING:{"ex-member":"EX Member",reservist:"Reservist",recruit:"Anwärter",private:"Member",junior_officer:"Member",combat_officer:"Feldkommandent",personnel_officer:"Personal Offizier",recruitment_officer:"Anwerber",executive_officer:"Ausführender Offizier",commander:"Clan Leader"}});window.APPGLOBALS=d;let p,f,g,m=!1,y={};const w=async()=>{let t=await fetch(new URL("/api/system/access",location));if(401==t.status)return!1;if(403==t.status)return null;t=await t.json();const{member:e,accessToken:n,expireAt:a,accessRights:i}=t;return p=e,f=n,g=a,y=i,APPGLOBALS.member=p,APPGLOBALS.accessRights=y,v(),!0},v=()=>{const t=g-(Date.now()+6e4);setTimeout((async()=>{await w()}),t)},b=async()=>{if(!m){if(!await w())return location.href=new URL("/api/system/login",location).toString(),!1;m=!0}return p},x=()=>y;r.addInterceptor(new class extends s{constructor(){super()}async doAccept(t){return location.origin==t.metadata.origin}async doHandle(t){const e=f;return e&&(t.request.headers=t.request.headers||{},t.request.headers.Authorization=`Bearer ${e}`),t}});const E=function(){const t=Array.from(arguments),e=t.shift();for(;t.length>0;){t.shift()(e)}},A={global:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},globalVar:function(t,e){return 2===arguments.length&&void 0===A.global[t]&&(A.global[t]=e),A.global[t]}},N=A,T=N.globalVar("___DOM_API_EXTENSION_MAP___",{}),D=function(t,e){return function(n){let a=T[n.name];a||(a=T[n.name]={}),a[t]?console.warn('duplicated load of extension "'+t+'"!'):(a[t]=!0,e(n.prototype))}},M=D("EventSupport",(t=>{const e=/(\s+)|(\s*,\s*)/,n=t=>(t.__wrapperhandlemap__||(t.__wrapperhandlemap__=new Map),t.__wrapperhandlemap__),a=(t,a,i)=>{const{wrapper:r,option:s,events:o,handle:c}=a,l=s.capture;if(i){i="string"==typeof i?i.split(e):i;for(let e of i){const a=o.indexOf(e);a>=0&&(t.removeEventListener(e,r,l),o.splice(a,1)),0==o.length&&n(t).delete(c)}}else{for(let e of o)t.removeEventListener(e,r,l);n(t).delete(c)}};t.on=function(){if(arguments.length<2)throw new Error("Too less arguments!");const t=Array.from(arguments);let i="string"==typeof t[0]?t.shift().split(e):t.shift();const r="string"==typeof t[0]?t.shift():null,s=t.shift(),o=void 0===t[0]?{capture:!1,once:!1,passive:!1}:"boolean"==typeof t[0]?{capture:t.shift(),once:!1,passive:!1}:t.shift(),c=function(t){if(r){const e=t.target;if("function"==typeof e.is&&!e.is(r))return}const e=s.apply(null,arguments);return o.once&&a(this,c),e};n(this).set(s,{handle:s,wrapper:c,events:i,option:o});for(let t of i)this.addEventListener(t,c,o);return this},t.removeOn=function(t,e,i){const r=n(this).get(t);return r?a(this,r,e):this.removeEventListener(t,e,i),this},t.trigger=function(){const t=Array.from(arguments),e="number"==typeof t[0]?t.shift():-1;if(e>=0){const a=t[0],i=((n=this).___EVENTTRIGGERTIMEOUTS___||(n.___EVENTTRIGGERTIMEOUTS___={}),n.___EVENTTRIGGERTIMEOUTS___),r=i[a];r&&clearTimeout(r),i[a]=setTimeout((()=>{delete i[a],this.trigger.apply(this,t)}),e)}else{const e=t.shift(),n=t[0]instanceof Event?t.shift():null,a=t.length>=1?1==t.length?t.shift():t:n,i=a?new CustomEvent(e,{bubbles:!0,cancelable:!0,composed:!0,detail:a}):new Event(e,{bubbles:!0,cancelable:!0,composed:!0});n&&(i.delegatedEvent=n),this.dispatchEvent(i)}var n;return this}}));E(EventTarget,M);const P=D("DataSupport",(t=>{t.data=function(){const t={};if(void 0!==this.dataset)for(name in this.dataset)t[name]=this.dataset[name];return this.data=function(){return 0==arguments.length?t:1==arguments.length?t[arguments[0]]:(void 0===arguments[1]||null==arguments[1]?delete t[arguments[0]]:t[arguments[0]]=arguments[1],this)}.bind(this),this.data.apply(null,arguments)}})),L=D("ManipulationSupport",(t=>{t.empty=function(){let t=this.childNodes;for(;0!=t.length;)t[0].remove(!0);return this},t.content=function(){return this.childNodes},t.html=function(){return 0==arguments.length?this.innerHTML:1==arguments.length&&"boolean"==typeof arguments[0]?arguments[0]?this.outerHTML:this.innerHTML:(Array.from(arguments).forEach((t=>{this.empty(),("string"==typeof t||t instanceof Node||t instanceof NodeList||t instanceof HTMLCollection)&&this.append(t)})),this)};const e=function(){const e=t.appendChild.bind(this);for(let t=0;t<arguments.length;t++){let n=arguments[t];n instanceof Node?this.appendChild(n):"string"==typeof n?create(n).forEach(e):"function"==typeof n.forEach&&n.forEach(e)}};t.append=e;const n=function(t,e){this.insertBefore(e,t)};t.prepend=function(){if(0==this.childNodes.length)e.apply(this,arguments);else{const t=this.childNodes.first(),e=n.bind(this,t);for(let t=0;t<arguments.length;t++){const n=arguments[t];n instanceof Node?e(n):("string"==typeof n||"function"==typeof n.forEach)&&n.forEach(e)}}},t.replace=function(){if(arguments.length<1)throw new Error("Insufficient arguments! One or two nodes required!");const t=1==arguments.length?this.parentNode:this,e=1==arguments.length?this:arguments[0],n=1==arguments.length?arguments[0]:arguments[1];n instanceof Array||n instanceof NodeList||n instanceof HTMLCollection?(n.forEach((n=>t.insertBefore(n,e))),e.remove()):t.replaceChild(n,e)},t.after=function(){if(null==this.parentNode)throw new Error("Can't insert nodes after this node! Parent node not available!");const e=this.parentNode,n=this.nextSibling;n?t.before.apply(n,arguments):t.append.apply(e,arguments)},t.before=function(){if(null==this.parentNode)throw new Error("Can't insert nodes after this node! Parent node not available!");const t=this.parentNode,e=e=>{t.insertBefore(e,this)};for(let t=0;t<arguments.length;t++){const n=arguments[t];n instanceof Node?e(n):("string"==typeof n||"function"==typeof n.forEach)&&n.forEach(e)}}})),$=L;E(Node,P,$);const O=/:parent(\(\"([^\)]*)\"\))?/i,k=function(t,e){let n=O.exec(e);if(!n)return t.querySelectorAll(e);{let a=t;if(n.index>0&&(a=t.querySelectorAll(e.substr(0,n.index)),0==a.length))return;if(a=a.parent(n[2]),a){let t=e.substr(n.index+n[0].length).trim();return t.length>0&&(a=a.find(t)),a}}},V=D("QuerySupport",(t=>{t.find=function(){let t=[],e=Array.from(arguments),n=e.shift();for(;n;){if("string"==typeof n){let e=k(this,n);e&&t.push(e)}n=e.shift()}return NodeList.from.apply(null,t)},t.is=function(){if(this instanceof Document||this instanceof DocumentFragment)return!1;if(1==arguments.length){if("string"==typeof arguments[0])return this.matches(arguments[0]);if("number"==typeof arguments[0].length){let t=arguments[0];for(let e=0;e<t.length;e++)if(this.matches(t[e]))return!0}}else if(arguments.length>1)return this.is(Array.from(arguments));return!1},t.parent=function(t,e){if(!this.parentNode)return null;e="boolean"==typeof t?t:e,t="string"==typeof t?t:null;let n=this.parentNode;if(n instanceof ShadowRoot&&e&&(n=n.host),t){try{for(;n&&!n.is(t);)n=n.parent(t,e)}catch(t){console.error("this:",this,"parent:",n,"error:",t)}return n}return n},t.parents=function(){let e=new Array,n=t.parent.apply(this,arguments);for(;n;)e.push(n),n=t.parent.apply(n,arguments);return NodeList.from(e)},t.selector=function(){if(!(this instanceof Document||this instanceof DocumentFragment)){if(this.id)return"#"+this.id;{let t=this.tagName.toLowerCase(),e=this.parent();if(e){let n=e.find(":scope>"+t);if(n instanceof NodeList){let e=n.indexOf(this);e>0&&(t+=":nth-child("+(e+1)+")")}let a=e.selector();return a?a+">"+t:t}return t}}},t.closest=function(t){return this.closests(t).first()},t.closests=function(t){const e=this.find(t);if(0!=e.length)return e;const n=this.parentElement;return n?n.closests(t):NodeList.from([])},t.nested=function(t){if(this.is(t))return NodeList.from(this);let e=this.find(t);return e&&e.length>0?e:NodeList.from(this.parent(t))}})),R=V,S=D("AttributeSupport",(t=>{t.attr=function(){return 0==arguments.length?this.hasAttributes()?(()=>{const t={};return this.getAttributeNames().forEach((e=>{t[e]=this.getAttribute(e)})),t})():void 0:1==arguments.length?this.getAttribute(arguments[0]):(void 0===arguments[1]||null==arguments[1]?this.removeAttribute(arguments[0]):this.setAttribute(arguments[0],arguments[1]),this)}}));E(Element,R,S,$);const C=D("ReadyEventSupport",(t=>{t.ready=function(t,e){return this.on("ready",t,e),"complete"==document.readyState&&this.trigger("ready"),this}}));E(Document,R,C),document.addEventListener("DOMContentLoaded",(()=>document.trigger("ready"))),E(DocumentFragment,R,$);const I=D("HtmlClassSupport",(t=>{t.addClass=function(){return 1==arguments.length?arguments[0].split(/\s+/).forEach((t=>this.classList.add(t))):arguments.length>1&&Array.prototype.forEach.call(arguments,(t=>this.classList.add(t))),this},t.removeClass=function(){return 1==arguments.length?arguments[0].split(/\s+/).forEach((t=>this.classList.remove(t))):arguments.length>1&&Array.prototype.forEach.call(arguments,(t=>this.classList.remove(t))),this},t.toggleClass=function(){return 1==arguments.length?arguments[0].split(/\s+/).forEach((t=>this.classList.toggle(t))):arguments.length>1&&Array.prototype.forEach.call(arguments,(t=>this.classList.toggle(t))),this}})),H="none",j=t=>t.style.display===H,z=t=>{let e=j(t)?"":t.style.display;return t.show=function(){return this.style.display=e,this}.bind(t),t.hide=function(){return this.style.display=H,this}.bind(t),t},U=D("ShowHideSupport",(t=>{t.show=function(){return z(this).show.apply(null,arguments)},t.hide=function(){return z(this).hide.apply(null,arguments)},t.toggleShow=function(){return j(this)?this.show():this.hide()}}));E(HTMLElement,I,U);const _=[{selector:"select",get:function(){const t=[];return this.find("option").forEach((e=>{e.selected&&t.push(e.value)})),t},set:function(){let t=[];const e=Array.from(arguments);let n=e.shift();for(;n;)Array.isArray(n)?t=t.concat(n):t.push(n),n=e.shift();this.value=t,this.find("option").forEach((e=>e.selected=t.indexOf(e.value)>=0)),this.trigger("changed")}},{selector:'input[type="checkbox"], input[type="radio"]',get:function(){return"on"==this.value||"off"==this.value?this.checked:this.checked?this.value:void 0},set:function(t){"boolean"==typeof t?this.checked=t:"string"==typeof t?this.checked=this.value==t:Array.isArray(t)&&(this.checked=t.indexOf(this.value)>=0),this.trigger("changed")}}],q={get:function(){return this.value},set:function(t){this.value=t,this.trigger("input")}},F=D("ValueSupport",(t=>{t.val=function(){let t=function(t){for(let e=0;e<_.length;e++)if(t.is(_[e].selector))return _[e];return q}(this);return 0==arguments.length?t.get.apply(this,arguments):(t.set.apply(this,arguments),this)}}));E(HTMLInputElement,F),E(HTMLTextAreaElement,D("ValueSupport",(t=>{t.val=function(){return 0==arguments.length?this.value:(this.value=arguments[0],this)}}))),E(HTMLSelectElement,F);const K=function(){const t=Array.from(arguments),e=t.shift(),n=t.shift();t.forEach((t=>{Object.getOwnPropertyNames(t).forEach((a=>{const i=Object.getOwnPropertyDescriptor(t,a);void 0===n[a]&&"function"==typeof i.value&&(n[a]=function(){return e.call(this,a,arguments)})}))}))},G=D("ListSupport",(t=>{t.indexOf=function(){for(let t=0;t<this.length;t++)if(this[t]==arguments[0])return t;return-1},t.forEach=function(){return Array.prototype.forEach.apply(Array.from(this),arguments)},t.map=function(){return Array.prototype.map.apply(Array.from(this),arguments)},t.filter=function(){return Array.prototype.filter.apply(Array.from(this),arguments)},t.first=function(){if(this.length>0)return this[0]},t.last=function(){if(this.length>0)return this[this.length-1]}}));E(NodeList,G),NodeList.prototype.applyTo=function(){const t=Array.from(arguments),e=t.shift(),n="function"==typeof e,a=[];for(let i=0;i<this.length;i++){const r=this[i];let s;n?s=e.apply([r].concat(t)):"function"==typeof r[e]&&(s=r[e].apply(r,t)),s&&a.push(s)}return a},NodeList.prototype.val=function(){if(0==arguments.length){if(this.length>0){const t=new Map;return this.forEach((e=>{if("function"==typeof e.val){e.val()&&t.set(e.name||e.id||e.selector(),e.val())}})),t}}else NodeList.prototype.applyTo.apply(this,["val"].concat(Array.from(arguments)))},NodeList.from=function(){const t=Array.from(arguments),e={};let n=0;for(;t.length>0;){const a=t.shift();if(void 0!==a&&null!=a)if(a instanceof Node)e[n++]={value:a,enumerable:!0};else if(a instanceof NodeList||a instanceof HTMLCollection||a instanceof Array)for(let t=0;t<a.length;t++)a[t]&&a[t]instanceof Node&&(e[n++]={value:a[t],enumerable:!0})}return e.length={value:n},Object.create(NodeList.prototype,e)},K((function(t,e){let n=[];return this.forEach((a=>{if(a&&"function"==typeof a[t]){const i=a[t].apply(a,e);i&&(i instanceof NodeList?n=n.concat(Array.from(i)):n.push(i))}})),0===n.length?void 0:n[0]instanceof Node||n[0]instanceof NodeList?NodeList.from(n):n}),NodeList.prototype,Node.prototype,HTMLElement.prototype,HTMLInputElement.prototype,Element.prototype,EventTarget.prototype),E(HTMLCollection,G),HTMLCollection.prototype.applyTo=function(){const t=Array.from(arguments),e=t.shift(),n="function"==typeof e,a=[];for(let i=0;i<this.length;i++){const r=this[i];let s;n?s=e.apply([r].concat(t)):"function"==typeof r[e]&&(s=r[e].apply(r,t)),s&&a.push(s)}return a},HTMLCollection.prototype.val=function(){if(0==arguments.length){if(this.length>0){const t=new Map;return this.forEach((e=>{if("function"==typeof e.val){e.val()&&t.set(e.name||e.id||e.selector(),e.val())}})),t}}else HTMLCollection.prototype.applyTo.apply(this,["val"].concat(Array.from(arguments)))},HTMLCollection.from=function(){const t=Array.from(arguments),e={};let n=0;for(;t.length>0;){const a=t.shift();if(void 0!==a&&null!=a)if(a instanceof HTMLElement)e[n++]={value:a,enumerable:!0};else if(a instanceof HTMLCollection||a instanceof NodeList||a instanceof Array)for(let t=0;t<a.length;t++)a[t]&&a[t]instanceof HTMLElement&&(e[n++]={value:a[t],enumerable:!0})}return e.length={value:n},Object.create(HTMLCollection.prototype,e)},K((function(t,e){let n=[];return this.forEach((a=>{if(a&&"function"==typeof a[t]){let i=a[t].apply(a,e);i&&(i instanceof HTMLCollection?n=n.concat(Array.from(i)):n.push(i))}})),0===n.length?void 0:n[0]instanceof HTMLElement||n[0]instanceof HTMLCollection?HTMLCollection.from.apply(null,n):n}),HTMLCollection.prototype,Node.prototype,HTMLElement.prototype,HTMLInputElement.prototype,Element.prototype,EventTarget.prototype),N.global.defaultjs=N.global.defaultjs||{},N.global.defaultjs.extdom=N.global.defaultjs.extdom||{VERSION:"${version}",utils:{Utils:N}},N.global.find=function(){return document.find.apply(document,arguments)},N.global.ready=function(){return document.ready.apply(document,arguments)},N.global.create=function(t,e){if("string"!=typeof arguments[0])throw new Error("The first argument must be a string!");const n=document.createElement("template");return n.innerHTML=t,e?n:document.importNode(n.content,!0).childNodes},N.global.script=function(t,e){return t instanceof Array?Promise.all(t.map((t=>N.global.script(t,e)))):"string"==typeof t?new Promise(((n,a)=>{const i=document.createElement("script");i.async=!0,i.onload=function(){n()},i.onerror=function(){throw new Error("load error!")},e?e.append(i):document.body.append(i),i.src=t})):Promise.reject("First parameter must be an array of strings or a string!")};class B{constructor(t,e){this.key=t,this.context=e}get keyDefined(){return this.key in this.context}get hasValue(){return!!this.context[this.key]}get value(){return this.context[this.key]}set value(t){this.context[this.key]=t}set append(t){if(this.hasValue){const e=this.value;e instanceof Array?e.push(t):this.value=[this.value,t]}else this.value=t}remove(){delete this.context[this.key]}static load(t,e,n=!0){let a=t;const i=e.split(".");let r=i.shift().trim();for(;i.length>0;){if(!a[r]){if(!n)return null;a[r]={}}a=a[r],r=i.shift().trim()}return new B(r,a)}}const X=function(t){return void 0!==t&&null!=t&&"Object"===t.constructor.name},W=function(t,...e){t||(t={});for(let n of e)X(n)&&Object.getOwnPropertyNames(n).forEach((e=>{X(t[e])?W(t[e],n[e]):t[e]=n[e]}));return t},J=function(){const[t,e,{deep:n=!1,recursive:a=!0,parents:i=[]}={}]=arguments,r={};for(let s in t){const o=t[s],c=e(s,o,t);if(!c||n&&null!=o){if(c&&n){"object"!==typeof o||o instanceof Array||o instanceof Map||o instanceof Set||o instanceof RegExp||i.includes[o]||o==t?r[s]=o:r[s]=J(o,e,{deep:n,recursive:a,parents:i.concat(t)})}}else r[s]=o}return r},Z=(t,e,n)=>{Object.defineProperty(t,e,{value:n,writable:!1,configurable:!1,enumerable:!1})},Q=(t,e,n)=>{Object.defineProperty(t,e,{get:n,configurable:!1,enumerable:!1})},Y={isPojo:X,append:function(t,e,n){if(void 0!==e){B.load(n,t,!0).append=e}return n},merge:W,filter:J,buildPropertyFilter:function({names:t,allowed:e}){return(n,a,i)=>t.includes(n)===e},defValue:Z,defGet:Q,defGetSet:(t,e,n,a)=>{Object.defineProperty(t,e,{get:n,set:a,configurable:!1,enumerable:!1})}},tt=()=>{let t=null,e=null;const n=new Promise(((n,a)=>{t=n,e=a}));let a,i=!1,r=!1;return Z(n,"resolve",(n=>{a=n,i=!0,a instanceof Error?(r=!0,e(a)):t(a)})),Q(n,"value",(()=>a)),Q(n,"error",(()=>r)),Q(n,"resolved",(()=>i)),n},et=(t,e)=>{let n="unsupported";if("string"==typeof e)n=e;else if(e instanceof HTMLElement)n=e.nodeName;else{if("string"!=typeof e.NODENAME)throw new Error(typeof e+' is not supported as parameter "node"!');n=e.NODENAME}return`${n.toLowerCase()}:${t}`},nt=(t,e)=>et(`attribute--${t}`,e),at=new WeakMap,it=t=>class extends t{#v=tt();constructor({shadowRoot:t=!1,content:e=null,createUID:n=!1,uidPrefix:a="id-",uidSuffix:i=""}={}){super(),n&&this.attr("id",n(a,i)),t&&this.attachShadow({mode:"open"}),e&&this.root.append("function"==typeof e?e(this):e)}get root(){return this.shadowRoot||this}get ready(){return this.#v}async init(){}async destroy(){this.ready.resolved&&(this.#v=tt())}connectedCallback(){this.ownerDocument==document&&this.isConnected&&(t=>{let e=at.get(t);e&&clearTimeout(e),at.get(t,setTimeout((async()=>{at.delete(t);try{await t.init(),t.ready.resolve()}catch(e){console.error("Can't initialize component!",t,e),t.ready(resolve(e))}t.trigger(et("initialzed",t))}),10))})(this)}adoptedCallback(){this.connectedCallback()}attributeChangedCallback(t,e,n){e!=n&&this.isConnected&&(this.trigger(10,nt(t,this)),this.trigger(10,et("change",this)))}disconnectedCallback(){this.destroy()}},rt=new Map,st=t=>{let e=rt.get(t);return null==e&&(e=it(t),rt.set(t,e)),e},ot=st(HTMLElement),ct=(t,e)=>"string"==typeof e?e+t:"d-"+t,lt=function(t,e){const n=t.NODENAME;customElements.get(n)||customElements.define(n,t,e)},ut=(t,e,n)=>{if(n(t))return{node:t,depth:e};let a=null;for(let i of t.childNodes){const t=ut(i,e+1,n);null!=t&&(null==a||a.depth>t.depth)&&(a=t)}return a},ht=(t,e)=>{const n=ut(t,0,e);return null!=n?n.node:null},dt=new WeakMap,pt=t=>{if(dt.has(t))return dt.get(t);const e={};return dt.set(t,e),e},ft=function(t,e,n){const a=pt(t);if(1===arguments.length)return a;if(2===arguments.length)return a[e];if(3!==arguments.length)throw new Error("Not allowed size of arguments!");a[e]=n},gt=t=>function(e,n){if(2!=arguments.length)return ft(e,t);ft(e,t,n)},mt=ct("route"),yt=`${mt}-init`,wt=`${mt}-click`,vt=`${mt}-activate`,bt=`${mt}-deactivate`,xt=ct("route-link"),Et=xt+"-to-route",At=void 0!==n.g?n.g:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{};class Nt{constructor(t){this.hasValue=1==arguments.length,this.value=t}}class Tt{constructor(t,e){this.data=t,this.resolver=e,this.cache=new Map}updateData(t){this.data=t,this.cache=new Map}resetCache(){this.cache=new Map}getPropertyDef(t,e=!0){if(this.cache.has(t))return this.cache.get(t);let n=null;if(this.data&&t in this.data)n={data:this.data,resolver:this.resolver,defined:!0};else{if(!e)return null;n=((t,e)=>{for(;t;){const n=t.proxy.handle.getPropertyDef(e,!1);if(n)return n;t=t.parent}return{data:null,resolver:null,defined:!1}})(this.resolver.parent,t)}return n.defined&&this.cache.set(t,n),n}hasProperty(t){const{defined:e}=this.getPropertyDef(t);return e}getProperty(t){const{data:e}=this.getPropertyDef(t);return e?e[t]:void 0}setProperty(t,e){const{data:n,defined:a}=this.getPropertyDef(t);a?n[t]=e:(this.data||(this.data={}),this.data[t]=e,this.cache.set(t,{data:this.data,resolver:this.resolver,defined:!0}))}deleteProperty(t){throw new Error("unsupported function!")}}class Dt{constructor(t,e){this.handle=new Tt(t,e),this.data=new Proxy(this.handle,{has:function(t,e){return t.hasProperty(e)},get:function(t,e){return t.getProperty(e)},set:function(t,e,n){return t.setProperty(e,n)},deleteProperty:function(t,e){return t.deleteProperty(e)}})}updateData(t){this.handle.updateData(t)}resetCache(){this.handle.resetCache()}}const Mt=/(\\?)(\$\{(([a-zA-Z0-9\-_\s]+)::)?([^\{\}]+)\})/,Pt=new Nt,Lt=t=>t instanceof Nt?t:new Nt(t),$t=async function(t,e,n,a){if(n&&t.name!=n)return t.parent?$t(t.parent,e,n,a):null;const i=await async function(t,e){if("string"!=typeof t)return t;const n=new Function("context",`\nreturn (async (context) => {\n\ttry{ \n\t\twith(context){\n\t\t\t return ${t}\n\t\t}\n\t}catch(e){\n\t\tthrow e;\n\t}\n})(context)`);let a,i=setTimeout((()=>{i=null,console.warn("long running statement:",t,new Error)}),1e3);try{a=await n(e)}catch(t){}return i&&clearTimeout(i),a}(e,t.proxy.data);return null!=i?i:a instanceof Nt&&a.hasValue?a.value:void 0},Ot=async(t,e,n)=>e[1]?e[2]:$t(t,e[5],kt(e[4]),n),kt=t=>t?0==(t=t.trim()).length?null:t:null;class Vt{constructor({context:t=At,parent:e=null,name:n=null}){this.parent=e instanceof Vt?e:null,this.name=n,this.context=t,this.proxy=new Dt(this.context,this)}get chain(){return this.parent?this.parent.chain+"/"+this.name:"/"+this.name}get effectiveChain(){return this.context?this.parent?this.parent.effectiveChain+"/"+this.name:"/"+this.name:this.parent?this.parent.effectiveChain:""}get contextChain(){const t=[];let e=this;for(;e;)e.context&&t.push(e.context),e=e.parent;return t}getData(t,e){if(t){if(!e||e==this.name){const e=B.load(this.context,t,!1);return e?e.value:null}this.parent&&this.parent.getData(t,e)}}updateData(t,e,n){if(t)if(n&&n!=this.name)this.parent&&this.parent.updateData(t,e,n);else{null!=this.context&&void 0!==this.context||(this.context={},this.proxy.updateData(this.context));B.load(this.context,t).value=e,this.proxy.resetCache()}}mergeContext(t,e){e&&e!=this.name?this.parent&&this.parent.mergeContext(t,e):this.context=this.context?Y.merge(this.context,t):t}async resolve(t,e){const n=2==arguments.length?Lt(e):Pt;try{const e=Mt.exec(t);return e?await Ot(this,e,n):await $t(this,kt(t),null,n)}catch(e){return console.error('error at executing statment"',t,'":',e),n.hasValue?n.value:t}}async resolveText(t,e){let n=t,a=t,i=Mt.exec(n);const r=2==arguments.length?Lt(e):Pt;for(;null!=i;){const t=await Ot(this,i,r);a=a.split(i[0]).join(),n=n.split(i[0]).join(void 0===t?"undefined":null==t?"null":t),i=Mt.exec(a)}return n}static async resolve(t,e,n,a){const i=new Vt({context:e}),r=arguments.length>2?Lt(n):Pt;return"number"==typeof a&&a>0?new Promise((e=>{setTimeout((()=>{e(i.resolve(t,r))}),a)})):i.resolve(t,r)}static async resolveText(t,e,n,a){const i=new Vt({context:e}),r=arguments.length>2?Lt(n):Pt;return"number"==typeof a&&a>0?new Promise((e=>{setTimeout((()=>{e(i.resolveText(t,r))}),a)})):i.resolveText(t,r)}static buildSecure({context:t,propFilter:e,option:n={deep:!0},name:a,parent:i}){return t=Y.filter({data:t,propFilter:e,option:n}),new Vt({context:t,name:a,parent:i})}}n(609);const Rt="template",St={},Ct=async(t,e,n)=>It(create(t,!0),e,n),It=async(t,e,n)=>{let a=null;if(t instanceof HTMLTemplateElement)a=new Ht(t,n);else{if(a=document.createElement("template"),!(t instanceof Node||t instanceof NodeList||t instanceof HTMLCollection||t instanceof Array))throw new Error("Template type is not supported!");a.content.append(t.cloneNode(!0)),a=new Ht(a,n)}if(!a)throw new Error("Template can't loaded!");return e&&n&&(St[n]=a),a};class Ht{constructor(t,e){this.template=t,this.key=e}importContent(t=document){return t.importNode(this.template,!0).content.childNodes}remove(){this.key&&St[this.key]&&delete St[this.key]}static async fetch(t,e=!0,n=null){return"string"==typeof t?Ht.load(new URL(t,loaction),e,n):t instanceof URL?Ht.load(t,e,n):void new Error("The url isn't a allowed type! -> [String|URL] required!")}static async load(t,e=!0,n=null){if(t instanceof Ht)return t;const a=((t,e,n)=>{if(!e)return null;let a=null;return n?a=n:"string"==typeof t?a=t:t instanceof URL?a=t.toString():t instanceof HTMLElement&&(a=t.selector()),a?a.hashcode():null})(t,e,n);return a&&St[a]?St[a]:"string"==typeof t?Ct(t,e,a):t instanceof URL?await(async(t,e,n)=>{const a=await fetch(t.toString()),i=await a.text();return Ct(i,e,n)})(t,e,a):t instanceof Node||t instanceof NodeList||t instanceof HTMLCollection||t instanceof HTMLTemplateElement?It(t,e,a):void new Error("The template isn't a allowed type! -> [String|URL|Node|NodeList|HTMLCollection|Template] required!")}static async loadNodeTemplate(t,e,n,a){try{const e=(t=>{let e=t.find(":scope > template").first();if(e)return e;const n=t.attr(Rt);if(!n)return null;try{if(e=find(n).first(),e)return e}catch(t){}return new URL(n,location)})(t);if(e)return Ht.load(e,n,a)}catch(e){console.warn("Can't load template from node!",t,e)}return e}}const jt="name",zt="active",Ut="stateful",_t="component-tag",qt="component-tag-attributes",Ft="view",Kt=[jt,Rt,_t,qt,Ut,Ft],Gt=[wt,vt,bt],Bt=gt(Rt),Xt=async t=>{if(t.hasAttribute(Rt)){let e=Bt(t);return e||(e=await Ht.loadNodeTemplate(t,null,!1),Bt(t,e)),e}{const e=t.attr(_t),n=customElements.get(e),a=await(async t=>{const e=t.attr(qt)||"{}";return Vt.resolve(e,{},{})})(t),i=new n;for(let t in a){const e=a[t];"string"==typeof e&&i.attr(t,e)}return i}};class Wt extends ot{static get observedAttributes(){return Kt}static get NODENAME(){return mt}static get EVENTS(){return Gt}#b=!1;constructor(t){super(t||{}),this.on("click",(()=>{this.active||this.trigger(wt)}))}async init(){await super.init(),this.#b||(this.#b=!0,this.trigger(yt),this.active&&this.trigger(wt))}get name(){return this.attr(jt)}get view(){return this.attr(Ft)}get active(){return this.hasAttribute(zt)}set active(t){t!=this.active&&(this.attr(zt,t?"":null),t?this.trigger(vt):this.trigger(bt))}get stateful(){return this.hasAttribute(Ut)}get context(){return this.attr("context")}get refresh(){return this.hasAttribute(ATTR_REFRESH)}async component(){return Xt(this)}}lt(Wt);const Jt=Wt,Zt="target",Qt="context",Yt=[Zt,Qt],te=[Et];class ee extends ot{static get observedAttributes(){return Yt}static get NODENAME(){return xt}static get EVENTS(){return te}constructor(t){super(t||{}),this.on("click",(t=>{t.preventDefault(),this.trigger(Et)}))}async init(){}get view(){return this.attr("view")}get target(){return this.attr(Zt)}get context(){return this.attr(Qt)}get refresh(){return this.hasAttribute("refresh")}}lt(ee);const ne=ee,ae=ct("view"),ie=[],re={init:0,data:1,template:2,content:3,finish:4};class se{static get PHASE(){return re}static get MIN_RANK(){return 0}static get MAX_RANK(){return 1e5}constructor(){}get name(){}get rank(){}get phase(){return re.finish}async execute(t){return t}static define(t){(({directive:t})=>{if(!(t instanceof se))throw new Error("Implementation dosn't extend Directive class!");if(t.rank<se.MIN_RANK)throw new Error("The rank of a directive can't be lower as "+se.MIN_RANK+"!");if(t.rank>se.MAX_RANK)throw new Error("The rank of a directive can't be grater as "+se.MAX_RANK+"!");ie.push(t),ie.sort(((t,e)=>{const n=t.phase-e.phase;return 0==n?t.rank-e.rank:n}))})(t)}static get directives(){return ie}}new Set,new Map;const oe=t=>t instanceof Ht?t.importContent():typeof t===String?create(t):t;let ce=0;class le{#x;#E;#A;#N;#T;#D;#M;#P;#L;#$;#O;constructor({content:t=null,resolver:e,renderer:n,template:a,container:i,root:r,mode:s="replace",target:o=null,parent:c=null,wait:l=null,callbacks:u=null,ignoreDirective:h}){if(!e)throw new Error('Parameter "resolver" is required!');if(!n)throw new Error('Parameter "renderer" is required!');if(!a)throw new Error('Parameter "template" is required!');if(!i)throw new Error('Parameter "container" is required!');if(!r)throw new Error('Parameter "root" is required!');this.#x=c?`${c.id}->${ce++}`:"root::"+ce++,this.#E=c?c.depth+1:0,this.#A=c,this.#N=n,this.#T=r,this.#D=oe(a),this.#M=s,this.#P=new Set,this.#L=l||tt(),this.#$=h instanceof Set?h:new Set,this.#O=u instanceof Array?u:[],this.content=t,this.container=i,this.target=o,this.resolver=e,this.stop=!1,this.ignore=!1,c&&c.subcontexts.add(this)}get id(){return this.#x}get depth(){return this.#E}get parent(){return this.#A}get renderer(){return this.#N}get root(){return this.#T}get template(){return this.#D}set template(t){this.#D=oe(t)}get mode(){return this.#M}get subcontexts(){return this.#P}get closed(){return this.#L.resolved}ignoreDirective(t){const e=this.#$;t instanceof se?e.add(t.name):e.add(t)}acceptDirective(t){const e=this.#$;return t instanceof se?!(e.has(t.name)||e.has(t)):!e.has(t)}finished(t){this.parent?this.parent.finished(t):this.ready(t)}async ready(t){const e=this.#O;if(!t){const t=this.#L;if(!t.resolved){if(!this.ignore)for(let t of e)await t(this);for(let t of this.subcontexts)await t.ready();this.parent&&this.parent.subcontexts.delete(this),t.resolve(this)}return t}t instanceof Array?t.forEach((t=>this.wait.then(t))):t instanceof Promise?e.push((async()=>await t)):"function"==typeof t&&e.push(t)}subContext({resolver:t=this.resolver,renderer:e=this.renderer,template:n=this.template,container:a=this.container,root:i=this.root,mode:r=this.mode,target:s=this.target,ignoreDirective:o=null}={}){return new le({resolver:t,renderer:e,template:n,container:a,mode:r,root:i,target:s,parent:this,ignoreDirective:o})}clone({content:t=this.content,template:e=this.template,container:n=this.container,root:a=this.root,mode:i=this.mode,target:r=this.target,ignoreDirective:s=this.#$}={}){return new le({content:t,resolver:this.resolver,renderer:this.renderer,template:e,container:n,root:a,mode:i,target:r,ignoreDirective:s,wait:this.#L,callbacks:this.#O})}toRenderOption({resolver:t=this.resolver,renderer:e=this.renderer,template:n=this.template,container:a=this.container,root:i=this.root,mode:r=this.mode,target:s=this.target,ignoreDirective:o=null}={}){return{resolver:t,renderer:e,template:n,container:a,mode:r,root:i,target:s,parent:null,ignoreDirective:o}}}class ue extends HTMLElement{constructor(){super(),this.hidden=!0}async execute({template:t,context:e}){return e.content=t.cloneNode(!0),e}}class he extends ue{constructor(){super(),this.attachShadow({mode:"open"})}async execute({template:t,context:e}){return e}}try{customElements.define("jstl-replace",he)}catch(t){}se.define({directive:new class extends se{constructor(){super()}get name(){return"initial"}get rank(){return se.MIN_RANK}get phase(){return se.PHASE.init}async execute(t){const{template:e,renderer:n,resolver:a}=t;if(e instanceof Element)if(e.attr("jstl-ignore"))t.content=document.importNode(e,!0),t.stop=!0,t.ignore=!0;else if(e.attr("jstl-async")){t.content=new he,e.attr("jstl-async",null);const a=t.toRenderOption({mode:"replace",target:t.content});setTimeout((()=>{n.render(a)}),parseInt(e.attr("jstl-async")||"250")||250),t.stop=!0,t.ignore=!0}else if(e instanceof HTMLTemplateElement){t.content=document.createElement(e.tagName);const a=t.subContext({template:e.content.childNodes,container:t.content.content});await n.render(a),t.stop=!0,t.ignore=!0}else if(e.hasAttribute("jstl-tagname")){e.attr("jstl-tagname").trim().length>0?t.content=document.createElement(await a.resolveText(e.attr("jstl-tagname"))):(t.content=document.importNode(e,!0),t.stop=!0,t.ignore=!0)}else if(e.tagName){let n=e.attr("is");if(n){n=await a.resolveText(n);const i=document.createElement(e.tagName,{is:n});i.attr("is",n),t.content=i}else t.content=document.createElement(e.tagName)}else t.content=document.importNode(e,!0),t.stop=!0,t.ignore=!0;else t.content=document.importNode(e,!0);return t}}});const de={remote:async({data:t,context:e})=>{const{resolver:n,template:a}=e;t=await n.resolveText(t),t=new URL(t,location.origin);let i=await n.resolveText(a.attr("jstl-data-option")||"{}");return i=JSON.parse(i),(t=await fetch(t.toString(),i)).json()},set:async({data:t,context:e})=>{const{resolver:n}=e;return t=await n.resolve(t)},direct:async({data:t,context:e})=>{const{resolver:n}=e;return t=await n.resolveText(t)}};se.define({directive:new class extends se{constructor(){super()}get name(){return"data"}get rank(){return 1e3}get phase(){return se.PHASE.data}async execute(t){if(!(t.template instanceof HTMLElement&&t.template.attr("jstl-data")))return t;try{const{template:e}=t,n=de[e.attr("jstl-data-mode")||"remote"];if(!n)throw new Error("The jstl-data-mode is unsupported!");let a=e.attr("jstl-data");a=await n({data:a,context:t});const i=e.attr("jstl-data-var");t=(({varname:t,data:e,scope:n,context:a})=>{if(t)a.resolver.updateData(t,e,n);else if(n)a.resolver.mergeContext(e,n);else{const t=new Vt({context:e,name:"jstl-data",parent:a.resolver});a.resolver=t}return a})({varname:i,data:a,scope:e.attr("jstl-data-scope"),context:t})}catch(e){console.error(e,t.template)}return t}}});se.define({directive:new class extends se{constructor(){super()}get name(){return"if"}get rank(){return se.MIN_RANK+1e3}get phase(){return se.PHASE.init}async execute(t){const{template:e}=t;if(!(e instanceof HTMLElement&&e.attr("jstl-if")))return t;const n=e.attr("jstl-if"),a=t.resolver;return await a.resolve(n,!1)||(t.content=null,t.stop=!0,t.ignore=!0),t}}});se.define({directive:new class extends se{constructor(){super()}get name(){return"choose"}get rank(){return se.MIN_RANK+1}get phase(){return se.PHASE.template}async execute(t){if(!(t.template instanceof HTMLElement&&t.template.hasAttribute("jstl-choose")&&0!=t.template.children.length))return t;t.template=t.template.cloneNode(!0);const{template:e,resolver:n}=t;let a=!1;const i=e.find(":scope > [jstl-when]"),r=i.length;for(let t=0;t<r;t++){const e=i[t];!a&&await n.resolve(e.attr("jstl-when"),!1)?a=!0:e.remove()}return a&&e.find(":scope > [jstl-otherwise]").remove(),t}}});se.define({directive:new class extends se{constructor(){super()}get name(){return"include"}get rank(){return se.MIN_RANK}get phase(){return se.PHASE.template}async execute(t){if(!(t.template instanceof HTMLElement&&t.template.attr("jstl-include")))return t;try{const{template:e,resolver:n,renderer:a}=t;let i=e.attr("jstl-include");i=await n.resolveText(i),i=new URL(i,location),i=await Ht.load(i);const r=e.attr("jstl-include-mode")||"replace",s=t.subContext({template:i,container:t.content,mode:r});return await a.render(s),await s.ready(),t.ignore=!0,t.stop=!0,t}catch(e){return console.error(e,t.template),t}}}});const pe="jstl-foreach",fe="jstl-foreach-var",ge="jstl-foreach-status",me="jstl-foreach-count",ye="jstl-foreach-start",we="jstl-foreach-step",ve="jstl-foreach-condition",be=async(t,e)=>{let{template:n,resolver:a,renderer:i,container:r,condition:s,context:o}=e;if(a=new Vt({context:t,name:"jstl-foreach",parent:a}),s=!!s&&await a.resolve(s,!1),s)return!1;const c=o.subContext({resolver:a,container:r,template:n,mode:"append"});return await i.render(c),await c.ready(),!0};se.define({directive:new class extends se{constructor(){super()}get name(){return"foreach"}get rank(){return se.MIN_RANK+2}get phase(){return se.PHASE.template}async execute(t){if(!(t.template instanceof HTMLElement)||!t.template.attr(pe)&&!t.template.attr(me))return t;t.ignore=!0;try{const{template:e,resolver:n,renderer:a,content:i}=t,r={data:(e.attr(pe)||"").trim(),count:(e.attr(me)||"").trim(),start:await n.resolve(e.attr(ye)||"0"),step:await n.resolve(e.attr(we)||"1"),varname:(e.attr(fe)||"item").trim(),status:(e.attr(ge)||"status").trim(),condition:e.attr(ve),template:e.childNodes,resolver:n,renderer:a,container:i,context:t};r.data&&""!=r.data||!r.count?await(async t=>{let{data:e,start:n,step:a,count:i,varname:r,status:s,resolver:o}=t;e=await o.resolve(e);let c=e;e instanceof Array||(c=Object.getOwnPropertyNames(e)),i=""!=i?await o.resolve(i,0):null;const l=i?Math.min(n+i,c.length):c.length;let u=!1;for(let i=n;i<l&&!u;i+=a){const n={};n[r]=e[i],n[s]={index:i,number:i+1,count:l,data:e},u=!await be(n,t)}})(r):await(async t=>{let{start:e,step:n,count:a,varname:i,status:r,resolver:s}=t;a=await s.resolve(a);const o=e+a*n;let c=!1;for(let s=e;s<o&&!c;s+=n){const e={};e[i]=s,e[r]={index:s,number:s+1,step:n,count:a},c=!await be(e,t)}})(r)}catch(t){console.error("error at jstl-foreach:",t)}return t}}});const xe="jstl-repeat",Ee=new Set([xe]),Ae={DATA:`${xe}`,VAR:`${xe}-var`,STATUS:`${xe}-status`,COUNT:`${xe}-count`,START:`${xe}-start`,STEP:`${xe}-step`,CONDITION:`${xe}-condition`},Ne=async(t,e)=>{let{template:n,resolver:a,renderer:i,condition:r,context:s}=e;if(a=new Vt({context:t,name:xe,parent:a}),r=!!r&&await a.resolve(r,!1),r)return!1;const o=s.subContext({resolver:a,template:n,mode:"append",ignoreDirective:Ee});return await i.render(o),await o.ready(),!0};se.define({directive:new class extends se{constructor(){super()}get name(){return xe}get rank(){return se.MIN_RANK+3}get phase(){return se.PHASE.template}async execute(t){if(!(t.template instanceof HTMLElement)||!t.template.attr(Ae.DATA)&&!t.template.attr(Ae.COUNT))return t;try{const{template:e,resolver:n,renderer:a,content:i,container:r}=t,s={data:(e.attr(Ae.DATA)||"").trim(),count:(e.attr(Ae.COUNT)||"").trim(),start:await n.resolve(e.attr(Ae.START)||"0"),step:await n.resolve(e.attr(Ae.STEP)||"1"),varname:(e.attr(Ae.VAR)||"item").trim(),status:(e.attr(Ae.STATUS)||"status").trim(),condition:e.attr(Ae.CONDITION),template:e,tagname:i.tagName,resolver:n,renderer:a,container:r,context:t};s.data&&""!=s.data||!s.count?await(async t=>{let{data:e,start:n,step:a,count:i,varname:r,status:s,resolver:o}=t;e=await o.resolve(e);let c=e;e instanceof Array||(c=Object.getOwnPropertyNames(e)),i=""!=i?await o.resolve(i,0):null;const l=i?Math.min(n+i,c.length):c.length;let u=!1;for(let i=n;i<l&&!u;i+=a){const n={};n[r]=e[i],n[s]={index:i,number:i+1,count:l,data:e},u=!await Ne(n,t)}})(s):await(async t=>{let{start:e,step:n,count:a,varname:i,status:r,resolver:s}=t;a=await s.resolve(a);const o=e+a*n;let c=!1;for(let s=e;s<o&&!c;s+=n){const e={};e[i]=s,e[r]={index:s,number:s+1,step:n,count:a},c=!await Ne(e,t)}})(s)}catch(t){console.error("error at jstl-repeat:",t)}return t.content=null,t.stop=!0,t.ignore=!0,t}}});const Te={mode:"text",unsecure:!1,preventFormat:!1,maxLength:0},De={text:async(t,e)=>{const{content:n,resolver:a,template:i}=e;let r=await a.resolveText(i.textContent);r=create(r,!0).content.textContent,t.maxLength>0&&(r=((t,e)=>t.length>e?t.substring(0,e-3).trim()+"...":t)(r,t.maxLength)),n.textContent=r},html:async(t,e)=>{const{resolver:n,template:a}=e;let i=await n.resolveText(a.textContent);i=create(i,!0),i=document.importNode(i.content,!0),t.unsecure||i.find("script, style, body, html, head, object, link").remove(),e.content=i}};se.define({directive:new class extends se{constructor(){super()}get name(){return"text"}get rank(){return se.MIN_RANK+1}get phase(){return se.PHASE.content}async execute(t){const{template:e}=t;if(!(e instanceof Text)||0==e.textContent.trim().length||e.parentElement&&e.parentElement.hasAttribute("jstl-text-ignore"))return t;const n=e.parentElement,a=n?await(async(t,e)=>{const n=e.resolver;return{mode:await n.resolveText((t.attr("jstl-text-content-type")||"text").trim().toLowerCase()),unsecure:t.hasAttribute("jstl-text-unsecure"),preventFormat:!!t.attr("jstl-text-prevent-format")||!1,maxLength:parseInt(await n.resolveText(t.attr("jstl-text-trim-length")||"0"))}})(n,t):Te,i=De[a.mode];if(!i)throw new Error('Text mode "'+a.mode+'" is unsupported!');return await i(a,t),t}}});const Me=/(jstl)?(\?)?(@)?([^\?@]+)/i,Pe="default",Le="prevent-default",$e=["is"],Oe={delegate:async(t,e,n,a,i,r,s,o)=>{const c=await i.resolveText(e,e);r.on(t,Ce(c,n))},toggleclass:async(t,e,n,a,i,r,s,o)=>{const c=s.shift(),l=s.includes(Le),u=e?await i.resolveText(e,e):null;r.on(t,(t=>{l&&t.preventDefault(),u?r.closests(u).toggleClass(c):r.toggleClass(c)}))},toggleattribute:async(t,e,n,a,i,r,s,o)=>{const c=s.shift(),l=s.includes(Le),u=e?await i.resolveText(e,e):null;r.on(t,(t=>{l&&t.preventDefault(),u?r.closests(u).forEach((t=>{t.toggleAttribute(c)})):r.toggleAttribute(c)}))},[Pe]:async(t,e,n,a,i,r,s,o)=>{const c=e?await i.resolve(e,e):null;if(c){if("function"==typeof c)r.on(t,c);else if("string"==typeof c)r.on(t,Ce(c,n));else if("object"==typeof c){const{capture:e=!1,passive:n=!1,once:a=!1}=c;r.on(t,c.eventHandle,{capture:e,passive:n,once:a})}}else console.error(new Error("Can't resolve \""+e+'" to event handle!'))}},ke=async({condition:t,name:e,value:n,context:a})=>{const{resolver:i,content:r,template:s}=a;let o=t?s.attr(e):n;t=t?n:s.attr("?"+e);const c=Ve(o);t&&c?!0===(t=await i.resolve(t,!1))&&r.attr(e,await i.resolveText(o,o)):t?!0===(t=await i.resolve(t,!1))&&r.attr(e,!0):c&&r.attr(e,await i.resolveText(o,o))},Ve=t=>null!=t&&void 0!==t,Re=async({condition:t,name:e,value:n,context:a})=>{const{resolver:i,template:r,content:s}=a;let o=(t=t?n:r.attr("?@"+e))?r.attr("@"+e):n,c=e.split(":");const l=c.shift(),u=(c.shift()||Pe).toLowerCase();void 0!==o&&null!=o||console.error(`Definition of "${l}" - event handle at`,s,"is incorrect!"),o=o.trim();const h={bubble:!0};t?1==await i.resolve(t,!1)&&await Se(l,o,h,u,i,s,c,a):await Se(l,o,h,u,i,s,c,a)},Se=async(t,e,n,a,i,r,s,o)=>{const c=Oe[a];if(c)return c(t,e,n,a,i,r,s,o)},Ce=function(t,e){return function(e){e.preventDefault(),e.stopPropagation(),e.currentTarget?e.currentTarget.trigger(t,e):e.target.trigger(t,e)}};se.define({directive:new class extends se{constructor(){super()}get name(){return"attribute"}get rank(){return se.MIN_RANK}get phase(){return se.PHASE.content}async execute(t){const{template:e}=t;if(!(e instanceof HTMLElement))return t;const n=new Set($e);for(const a of e.attributes){const[,e,i,r,s]=Me.exec(a.name);if(!e&&!n.has(s)){const e=a.value;r?await Re({condition:i,event:r,name:s,value:e,context:t}):await ke({condition:i,name:s,value:e,context:t})}n.add(s)}return t}}});const Ie="jstl-attach-element",He="replace",je=/^#.+$/;se.define({directive:new class extends se{constructor(){super()}get name(){return"attach-element"}get rank(){return se.MIN_RANK+1}get phase(){return se.PHASE.content}async execute(t){const{resolver:e,template:n,content:a}=t;if(!(n instanceof HTMLElement&&n.attr(Ie)))return t;try{let i=await(async(t,e)=>{let n=(t.attr(Ie)||"").trim();if(!je.test(n)){try{n=await e.resolve(n,n)}catch(t){}if(n instanceof HTMLElement)return n}try{n=find(n)}catch(t){}return n&&n.length>0?0==n.length?n.first():n:null})(n,e);if(i){const e=n.attr("jstl-attach-element-mode")||He;e==He?(a.empty().append(i),t.stop=!0,t.ignore=!0):t.ready((({content:t})=>{t&&("append"==e?t.append(i):"prepend"==e&&t.prepend(i))}))}}catch(e){console.log(e,{context:t})}return t}}});const ze="on-finished",Ue=`jstl-${ze}`,_e=`${Ue}-async`;se.define({directive:new class extends se{constructor(){super()}get name(){return ze}get rank(){return se.MAX_RANK}get phase(){return se.PHASE.finish}async execute(t){const{template:e,content:n,root:a}=t;if(!(e instanceof HTMLElement&&e.hasAttribute(Ue)))return t;const i=e.attr(Ue),r=e.hasAttribute(_e),s=new Vt({context:{$element:n,$root:a,$template:e},name:"jstl-data",parent:t.resolver});return t.finished((async()=>{try{if(!r)return s.resolve(i,null);s.resolve(i,null)}catch(t){console.error(t)}})),t}}});const qe="data",Fe="render",Ke="container",Ge="node",Be=new Vt({name:"application"}),Xe={replace:async({container:t,target:e=null,content:n})=>{e?e.replace(n):(t.empty(),t.append(n))},append:async({container:t,target:e=null,content:n})=>{e?e.after(n):t.append(n)},prepend:async({container:t,target:e=null,content:n})=>{e?e.before(n):t.prepend(n)}},We=async t=>{try{let{template:e,renderer:n}=t;e instanceof ue?await e.execute(t):await Je(t);const{ignore:a,content:i}=t;if(!a&&i){let{resolver:e}=t;const a=t.template.childNodes;if(a&&a.length>0){const r=new Vt({name:Ke,context:null,parent:e}),s=await n.render(t.subContext({container:i,template:a,resolver:r}));await s.ready()}}t.content&&t.content.tagName&&"JSTL"==t.content.tagName&&(t.content=t.content.childNodes)}catch(e){console.error("error at render node:",e,t)}return t},Je=async t=>{const e=se.directives,n=e.length;for(let a=0;a<n&&!t.stop;a++){const n=e[a];try{t.acceptDirective(n)&&await n.execute(t)}catch(e){console.error("error at directive:",e,n,t)}}return t};class Ze{constructor({template:t,data:e}={}){if(t&&!(t instanceof Ht))throw new Error("template must be an instance of Template!");this.template=t,this.resolver=new Vt({name:qe,context:e||{},parent:Be})}async render(t){const e=t instanceof le;if(e){if(t.closed)throw new Error("calling with closed context",t)}else{let{template:e=null,data:n=null,container:a,root:i,mode:r,target:s}=t;e=await(async(t,e)=>{if(t)return(t=await Ht.load(t)).importContent();if(e.template)return await e.template.importContent();throw new Error("No content template specified!")})(e,this);const o=new Vt({name:Fe,context:n,parent:this.resolver});t=new le({resolver:o,renderer:this,template:e,container:a,root:i||a,mode:r||"replace",target:s})}return t.template instanceof Node?await We(t):await(async t=>{let{template:e,resolver:n}=t;if(!e||0==e.length)return t;let a=[];for(let i of e){i.normalize();const e=new Vt({name:Ge,context:null,parent:n}),r=await We(t.subContext({template:i,resolver:e}));await r.ready();const s=r.content;s&&(s instanceof Array&&(a=a.concat(s)),s instanceof NodeList||s instanceof HTMLCollection?a=a.concat(Array.from(s)):s instanceof Node&&a.push(s))}return t.content=0!=a.length?a:null,t})(t),await(async t=>{if(t.content){const e=Xe[t.mode];if(!e)throw new Error('The "'+t.mode+'" is not supported!');await e(t)}})(t),e||await t.ready(),t}static async build({template:t,data:e}={}){return t&&t instanceof Promise&&(t=await t),t=t?await Ht.load(t):null,new Ze({template:t,data:e})}static async render({container:t,data:e,template:n,mode:a,target:i}){return new Ze({template:n,data:e}).render({container:t,mode:a,target:i})}}const Qe=gt("app"),Ye=gt("route"),tn=new class{constructor(){Z(this,"weakmap",new WeakMap)}data(t){let e=this.weakmap.get(t);return e||(e={},this.weakmap.set(t,e)),e}value(t,e,n){if(2==arguments.length)return this.data(t)[e];void 0===n?delete this.data(t)[e]:this.data(t)[e]=n}destroy(){this.weakmap.delete(reference)}},en="name",nn=[en];class an extends ot{static get observedAttributes(){return nn}static get NODENAME(){return ae}constructor(t){super(t||{})}get name(){return this.attr(en)}get app(){return Qe(this)}set app(t){Qe(this,t)}get route(){return Ye(this)}async display({route:t,context:e,view:n,refresh:a=!1}){if(n)throw new Error("you must override the display function!");Ye(this,t);const{root:i,app:r}=this;i.empty();let s=t.stateful?tn.value(t,"component"):null;a||!s?(s=await t.component(),s instanceof Ht?(await Ze.render({container:i,data:{$view:this,$app:r,$store:r.store,$route:t,$context:e},template:s}),s=NodeList.from(i.childNodes)):(s instanceof an&&(s.app=r,s.ready.then((()=>{s.display({route:t,context:e,view:this})}))),i.append(s)),t.stateful&&tn.value(t,"component",s)):(s instanceof an&&(s.app=r,s.ready.then((()=>{s.display({route:t,context:e,view:this})}))),i.append(s))}}lt(an);const rn=an,sn=gt("view"),on=gt("store"),cn=ct("application"),ln="route",un="view",hn=(t,e)=>{const n=`${Jt.NODENAME}[name="${e}"]`;return t.find(n).first()},dn=(t,e)=>{let n=null;if(e){const a=t.root.find(`d-view[name="${e}"]`).first();a&&1==a.length&&(n=a.first())}return n||(n=((t,e)=>ht(t.root,(t=>t instanceof rn&&(null==e||t.name==e))))(t,e)),n&&(n.app=t),n},pn=async(t,e)=>{try{return Vt.resolve(t,e.store,null)}catch(t){return null}},fn=[ln,un];class gn extends ot{static get observedAttributes(){return fn}static get NODENAME(){return cn}constructor(t){super(t||{}),this.root.on([wt,Et],(async t=>{this.route({route:t.target})})),this.on(nt(ln,this),(()=>{this.hasAttribute(ln)&&this.route({route:this.attr(ln)})}))}async init(){await super.init(),this.ready.then((()=>{this.hasAttribute(ln)&&this.route({route:this.attr(ln)})}))}async routes(){return this.root.find(Jt.NODENAME)}async route({route:t,refresh:e=null,context:n=null,view:a=null}){if(await this.ready,0==arguments.length)return this.view.route;if("string"==typeof t)t=hn(this,t);else if(t instanceof ne)e=null!=e?e:t.refresh,null==n&&(n=await pn(t.context,this)),null==a&&(a=t.view),t=hn(this,t.target);else if(!(t instanceof Jt))throw new Error("Unsupported route type!");null==e&&(e=!1),null==a&&(a=t.view),a=a?dn(this,a):this.view,(e||a.route!=t)&&(null==n&&(n=await pn(t.context,this)),a.route&&(a.route.active=!1),await a.display({route:t,context:n,refresh:e}),t.active=!0)}get view(){let t=sn(this);return t||(t=dn(this,this.attr(un)),sn(this,t),t.app=this),t}get store(){let t=on(this);return t||(t={},on(this,t)),t}}lt(gn);if(window.Date.prototype.addDays=function(t){const e=new Date(this);return e.setDate(e.getDate()+t),e},"serviceWorker"in navigator){navigator.serviceWorker.register("./serviceworker.js",{scope:"./"}).then((t=>{t.installing?console.log("Service worker installing"):t.waiting?console.log("Service worker installed"):t.active&&console.log("Service worker active")})).catch((t=>{console.log("Registration failed with "+t)}))}class mn extends(st(HTMLDialogElement)){static get NODENAME(){return"x-dialog"}constructor(){super(),this.on("click",(({target:t})=>{t.is("[close-modal]")&&this.close()}))}async init(){await super.init()}hide(){this.close()}}lt(mn,{extends:"dialog"});class yn extends ot{static get NODENAME(){return"x-login-component"}constructor(){super()}async init(){await super.init();const t=await b();if(t){const e=this.attr("template");if(e){const n=await Ht.load(new URL(e,location));await Ze.render({container:this,data:{user:t},template:n})}}else this.textContent="kein Zugriff erlaubt"}}lt(yn);const wn="x-clan",vn=new URL(`${u}/html-clan-element/root.tpl.html`,location);class bn extends ot{static get NODENAME(){return wn}#b=!1;#k=null;constructor(){super(),this.on(`${wn}:sort-member-by-name`,(()=>{})),this.on(`${wn}:sort-member-by-wtr`,(()=>{}))}async init(){if(await super.init(),!this.#b){const t=await Ht.load(vn);await Ze.render({container:this.root,template:t,data:await this.clanData()})}}async clanData(){if(!this.#k){this.#k={id:this.attr("clan-id"),name:this.attr("clan-name"),tag:this.attr("clan-tag")};let t=await fetch(new URL(`/api/clans/${this.#k.id}/members`,location));t=await t.json(),this.#k.members=t.data}return this.#k}}lt(bn);const xn=async(t,e)=>{const n=await fetch((t=>t instanceof URL?t:new URL(t,location))(t),e);return n.ok&&n.status>=400?await b():n},En=async t=>{const e=await xn(t,{headers:{"content-type":"application/json"}});if(e.status<204)return e.json()},An=async(t,e)=>{const n=await xn(t,{method:"post",headers:{"content-type":"application/json"},body:JSON.stringify(e)});if(n.status<204)return n.json()},Nn=async t=>{await xn(t,{method:"delete",headers:{"content-type":"application/json"}})},Tn="/api/members";let Dn=!1;const Mn=new Map,Pn=`${u}/html-member-element`,Ln=Ht.load(new URL(`${Pn}/root.tpl.html`,location));class $n extends ot{static get NODENAME(){return"x-member"}#b=!1;constructor(){super();this.root}async init(){await super.init(),this.#b||(await this.render(),this.#b=!0)}get memberId(){return parseInt(this.attr("member-id"))}async render(){const t=await Ln,e=await(async t=>{if(Mn.has(t))return Mn.get(t);const e=await En(`${Tn}/${t}`);return e&&Mn.set(e.id,e),e})(this.memberId);await Ze.render({container:this.root,template:t,data:{member:e}})}}lt($n);const On="/api/campaigns",kn=new Map,Vn=async()=>{let t=null;if(0==kn.size){t=(await En(On)).data;for(const e of t)kn.set(e.id,e)}else{t=[];for(const[e,n]of kn)t.push(n)}return t},Rn=async t=>{if(kn.has(t))return kn.get(t);const e=await En(`${On}/${t}`);return kn.set(e.id,e),e},Sn=async t=>(t=await An(`${On}`,t),kn.set(t.id,t),t),Cn="d-",In=500,Hn=`${Cn}form`,jn=`${Cn}submit-action`,zn=`${Cn}page`,Un=`${Cn}field`,_n=`${Cn}container`,qn=`${Cn}list`,Fn=`${Cn}rows`,Kn=`${Cn}row`,Gn=`${Cn}add-row`,Bn=`${Cn}delete-row`,Xn=`${Cn}progress-bar`,Wn=`${Cn}step`,Jn=`${Cn}validation`,Zn=`${Cn}message`,Qn=`${Cn}control`,Yn=`${Cn}control-back`,ta=`${Cn}control-next`,ea=`${Cn}control-summary`,na=`${Cn}control-submit`,aa="init",ia="validating",ra="input",sa="summary",oa="finished",ca="d-form-",la=`${ca}initialized`,ua=`${`${ca}initialize`}submit-action`,ha=`${ca}submit`,da=`${ca}submit-results`,pa=`${ca}condition-state-changed`,fa=`${ca}site-changed`,ga=`${ca}state-changed`,ma=`${ca}field-input`,ya=`${ca}list-row-add`,wa=`${ca}list-row-delete`,va=`${ca}progress-bar-changed`,ba=`${ca}field-initialized`,xa=`${ca}field-removed`,Ea=`${ca}page-initialized`,Aa=`${ca}page-removed`,Na=`${ca}validation-initialized`,Ta=`${ca}validation-removed`,Da=`${ca}message-initialized`,Ma=`${ca}message-removed`,Pa=`${ca}active-state-changed`,La=`${ca}valid-state-changed`,$a=`${ca}editable-state-changed`,Oa="$value",ka="$item",Va="name",Ra="endpoint",Sa="method",Ca="state",Ia="step",Ha="use-summary-page",ja="input-mode-after-submit",za="required",Ua="condition",_a="active",qa="disabled",Fa="editable",Ka="editable-condition",Ga="readonly",Ba="no-value",Xa="valid",Wa="invalid",Ja="evaluate",Za="condition-valid",Qa="condition-invalid",Ya="min",ti="max",ei="progress";const ni=class{#V;#d;constructor(t){this.#V=t}get condition(){return this.#d||(this.#d=this.#V.attr(Ua)||!1),this.#d}async validate(t){const e=this.#V;let n=this.condition;const a=e.condition;return n=!n||await Vt.resolve(n,t,!1),n!=a&&(e.condition=n),n}};const ai=class{#V;#d=null;constructor(t){this.#V=t}get condition(){return null==this.#d&&(this.#d=this.#V.attr(Ka)||""),this.#d}async validate(t){let e=!0;const n=this.#V.editable;return this.condition&&(e=await Vt.resolve(this.condition,t,!1)),e!=n&&(this.#V.editable=e),e}};const ii=class{#V;#R=new Set;#S=new Set;constructor(t){this.#V=t,t.on(Na,(t=>{t.stopPropagation(),this.#R.add(t.target)})),t.on(Ta,(t=>{t.stopPropagation(),this.#R.delete(t.target)}))}addCustomValidation(t){this.#S.add(t)}async validate(t){const e=this.#V,n=this.#S,a=this.#R,{hasValue:i,required:r,condition:s,editable:o}=(this.#V.valid,this.#V);let c=!0;if(s){c=!r||i,await(async(t,e,n)=>{let a=!0;for(let i of t)await i({data:e,base:n})||(a=!1);return a})(n,t,e)||(c=!1);for(let e of a)if(c&&i){const n=await Vt.resolve(e.condition,t,!0);e.active=!n,n||(c=!1)}else e.active=!1}return e.valid=c,c}};const ri=class{#C=new Set;constructor(t){t.on(Da,(t=>{t.preventDefault(),t.stopPropagation();const e=t.target;this.#C.add(e)})),t.on(Ma,(t=>{t.preventDefault(),t.stopPropagation();const e=t.target;this.#C.delete(e)}))}async validate(t){for(let e of this.#C)e.update(t)}},si=t=>null==t||void 0===t,oi=async(t,e,n)=>(si(n)||(e?ui(t,e,n):Object.assign(t,n)),t),ci=async(t,e)=>{let n={};if(e)for(let a of e){const e=a.name,i=t.get(a);n=await oi(n,e,i)}else for(let[{name:e},a]of t)n=await oi(n,e,a);return n},li=/\./g,ui=function(t,e,n){const a=e.split(li);if(2==arguments.length)return di(t,a);const i=si(n);return si(t)&&i?t:hi(i,t,n,a)},hi=(t,e,n,a)=>{if(si(e)&&t)return null;const i=a.shift();return 0==a.length?t?delete e[i]:e[i]=n:(si(e[i])&&(e[i]={}),hi(t,e[i],n,a)),e},di=(t,e)=>{if(si(t))return null;if(0==e.length)return t;const n=e.shift();return di(t[n],e)},pi=(t,e,n=!1)=>{const a=t.active;e?t.attr(_a,""):t.attr(_a,null),(a!=e||n)&&t.trigger(Pa)},fi=(t,e,n=!1)=>{const a=t.readonly;e?t.attr(Ga,""):t.attr(Ga,null),(a!=e||n)&&t.trigger($a)},gi=gt("form"),mi=[_a,Ga,Ua,Za,Qa,Ka];const yi=class extends ot{static get observedAttributes(){return mi}#I;#H;#j;#z;constructor(){super(),this.#z=new ri(this),this.#I=new ni(this),this.#H=new ai(this),this.#j=new ii(this)}addValidation(t){this.#j.addCustomValidation(t)}async validate(t){this.attr(Ja,"");const e=Object.assign({},t,await(async t=>{await t.ready;const e={};e[Oa]=vi(t);let n=t.parent(Kn),a=e;for(;n;)a[ka]=await vi(n),a=a[ka],n=n.parent(Kn);return e})(this));return await this.#I.validate(e),await this.#H.validate(e),await this.#j.validate(e),this.attr(Ja,null),await this.#z.validate(e),this.valid}get form(){let t=gi(this);return t||(t=this.parent(Hn),gi(this,t)),t}get active(){return this.hasAttribute(_a)}set active(t){this.active!=t&&(pi(this,t),this.activeUpdated())}async activeUpdated(){}get readonly(){return this.hasAttribute(Ga)}set readonly(t){this.editable?fi(this,t,!this.ready.resolved):fi(this,!0,!this.ready.resolved),this.readonlyUpdated()}async readonlyUpdated(){}get editable(){return this.hasAttribute(Fa)}set editable(t){((t,e,n=!1)=>{const a=t.editable;e?t.attr(Fa,""):t.attr(Fa,null),(a!=e||n)&&t.trigger($a)})(this,t,!this.ready.resolved),this.editableUpdated(),this.readonly=!t}async editableUpdated(){}set condition(t){var e,n;e=this,void 0===(n=t)||null==n?(e.attr(Qa,null),e.attr(Za,null)):n?(e.attr(Qa,null),e.attr(Za,"")):(e.attr(Za,null),e.attr(Qa,"")),e.trigger(pa),this.conditionUpdated()}get condition(){return!this.hasAttribute(Qa)}async conditionUpdated(){}set valid(t){((t,e)=>{void 0===e||null==e?(t.attr(Wa,null),t.attr(Xa,null)):e?(t.attr(Wa,null),t.attr(Xa,"")):(t.attr(Wa,""),t.attr(Xa,null)),t.trigger(La)})(this,t),this.validUpdated()}get valid(){return this.hasAttribute(Xa)}async validUpdated(){}},wi=gt("parent"),vi=gt("value"),bi=[Va,za,Ba];class xi extends yi{static get observedAttributes(){return bi.concat(yi.observedAttributes)}constructor(t={}){super(t);const{value:e}=t;vi(this,e||null)}async init(){this.ready.then((()=>this.trigger(ba))),await super.init()}async destroy(){this.publishValue(null),await super.destroy(),this.trigger(xa)}get parentField(){let t=wi(this);return t||(t=(t=>{let e=t.parentNode;for(;e;){if(e instanceof xi)return e;e=e.parentNode}return null})(this),wi(this,t)),t}async conditionUpdated(){return this.active=this.condition,this.publishValue()}get name(){return this.getAttribute(Va)}get required(){return this.hasAttribute(za)}get hasValue(){return!this.hasAttribute(Ba)}async value(t){const{condition:e,valid:n,ready:a}=this;if(0==arguments.length)return e&&n?vi(this):null;await a;const i=vi(this);if(await this.acceptValue(t)&&i!=(t=await this.normalizeValue(t)||t)){const e=await this.updatedValue(t);void 0!==e&&(t=e),await this.publishValue(t)}}async validate(t){const e=this.condition,n=this.valid,a=await super.validate(t),i=this.condition;return this.validationStateChanged(e!=i,n!=a),a}async validationStateChanged(t,e){(t||e)&&this.publishValue()}async updatedValue(t){return t}async publishValue(t){await this.ready,0==arguments.length&&(t=vi(this));const e=(t=>{if(si(t))return!0;const e=typeof t;return"string"===e&&0==t.trim().length||!(t instanceof Date)&&(t instanceof Array&&0==t.length||t instanceof Set&&0==t.length||t instanceof Map&&0==t.length||"object"==e&&0==Object.getOwnPropertyNames(t).length)})(t),n=this.condition;var a;t=this.required&&e?null:t,n?vi(this,t):t=null,a=!e,this.attr(Ba,a?null:""),this.parentField?await this.parentField.childValueChanged(this,t):this.form&&await this.form.childValueChanged(this,t)}async acceptValue(t){return!0}async normalizeValue(t){return t}async childValueChanged(t,e){}}const Ei=xi,Ai=(t,e,n,a)=>{let i=null;const r="function"==typeof e?e:()=>e,s="function"==typeof n?n:()=>n;return e=>{r(e)&&e.preventDefault(),s(e)&&e.stopPropagation();const n=(t=>({type:t.type,target:t.target,detail:t.detail,currentTarget:t.currentTarget,explicitOriginalTarget:t.explicitOriginalTarget,originalTarget:t.originalTarget,srcElement:t.srcElement,timeStamp:t.timeStamp}))(e);i&&clearTimeout(i),i=setTimeout((()=>{i=null,t(n)}),a||10)}};class Ni{static findInput(t){return null}#U;constructor(t,e){this.field=t,this.input=e,this.init()}init(){}set readonly(t){}async acceptValue(t){return!0}async normalizeValue(t){return t}async updatedValue(){}get value(){return null}get valid(){return!0}}const Ti="text",Di=t=>({accept:t=>"number"==typeof t,getValue:()=>t.valueAsNumber,setValue:e=>{t.valueAsNumber=e},normalize:t=>si(t)||Number.isNaN(t)?null:t}),Mi=t=>({accept:t=>"string"==typeof t,getValue:()=>t.value,setValue:e=>{t.value=e},normalize:t=>t||null}),Pi=new Intl.DateTimeFormat("default",{hour:"numeric",minute:"numeric"}),Li={text:t=>({accept:t=>"string"==typeof t,getValue:()=>t.value,setValue:e=>t.value=e,normalize:t=>t&&(t=t.trim()).length>0?t:null}),number:Di,datetime:Mi,"datetime-locale":Mi,date:t=>({accept:t=>t instanceof Date,getValue:()=>t.valueAsDate,setValue:e=>{t.valueAsDate=e},normalize:t=>t||null}),time:t=>({accept:t=>t instanceof Date,getValue:()=>t.value?new Date(`1970-01-01T${t.value}`):null,setValue:e=>{t.value=Pi.format(e)},normalize:t=>t||null}),range:Di};const $i=gt("value"),Oi=(t,e)=>new Promise(((n,a)=>{const i=new FileReader;i.addEventListener("loadend",(()=>{n({name:t.name,type:t.type,size:t.size,data:i.result})}),!1),i[e](t)})),ki={"form-input":async t=>(t.format="form-input",t),"data-url-base64":async t=>{const e=await Oi(t,"readAsDataURL");return e.format="data-url-base64",e},base64:async t=>{const e=await Oi(t,"readAsDataURL");return e.data=e.data.substr(e.data.indexOf(",")+1),e.format="base64",e}},Vi=async(t,e,n)=>{let a=[];for(let n of t)a.push(await ki[e](n));return 0==a.length?null:n?a:a[0]};const Ri=[class extends Ni{static findInput(t){return t.find('input:not([type="file"],[type="radio"],[type="checkbox"],[type="button"],[type="submit"],[type="reset"]),input:not([type]), textarea').first()}constructor(t,e){super(t,e)}init(){const{field:t,input:e}=this,n=(t.attr("input-type")||e.attr("type")||Ti).trim().toLowerCase();this.type=(Li[n]||Li[Ti])(e),e.on("input",Ai((()=>{t.trigger(ma,this.normalizeValue(this.value))}),!1,!0,In)),t.trigger(ma,this.normalizeValue(this.value))}acceptValue(t){return null==t||void 0===t||this.type.accept(t)}normalizeValue(t){return null==t&&void 0===t?null:this.type.normalize(t)}async updatedValue(t){t!=this.type.getValue()&&this.type.setValue(t)}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){return this.type.getValue()}get valid(){return this.input.checkValidity()}},class extends Ni{static findInput(t){const e=t.find('input[type="checkbox"]');return 0==e.length?null:1==e.length?e.first():e}constructor(t,e){super(t,e)}init(){const{field:t,input:e}=this;this.multiple=e instanceof NodeList,e.on("input",Ai((()=>{t.trigger(ma,this.normalizeValue(this.value))}),!1,!0,In)),t.trigger(ma,this.normalizeValue(this.value))}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){const t=this.input.val();if(!(t instanceof Map))return t;if(0==t.size)return null;const e=[];return t.forEach((t=>{e.push(t)})),e}normalizeValue(t){return t?this.multiple?0!=(t=t.filter((t=>!!t))).length?t:null:t:null}acceptValue(t){if(null==t||void 0===t)return!0;if(this.multiple)return t instanceof Array;{const e=typeof t;return"string"===e||"boolean"===e}}updatedValue(t){this.input.val(t||null)}},class extends Ni{static findInput(t){const e=t.find('input[type="radio"]');return 0==e.length?null:e}constructor(t,e){super(t,e)}init(){const{field:t,input:e}=this,n=t.name+Math.floor(Math.random()*Date.now());for(let t of e)t.name=n;e.on("input",Ai((()=>{t.trigger(ma,this.normalizeValue(this.value))}),!1,!0,In)),t.trigger(ma,this.normalizeValue(this.value))}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){const t=this.input.val();return t instanceof Map?0==t.size?null:t.values().next().value:t}normalizeValue(t){return t||null}acceptValue(t){if(null==t||void 0===t)return!0;{const e=typeof t;return"string"===e||"boolean"===e}}updatedValue(t){this.input.val(t||null)}},class extends Ni{static findInput(t){return t.find('input[type="file"]').first()}constructor(t,e){super(t,e)}async init(){const{field:t,input:e}=this;this.multiple=e.multiple,this.format=t.attr("file-format")||"form-input",this.filenameTarget=t.attr("file-name-target"),this.filenameTarget=this.filenameTarget?t.find(this.filenameTarget).first():null;const{format:n,multiple:a}=this;e.on("input",Ai((async()=>{this.updatedValue(await Vi(e.files,n,a)),t.trigger(ma,this.value)}),!1,!0)),e.files&&0!=e.files.length&&this.updatedValue(await Vi(e.files,n,a)),t.trigger(ma,this.value)}set readonly(t){this.input.attr("disabled",t?"":null)}acceptValue(t){return null==t||void 0===t||(this.multiple?t instanceof Array:"object"==typeof t)}normalizeValue(t){return null==t||void 0===t?null:this.multiple?0!=t.length?t:null:t}updatedValue(t){if(t!=$i(this)){$i(this,t),t||(this.input.value=null);const e=this.filenameTarget;if(e&&(e.empty(),t))if(this.multiple)for(let n of t)e.append(`<span>${n.name}</span>`);else e.append(`<span>${t.name}</span>`)}}get value(){return $i(this)}get valid(){return this.input.checkValidity()}},class extends Ni{static findInput(t){return t.find("select").first()}constructor(t,e){super(t,e)}init(){const{field:t,input:e}=this;e.on("input, changed",Ai((()=>{t.trigger(ma,this.value)}),!1,!0,In))}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){return this.normalizeValue(this.input.multiple?this.input.val():this.input.value)}normalizeValue(t){return t?this.input.multiple?0!=(t=t.filter((t=>t&&t.trim().length>0))).length?t:null:0!=(t=t.trim()).length?t:null:null}acceptValue(t){return null==t||void 0===t||(this.input.multiple?t instanceof Array:"string"==typeof t)}updatedValue(t){const e=this.input.val();this.field.value!=this.value&&this.input.val(t||e)}}],Si=["file-format"];class Ci extends Ei{static get observedAttributes(){return Si.concat(Ei.observedAttributes)}static get NODENAME(){return Un}#b=!1;#_;constructor(t){super(t),this.on(ma,(t=>{t.preventDefault(),t.stopPropagation(),this.publishValue(t.detail||null)}))}async init(){await super.init(),this.#b||(this.#b=!0,this.#_=(t=>{for(let e of Ri){const n=e.findInput(t);if(n)return new e(t,n)}return null})(this),this.#_&&(this.addValidation((async()=>this.#_.valid)),this.publishValue(this.#_.value)))}readonlyUpdated(){this.#_&&(this.#_.readonly=this.readonly)}async acceptValue(t){return!!this.#_&&this.#_.acceptValue(t)}async normalizeValue(t){return this.#_?this.#_.normalizeValue(t):t}async updatedValue(t){await this.ready,t=await t;const e=this.#_;if(e){(e.value||null)!=t&&await e.updatedValue(t)}await super.updatedValue(t)}async validationStateChanged(t,e){if(t&&this.condition){const t=this.#_.value||null;vi(this,t)}return super.validationStateChanged(t,e)}}lt(Ci);const Ii=[_a,Ua];class Hi extends ot{static get observedAttributes(){return Ii}static get NODENAME(){return Jn}constructor(){super()}async init(){await super.init(),this.active=!1,this.ready.then((()=>this.trigger(Na)))}async destroy(){this.trigger(Ta),await super.destroy()}get active(){return this.hasAttribute(_a)}set active(t){t?this.attr(_a,""):this.attr(_a,void 0)}get condition(){return this.attr(Ua)}}lt(Hi);const ji=({root:t,filter:e})=>{let n=[];return t.children.forEach((t=>{const{accept:a,stop:i=!1}=e(t);if(a&&n.push(t),!i){const a=ji({root:t,filter:e});a instanceof Array?n=n.concat(a):a&&n.push(a)}})),n},zi=async(t,e)=>(await Promise.all(e.map((e=>e.validate(t))))).reduce(((t,e)=>!!t&&e),!0),Ui=[];class _i extends Ei{static get observedAttributes(){return Ui.concat(Ei.observedAttributes)}static get NODENAME(){return _n}#q=null;#F=new Map;constructor(t){super(t);const e=this.root;e.on(ba,(t=>{const e=t.target;e!=this&&(!(e instanceof Ei)||this.#q&&this.#q.has(e)||(this.#q=null),t.stopPropagation())})),e.on(xa,(t=>{const e=t.target;e!=this&&(e instanceof Ei&&this.#q&&this.#q.has(e)&&this.#q.delete(e),t.stopPropagation())})),this.addValidation((async({data:t})=>await zi(t,this.fields)))}get fields(){return this.#q||(this.#q=new Set(ji({root:this,filter:t=>t instanceof Ei?{accept:!0,stop:!0}:{accept:!1}}))),Array.from(this.#q)}readonlyUpdated(){const{readonly:t,fields:e}=this;if(e)for(let n of e)n.readonly=t}async updatedValue(t){await this.ready;const e=this.#F;e.clear();const n=this.fields;n&&await Promise.all(n.map((async n=>{const a=n.name?ui(t,n.name):t;si(a)||e.set(n,a),await n.value(a)})));let a=await ci(this.#F,n);return 0==Object.getOwnPropertyNames(a).length&&(a=null),a}async childValueChanged(t,e){e=await e;const n=this.#F;if(t){const a=n.has(t),i=null==n.get(t);if(a&&i==e)return;si(e)?n.delete(t):n.set(t,e)}let a=await ci(n,this.fields);0==Object.getOwnPropertyNames(a).length&&(a=null),await this.publishValue(a)}}lt(_i);const qi=_i,Fi=[_a,qa];const Ki=class extends ot{static get observedAttributes(){return Fi}#b=!1;#K;constructor(){super(),this.on("click",(t=>{t.preventDefault(),t.stopPropagation(),this.active&&!this.disabled&&this.execute()}))}async init(){await super.init(),this.#b&&(this.active=!1,this.disabled=!1,this.#b=!0)}get form(){return this.#K||(this.#K=this.parent(Hn)),this.#K}get active(){return this.hasAttribute(_a)}set active(t){this.attr(_a,t?"":null)}get disabled(){return this.hasAttribute(qa)}set disabled(t){this.attr(qa,t?"":null)}execute(){console.log("execute")}},Gi=[];class Bi extends Ki{static get observedAttributes(){return Gi.concat(Gi)}static get NODENAME(){return Bn}constructor(){super()}async init(){await super.init(),this.active=!0}execute(){this.trigger(wa)}}lt(Bi);const Xi=[];class Wi extends qi{static get observedAttributes(){return Xi.concat(qi.observedAttributes)}static get NODENAME(){return Kn}constructor(t){super(t)}get active(){return!0}set active(t){}get condition(){return!0}get name(){return null}}customElements.define(Wi.NODENAME,Wi);const Ji=`${Gn}:initialized`,Zi=[];class Qi extends Ki{static get observedAttributes(){return Zi.concat(Zi)}static get NODENAME(){return Gn}constructor(){super(),this.ready.then((()=>this.trigger(Ji)))}async init(){await super.init(),this.active=!0}execute(){this.trigger(ya)}}lt(Qi);const Yi=[];class tr extends ot{static get observedAttributes(){return Yi}static get NODENAME(){return Fn}constructor(){super()}}lt(tr);const er=[Ya,ti],nr=async(t,e)=>{let n=[];for(let a of t)n.push(e.get(a));return 0==n.length&&(n=null),n};class ar extends Ei{static get observedAttributes(){return er.concat(Ei.observedAttributes)}static get NODENAME(){return qn}#D;#G;#B=new Map;#X;#b=!1;constructor(t){super(t);const e=this.root;e.on(Ji,(t=>{this.#X=t.target,t.stopPropagation()})),e.on(ba,(t=>{t.target!=this&&(t.preventDefault(),t.stopPropagation())})),e.on(ya,(t=>{t.preventDefault(),t.stopPropagation();const{readonly:e}=this;e||this.createRow()})),e.on(wa,(t=>{t.preventDefault(),t.stopPropagation();const{rows:e,readonly:n}=this;if(!n){const n=t.target.parent(Kn);e.indexOf(n)>=0&&n.remove()}})),this.addValidation((async()=>{const{rows:t,min:e,max:n,readonly:a}=this,i=t.length;return this.#X&&!a&&(i==n?this.#X.disabled=!0:i<n&&(this.#X.disabled=!1)),e<=i&&i<=n})),this.addValidation((async t=>await zi(t,this.rows)))}async init(){if(await super.init(),!this.#b){this.#b=!0;const t=this.find("template").first();t&&(this.#D=t.content),this.#G=this.find(Fn).first()}}readonlyUpdated(){const{readonly:t}=this;for(let e of this.rows)e.readonly=t}get rows(){return this.#G?Array.from(this.#G.children):[]}get min(){return this.hasAttribute(Ya)?Math.max(0,parseInt(this.attr(Ya))):0}get max(){return this.hasAttribute(ti)?parseInt(this.attr(ti)):Number.MAX_SAFE_INTEGER}acceptValue(t){return!t||t instanceof Array}normalizeValue(t){return t?t.filter((t=>!!t)):null}async createRow(t){const e=document.importNode(this.#D,!0).children[0];return await this.#G.append(e),t&&await e.value(t),e}async updatedValue(t){return this.#B.clear(),this.#G.empty(),t&&await Promise.all(t.map((t=>this.createRow(t)))),await nr(this.rows,this.#B)}async childValueChanged(t,e){e=await e;const n=this.#B;si(e)?this.#B.delete(t):this.#B.set(t,e),await super.childValueChanged(t,e);const a=await nr(this.rows,n);await this.publishValue(a)}}lt(ar);const ir=[Ia];class rr extends qi{static get observedAttributes(){return ir.concat(qi.observedAttributes)}static get NODENAME(){return zn}constructor(t){super(t),this.ready.then((()=>this.trigger(Ea)))}async destroy(){this.trigger(Aa),await super.destroy()}get step(){return this.attr(Ia)}conditionUpdated(){}}lt(rr);const sr="active",or="condition",cr=[sr,or];class lr extends ot{static get observedAttributes(){return cr}static get NODENAME(){return Zn}constructor(){super()}async init(){await super.init(),this.trigger(Da)}async destroy(){this.trigger(Ma),await super.destroy()}get active(){return this.hasAttribute(sr)}set active(t){t?this.attr(sr,""):this.attr(sr,void 0)}get condition(){return this.attr(or)}async update(t){await this.ready,this.active=await Vt.resolve(this.condition,t,!1)}}lt(lr);const ur=[];class hr extends Ki{static get observedAttributes(){return ur}static get NODENAME(){return Yn}constructor(){super()}execute(){this.form.toPrevPage()}}lt(hr);const dr=[];class pr extends Ki{static get observedAttributes(){return dr}static get NODENAME(){return ta}constructor(){super()}execute(){this.form.toNextPage()}}lt(pr);const fr=[];class gr extends Ki{static get observedAttributes(){return fr}static get NODENAME(){return ea}constructor(){super()}execute(){this.form.toNextPage()}}lt(gr);const mr=[];class yr extends Ki{static get observedAttributes(){return mr}static get NODENAME(){return na}constructor(){super()}execute(){this.form.submit()}}lt(yr);const wr={active:!0,disabled:!0},vr=[];class br extends ot{static get observedAttributes(){return vr}static get NODENAME(){return Qn}#K;#W;#J;#Z;#Q;#b=!1;constructor(){super()}async init(){await super.init(),this.#b||(this.#K=this.parent(Hn),this.#W=this.find(Yn).first()||wr,this.#J=this.find(ta).first()||wr,this.#Z=this.find(ea).first()||wr,this.#Q=this.find(na).first()||wr,this.#K.on([la,ga,fa],(()=>{this.update()})),this.#b=!0)}async update(){const t=this.#K,e=t.state,n=this.#W,a=this.#J,i=this.#Z,r=this.#Q;if(n.active=!0,n.disabled=!0,a.active=!1,a.disabled=!0,i.active=!1,i.disabled=!0,r.active=!1,r.disabled=!0,e==ia)return;const{activePageIndex:s,activePage:o,nextPage:c,pages:l,useSummaryPage:u}=t,h=null!=await c;e==oa?(n.disabled=!0,r.active=!0):e==sa?(n.disabled=!1,r.active=!0,r.disabled=!t.valid):e==ra&&(n.disabled=s<=0,h||!o.valid&&s+1<l.length?(a.active=!0,a.disabled=!o.valid):u&&e==ra?(i.active=!0,i.disabled=!o.valid):(r.active=!0,r.disabled=!t.valid))}}lt(br);const xr=[Va,_a,Ga];class Er extends ot{static get observedAttributes(){return xr}static get NODENAME(){return Wn}constructor(){super()}get name(){return this.attr(Va)}get active(){return this.hasAttribute(_a)}set active(t){this.active!=t&&pi(this,t)}get readonly(){return this.hasAttribute(Ga)}set readonly(t){t?this.attr(Ga,""):this.attr(Ga,null)}}lt(Er);const Ar=[ei];class Nr extends ot{static get observedAttributes(){return Ar}static get NODENAME(){return Xn}#K;#Y;#b=!1;constructor(){super(),this.on("click",(({target:t})=>{if(!this.#K)return;if(t==this)return;const e=t.is(Wn)?t:t.parent(Wn),n=this.#K;if(!e)return;const{state:a,pages:i,activePage:r}=n,s=e.name;if(a==ra||a==sa){const t=((t,e,n)=>{for(let a of t){if(a.step==e&&a.condition)return a;if(a==n)return}return null})(i,s,r);t&&(n.activePage=t)}}))}async init(){if(await super.init(),this.progress=0,!this.#b){const t=this.#K=this.parent(Hn);this.#Y=this.find(Wn),this.#K.on([fa,ga],(()=>{const e=t.state;if(ia==e)return;const{activePageIndex:n,activePage:a,pages:i}=t;if(!a)return;const r=i.length,s=a?a.step:aa,o=Math.floor(100*n/r);for(let t of this.steps){const n=t.name;e==ra?(t.active=n==s,t.readonly=!1):e==sa?(t.active=n==sa,t.readonly=!1):(t.active=n==oa,t.readonly=!0)}this.progress=e==sa||e==oa?100:o,this.trigger(va)})),this.#b=!0}}get steps(){return Array.from(this.#Y)}get progress(){return this.attr(ei)}set progress(t){this.style.setProperty&&this.style.setProperty("--progress",t+"%"),this.attr(ei,Math.max(0,Math.min(t,100)))}}lt(Nr);const Tr="success",Dr="fail";const Mr=class{static get STATE_SUCCESS(){return Tr}static get STATE_FAIL(){return Dr}constructor(t,e,n,a){this.action=t,this.state=e,this.message=n,this.data=a}},Pr=gt("form");const Lr=class extends ot{constructor(){super()}async init(){await super.init();const t=this.parent(Hn);Pr(this,t),t&&this.trigger(ua)}get form(){return Pr(this)}async accept(t={}){const e=this.attr(Ua);return!e||await Vt.resolve(e,t,!1)}async execute(t={}){return new Mr(Dr,"not implemented")}},$r=`${jn}-default`;class Or extends Lr{static get NODENAME(){return $r}constructor(t,e){super(),this.endpoint=t,this.method=e}async execute(t){let e=this.endpoint;e=await ExpressionResolver.resolveText(e,t,e);const n=new URL(e,location),a=await fetch(n,{method:this.method,credentials:"include",mode:"cors",headers:{"content-type":"application/json"},body:JSON.stringify(t)});return new Mr(this,a.ok?Tr:Dr,a)}}lt(Or);const kr=Or,Vr=gt("submitAction"),Rr=[Va,Ha,Ra,Sa,Ca,ja],Sr=(t,e)=>{for(let n of t.pages)n.readonly=e,n.active=e};class Cr extends ot{static get observedAttributes(){return Rr}static get NODENAME(){return Hn}#b=!1;#tt=aa;#et;#F=new Map;#nt={};#at=null;#it=!1;constructor(){super();const t=this.root;t.on(Ea,(t=>{t.preventDefault(),t.stopPropagation()})),t.on(Aa,(t=>{const e=t.target;this.#et=null,this.childValueChanged(e,null),t.preventDefault(),t.stopPropagation()})),this.ready.then((()=>this.trigger(la)))}async init(){await super.init(),this.#b||(this.#b=!0,this.activePageIndex=-1,this.state=aa,this.useSummaryPage=this.hasAttribute(Ha),this.activePageIndex=-1,this.pages.length>0&&this.toNextPage())}get pages(){return this.#et||(this.#et=Array.from(this.root.find(zn))),this.#et}get state(){return this.#tt}set state(t){const e=this.#tt;t!=ia&&(e==ra&&t!=ra?Sr(this,!0):e!=ra&&t==ra&&(Sr(this,!1),this.activePage&&(this.activePage.active=!0))),this.#tt=t,e!=t&&this.trigger(ga),this.attr(Ca,t)}get valid(){for(let t of this.pages)if(t.condition&&!t.valid)return!1;return!0}async value(t){return await this.ready,this.#at&&await this.#at,0==arguments.length?this.#nt:this.state!=ra?new Promise((e=>{const n=a=>{a.stopPropagation(),this.removeOn(n,ga),e(this.value(t))};this.on(ga,n)})):(await Promise.all(this.pages.map((e=>{const n=e.name;return n?e.value(ui(t,n)):e.value(t)}))),void await this.#rt())}get activePage(){return 0<=this.activePageIndex&&this.activePageIndex<this.pages.length?this.pages[this.activePageIndex]:null}set activePage(t){const e=this.activePage;t==e&&this.state==ra||(e&&(e.active=!1),this.activePageIndex=this.pages.indexOf(t),t.active=!0,this.state!=ra&&(this.state=ra),this.scrollIntoView(),this.trigger(fa))}get prevPage(){return(async()=>{const t=this.pages,e=this.activePageIndex-1,n=await this.value();for(let a=e;a>=0;a--){const e=t[a];if(await e.validate(n),e.condition)return e}return null})()}get nextPage(){return(async()=>{const t=this.pages,e=this.activePageIndex+1,n=await this.value();if(t)for(let a=e;a<t.length;a++){const e=t[a];if(await e.validate(n),e.condition)return e}return null})()}async toPrevPage(){if(this.state!=ra)this.state=ra;else{const t=await this.prevPage;t&&(this.activePage=t)}}async toNextPage(){const t=await this.nextPage;t?(this.activePage=t,this.state=ra):this.useSummaryPage?this.summary():this.submit()}async summary(){this.state=sa}get submitActions(){let t=Vr(this);if(!t){t=[];let e=this.attr(Ra);if(e){const t=this.attr(Sa)||"post";this.append(new kr(e,t))}const n=this.children;for(let e of n)e instanceof Lr&&t.push(e);Vr(this,t)}return t}async submit(){const t=await this.value();if(!await zi(t,this.pages))return;this.hasAttribute(ja)||(this.state=oa);const e=this.submitActions;if(e){const n=await(async(t,e)=>{const n=[];for(let a of t)if(await a.accept(e))try{const t=await a.execute(e)||new Mr(a,Tr);if(n.push(t),t.state==Dr)return n}catch(t){return n.push(new Mr(a,Dr,t)),n}return n})(e,t);this.trigger(da,n)}this.trigger(ha,t)}#rt(t){if(this.state==ra)return this.state=ia,this.#at=new Promise((e=>{setTimeout((async()=>{const n=this.#nt,a=t?t.validate(n):await zi(n,this.pages);this.#it||(this.state=ra),this.validation=null,e(a)}),10)}));this.state==ia&&this.#at.then((async()=>{this.#it=!1,await this.#rt(t)}))}async childValueChanged(t,e){await this.ready,e=await e;const n=this.#F;t&&(si(e)?n.delete(t):n.set(t,e)),this.#nt=await ci(this.#F,this.pages);const a=this.activePage;a?await this.#rt(a):await this.#rt()}}lt(Cr);const Ir=`${u}/html-campaigns-element`,Hr=new URL(`${Ir}/root.tpl.html`,location),jr=new URL(`${Ir}/campaign-dialog.tpl.html`,location);class zr extends ot{static get NODENAME(){return"x-campaigns"}#b=!1;#st;constructor(){super();const t=this.root;t.on(h,(t=>{t.stopPropagation(),this.render()})),t.on("action:create-campaign",(t=>{t.stopPropagation(),this.openCreateDialog()})),t.on("action:close-campaign-dialog",(t=>{t.stopPropagation(),this.#st&&this.#st.close()}))}async init(){await super.init(),this.#b||(await this.render(),this.#b=!0)}async render(){const t=await Ht.load(Hr);await Ze.render({container:this.root,template:t,data:{accessRights:x(),campaigns:await Vn()}})}async openCreateDialog(){const t=this.root;if(!this.#st){const e=await Ht.load(jr),n=await Ze.render({template:e,container:t,data:{accessRights:x()},mode:"append"});this.#st=n.content[0],this.#st.on("d-form-submit",(t=>{t.preventDefault(),t.stopPropagation();const e=t.target;(async()=>{const t=await e.value();await Sn(t),this.#st.close(),await this.render()})()}))}this.#st.showModal()}}lt(zr);const Ur=t=>`/api/campaigns/${t}/registrations`,_r=new Map,qr=t=>_r.get(t),Fr=t=>{if(!t)return;const{campaignid:e,memberid:n}=t;(_r.has(e)||_r.set(e,new Map),_r.get(e)).set(n,t)},Kr=async t=>{if(_r.has(t))return Array.from(qr(t).values());const e=(await En(Ur(t))).data;for(const t of e)Fr(t);return e},Gr=async t=>Br(t,p.id),Br=async(t,e)=>{let n=((t,e)=>{const n=qr(t);return n?n.get(e):null})(t,e);return n||(n=await En(((t,e)=>`${Ur(t)}/${e}`)(t,e)),Fr(n)),n},Xr=`${u}/html-campaign-element`,Wr=Ht.load(new URL(`${Xr}/root.tpl.html`,location)),Jr=Ht.load(new URL(`${Xr}/registration.tpl.html`,location)),Zr=Ht.load(new URL(`${Xr}/registrations.tpl.html`,location)),Qr=(t,e)=>{t=t instanceof Date?t:new Date(t),e=e instanceof Date?e:new Date(e);const n=Math.ceil(Math.abs(t-e)/864e5),a=[];for(let e=0;e<n;e++)a.push(t.addDays(e));return a};class Yr extends ot{static get NODENAME(){return"x-campaign"}#b=!1;#ot=!1;constructor(){super();const t=this.root;t.on(h,(t=>{t.stopPropagation(),this.render()})),t.on("action:toogle-details",(t=>{t.stopPropagation();const{target:e}=t;e instanceof HTMLDetailsElement&&(this.#ot=e.open)})),t.on("action:show-registrations",(t=>{t.stopPropagation(),this.showRegistrations()})),t.on("action:delete-campaign",(t=>{t.stopPropagation(),(async()=>{await(async t=>{await Nn(`${On}/${t}`),kn.delete(t)})(this.campaignId),this.remove()})()})),t.on("action:create-team",(t=>{t.stopPropagation(),(async()=>{const t=this.campaignId,e=await storeTeam({name:"neues Team",campaignid:t}),n=await Rn(t);n.payload=n.payload||{},n.payload.teams=n.payload.teams||[];n.payload.teams.push(e.id),await Sn(n),this.render()})()})),t.on("info:team-deleted",(t=>{t.stopPropagation();const e=t.detail;(async()=>{const t=await Rn(this.campaignId),n=t.payload.teams;n.splice(n.indexOf(e),1),await Sn(t)})()})),t.on("action:member-registrate",(t=>{t.stopPropagation(),this.openRegistrationDialog()}))}async init(){await super.init(),this.#b||(await this.render(),this.#b=!0)}get campaignId(){return parseInt(this.attr("campaign-id"))}async render(){const t=await Wr;await Ze.render({container:this.root,template:t,data:{accessRights:x(),open:this.#ot,campaign:await Rn(this.campaignId)}})}async openRegistrationDialog(){const t=await Jr,e=await Rn(this.campaignId),n={campaign:e,days:Qr(e.startdate,e.enddate)},a=(await Ze.render({template:t,container:this.root,data:n,mode:"append"})).content[0],i=a.find("d-form").first();i.on("d-form-submit",(t=>{console.log(t),t.stopPropagation(),(async()=>{const t=await i.value(),e=[];let n=!0;for(const a in t)n&&"full"!=t[a].available&&(n=!1),e.push(t[a]);await(async(t,e)=>(e=await An(Ur(t),e),Fr(e),e))(this.campaignId,{fullyavailable:n,availability:e}),a.hide(),a.remove()})()})),i.on("action:close-registration-dialog",(t=>{t.stopPropagation(),a.hide(),a.remove()}));const r=await Gr(this.campaignId);if(r){const t=r.availability||[],e={};for(let n=0;n<t.length;n++)e[`day${n+1}`]=t[n];await i.value(e)}a.showModal()}async showRegistrations(){const t=await Zr,e=await Kr(this.campaignId),n=(await Ze.render({container:this,template:t,data:{registrations:e},mode:"append"})).content[0];n.on("close",(()=>{n.remove()})),n.showModal()}}lt(Yr);const ts=`${u}/html-campaign-member-element`,es=Ht.load(new URL(`${ts}/root.tpl.html`,location));class ns extends ot{static get NODENAME(){return"x-campaign-member"}#b=!1;constructor(){super()}async init(){await super.init(),this.#b||(this.#b=!0,this.render())}async render(){const t=await es,e=await this.getRegistration();await Ze.render({container:this.root,template:t,data:{registration:e}})}get campaignid(){return this.attr("campaign-id")}get memberid(){return this.attr("member-id")}async getRegistration(){const{campaignid:t,memberid:e}=this;return await Br(t,e)}}lt(ns);const as="/api/teams",is=new Map,rs=new Map,ss=(t=null,e=!1)=>{const n=t||"";if(rs.has(n))return rs.get(n);if(!e)return null;const a=new Map;return rs.set(n,a),a},os=async t=>{if(is.has(t))return is.get(t);const e=await En(`${as}/${t}`);is.set(e.id,e);return ss(e.campaignId,!0).set(e.id,e),e},cs=async t=>{t=await An(`${as}`,t),is.set(t.id,t);return ss(t.campaignid,!0).set(t.id,t),t},ls=`${u}/html-team-element`,us=Ht.load(new URL(`${ls}/root.tpl.html`,location)),hs=Ht.load(new URL(`${ls}/editor.tpl.html`,location));class ds extends ot{static get NODENAME(){return"x-team"}#b=!1;#ot=!1;constructor(){super();const t=this.root;t.on("action:toogle-details",(t=>{t.stopPropagation();const{target:e}=t;e instanceof HTMLDetailsElement&&(this.#ot=e.open)})),t.on("action:delete-team",(t=>{t.stopPropagation(),(async()=>{const t=this.teamId;await(async t=>{await Nn(`${as}/${t}`);const e=is.get(t),n=ss(e.campaignId,!1);n&&n.delete(t),is.delete(t)})(t),this.trigger("info:team-deleted",t),this.remove()})()})),t.on("action:edit-team",(t=>{t.stopPropagation(),this.editorDialog()}))}async init(){await super.init(),this.#b||(await this.render(),this.#b=!0)}get teamId(){return parseInt(this.attr("team-id"))}get campaignId(){return parseInt(this.attr("campaign-id"))}async render(){const t=await us;await Ze.render({template:t,container:this.root,data:{accessRights:x(),open:this.#ot,team:await os(this.teamId)}})}async editorDialog(){const{root:t,teamId:e}=this,n=await os(e),a=await hs,i=document.createElement("div");await Ze.render({container:i,template:a,data:{team:n}}),t.append(i.innerHTML);const r=t.find(":scope > dialog").last();r.on("d-form-submit",(t=>{t.stopPropagation();const e=t.target;(async()=>{const t=await e.value();await cs(t),r.close(),r.remove(),this.render()})()})),r.on("close",(t=>{t.stopPropagation(),r.remove()}));const s=r.find("d-form").first();await s.ready,await s.value(n),r.showModal()}}lt(ds);const ps=`${u}/html-teams-element`,fs=Ht.load(new URL(`${ps}/root.tpl.html`,location));class gs extends ot{static get NODENAME(){return"x-teams"}#b=!1;constructor(){super();this.root.on("action:create-team",(t=>{t.stopPropagation(),(async()=>{const t=this.campaignId?parseInt(this.campaignId):null;await cs({name:"neues Team",campaignid:t}),this.render()})()}))}async init(){await super.init(),this.#b||(await this.render(),this.#b=!0)}get campaignId(){return this.attr("campaign-id")}async render(){const t=await fs,e=await(async(t=null)=>{let e=ss(t);if(e)return Array.from(e.values());e=ss(t,!0);const n=(await(async()=>En(t?`${as}/campaign/${t}`:as))()).data;for(let t of n)e.set(t.id,t),is.set(t.id,t);return n})(this.campaignId);await Ze.render({template:t,container:this.root,data:{accessRights:x(),teams:e}})}}lt(gs);const ms=`${u}/html-team-member-search-field-element`,ys=Ht.load(new URL(`${ms}/root.tpl.html`,location)),ws=Ht.load(new URL(`${ms}/dialog.tpl.html`,location));class vs extends Ei{static get NODENAME(){return"x-team-member-search-field"}#b=!1;#ct=null;constructor(){super();const t=this.root;t.on("action:show-selection-dialog",(t=>{t.stopPropagation(),this.readonly||this.showSelectionDialog()})),t.on("action:save-selection",(t=>{t.stopPropagation(),this.readonly||(async()=>{const t=this.#ct.find(".is-selected[member-id]"),e=await Promise.all(t.map((t=>t.attr("member-id"))));await this.publishValue(e),await this.render(),this.#ct.close(),this.#ct.remove(),this.#ct=null})()}))}async init(){await super.init(),this.#b||this.render()}async showSelectionDialog(){if(!this.#ct){const{root:t}=this,e=await ws,n=await(async()=>{const t=new Set,e=await this.value();if(e)for(const n of e)t.add(n);return t})(),a=this.campaignid,i=await(async()=>a?(await Kr(a)).map((t=>({id:t.memberid}))):(async()=>{let t=null;if(Dn)t=Array.from(Mn.values());else{t=(await En(Tn)).data;for(const e of t)Mn.set(e.id,e);Dn=!0}return t})())();await Ze.render({template:e,container:t,data:{members:i,memberids:n,campaignid:a},mode:"append"}),this.#ct=t.find(":scope > dialog").first()}this.#ct.showModal()}async render(t){t=t||await this.value();const e=await ys;Ze.render({template:e,container:this.root,data:{memberids:t||[],campaignid:this.campaignid}})}get campaignid(){return this.attr("campaign-id")}async acceptValue(t){return t instanceof Array||null==t}async readonlyUpdated(){}async updatedValue(t){this.#ct&&this.#ct.remove(),await this.render(t)}}lt(vs);(t=>{const e=(t=new Date)=>{const e=t.getFullYear(),n=t.getMonth();return{date:t=t.getDate(),month:n,year:e,test:1e4*e+100*n+t}},n=(t,n)=>(t=e(t instanceof Date?t:Date.parse(t)),n=e(n instanceof Date?n:Date.parse(n)),t.test>=n.test);t.formUtils=t.formUtils||{date:{greaterEqual:n,greaterEqualNow:t=>n(t,new Date),greater:(t,n)=>(t=e(t instanceof Date?t:Date.parse(t)),n=e(n instanceof Date?n:Date.parse(n)),t.test>n.test)}}})(window),(t=>{const e=new Intl.DateTimeFormat("default",{weekday:"long",month:"long",day:"numeric"});t.DateFormats=t.DateFormats||{toDate:(t=new Date)=>e.format(t)}})(window);document.body.on("action:management:sync-all-data",(async t=>{console.log({event:t}),await fetch("/api/management/sync-data",location)}))})()})();
//# sourceMappingURL=index.118df70432656f5593ed.min.js.map