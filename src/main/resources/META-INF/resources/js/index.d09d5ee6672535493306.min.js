(()=>{var t={609:()=>{String.prototype.hashcode||(String.prototype.hashcode=function(){if(0===this.length)return 0;let t=0;const e=this.length;for(let n=0;n<e;n++){t=(t<<5)-t+this.charCodeAt(n),t|=0}return t})}},e={};function n(a){var i=e[a];if(void 0!==i)return i.exports;var r=e[a]={exports:{}};return t[a](r,r.exports,n),r.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{"use strict";const t="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{},e=t.fetch,a=t.location.origin;const i=new class{#t={};#e={};#n={};#a=!1;#i=[];#r=[];#s;constructor(){}set ignoreDocumentOrigin(t){this.#a=t}addOriginToIgnore(t){if(t instanceof Array)for(let e of t)this.#n[e.toString()]=!0;else this.#n[t.toString()]=!0}addUrlToIgnore(t){if(t instanceof Array)for(let e of t)this.#e[e.toString()]=!0;else this.#e[t.toString()]=!0}setup(t){("function"==typeof t||t instanceof Promise)&&this.#r.push(t)}addInterceptor(t){if(t instanceof Array)return t.forEach((t=>this.addInterceptor(t)));if("object"!=typeof t)throw new Error("function required an interceptor");if("function"!=typeof t.doAccept)throw new Error('The interceptor required a "doAccept" function!');if("function"!=typeof t.doHandle)throw new Error('The interceptor required a "doHandle" function!');this.#i.push(t),this.reset()}get ready(){return(async()=>0==this.#r.length||(this.#s||(this.#s=(async()=>{for(;0!=this.#r.length;){const t=this.#r[0];if(t){const e=t instanceof Promise?await t:await t();e&&(e instanceof Array?e.forEach((t=>this.addInterceptor(t))):this.addInterceptor(e))}this.#r.shift()}return this.#s=null,this.ready})()),this.#s))()}async doIntercept(t){await this.ready;const e=t.metadata.origin;if(this.#o(e,t.url.toString()))return t;const{url:n,metadata:a}=t,i=await this.#c(e,{url:n,metadata:a});if(!i)return t;for(let e of i)t=await e.doHandle(t);return t}reset(){this.#t={}}async uncheckedFetch(t,n){return e(t,n)}#o(t,e){return!!this.#e[e]||(!(!this.#a||t!=a)||!!this.#n[t])}async#c(t,e){let n=this.#t[t];return n||(n=this.#l(t,e),this.#t[t]=n),n}async#l(t,e){const n=[];for(let t of this.#i)await t.doAccept(e)&&n.push(t);return n}};setTimeout((()=>i.ready),10);const r=i;if(void 0!==t.XMLHttpRequest){const e=t.XMLHttpRequest,n=function(t){e.prototype.open.call(this,t.request.method,t.url,t.metadata.async,t.metadata.username,t.metadata.password),void 0!==t.request.headers&&Object.getOwnPropertyNames(t.request.headers).forEach((n=>{e.prototype.setRequestHeader.call(this,n,t.request.headers[n])})),e.prototype.send.call(this,t.request.body)},a=function(){const a=new e(arguments);let i;return a.setRequestHeader=function(t,e){i.request.headers=i.request.headers||{},i.request.headers[t]=e},a.open=function(e,n,a,r,s){const o=new URL(n,t.location.origin);i={url:new URL(n,location),request:{method:e},metadata:{method:e,origin:o.origin,protocol:o.protocol,hostname:o.hostname,port:o.port,path:o.pathname,query:o.search,hash:o.hash,async:"boolean"!=typeof a||a,username:r,password:s}}},a.send=function(t){i.metadata.async?(i.request.body=t,r.doIntercept(i).then(n.bind(a)).catch(console.error)):n.call(a,i)},a};t.XMLHttpRequest=a,t.XMLHttpRequest.prototype=e.prototype,t.XMLHttpRequest.prototype.constructor=a}t.fetch=async function(n,a){const i=new URL(n,t.location),s=await r.doIntercept({url:new URL(n,location),request:a||{},metadata:{method:void 0===a?"GET":a.method||"GET",origin:i.origin,protocol:i.protocol,hostname:i.hostname,port:i.port,path:i.pathname,hash:i.hash,query:i.search,async:!0}});return e(s.url,s.request)};class s{async doAccept(t){}async doHandle(t){}async unceckedFetch(t,n){return e(t,n)}}const o=async(t,e)=>(e.request.headers=e.request.headers||{},e.request.headers.Authorization=`Bearer ${t}`,e);class c extends s{#u=null;#h={};#d;#p;#f;#g;#m;constructor({condition:t,fetchToken:e,appendToken:n,refreshInterval:a=6e4,refreshToken:i}){if(super(),"string"!=typeof t&&!(t instanceof Array)&&"function"!=typeof t)throw new Error('Parameter "condition" must be a "string", "array" or "function"!');if(this.#d=t,"function"!=typeof e)throw new Error('Parameter "fetchToken" must be a "function"!');if(this.#p=e,n&&"function"!=typeof n)throw new Error('Parameter "appendToken" must be a "function"!');this.#f=n||o,this.#g=a,this.#m=i}async doAccept(t){const e=typeof this.#d,n=this.#d,a=t.metadata.origin;return"function"===e?await n(t):"string"===e?n==a:n instanceof Array&&n.includes(a)}async doHandle(t){if(!this.#u){const{url:e,metadata:n}=t;this.#h={url:e,metadata:n},this.#u=this.#p({url:e,metadata:n}),this.#y()}return this.#w(t)}async#w(t){const e=this.#f,n=await this.#u,a=await e(n,t);return a||t}#y(){if(this.#g>0){this.#m;const t=async()=>{this.#m?await this.#m(this.#h):await this.#p(this.#h),setTimeout(t,this.#g)};setTimeout(t,this.#g)}}}const l={OAuthInterceptor:function(t){const e=t;return e.fetchToken=async()=>{const t=await fetch(e.login.url,{method:e.login.method||"get"});return t=await t.json(),t[e.login.response.valueSelector]},c(t)},TokenInterceptor:c};t.defaultjs=t.defaultjs||{},t.defaultjs.httpinterceptor=t.defaultjs.httpinterceptor||{VERSION:"${version}",Manager:r,Interceptor:s,interceptors:l};const u="/templates",h="global:action:reload-parent",d="/api/system/login",p=(new URL(location),{ROLEMAPPING:{"ex-member":"EX Member",reservist:"Reservist",recruit:"Anwärter",private:"Member",junior_officer:"Member",combat_officer:"Feldkommandent",personnel_officer:"Personal Offizier",recruitment_officer:"Anwerber",executive_officer:"Ausführender Offizier",commander:"Clan Leader"}});window.APPGLOBALS=p;const f=window.localStorage,g="cached-login";let m,y,w,v=!1,b={};const x=t=>t-(Date.now()+864e5)<0,E=async()=>{let t=await fetch(new URL("/api/system/access",location));if(401==t.status)return!1;if(403==t.status)return null;var e,n;t=await t.json(),e=g,n=t,f.setItem(e,JSON.stringify({data:n}));const{member:a,accessToken:i,expireAt:r,accessRights:s}=t;return!x(r)&&(m=a,y=i,w=r,b=s,APPGLOBALS.member=m,APPGLOBALS.accessRights=b,N(),!0)},A=async()=>{const t=(t=>{const{data:e}=JSON.parse(f.getItem(t)||"{}");return e})(g);if(!t)return!1;const{member:e,accessToken:n,expireAt:a}=t;if(x(a))return i=g,f.removeItem(i),!1;var i;const r=new URL(d,location),s=r.searchParams;s.set("status","ok"),s.set("access_token",n),s.set("account_id",e.id),s.set("expires_at",a-Date.now()),await fetch(r)},N=()=>{const t=w-(Date.now()+6e4);setTimeout((async()=>{await E()}),t)},T=async()=>{if(!v){if(await A(),!await E())return location.href=new URL(d,location).toString(),!1;v=!0}return m},D=()=>b;r.addInterceptor(new class extends s{constructor(){super()}async doAccept(t){return location.origin==t.metadata.origin}async doHandle(t){const e=y;return e&&(t.request.headers=t.request.headers||{},t.request.headers.Authorization=`Bearer ${e}`),t}});const M=function(){const t=Array.from(arguments),e=t.shift();for(;t.length>0;){t.shift()(e)}},P={global:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},globalVar:function(t,e){return 2===arguments.length&&void 0===P.global[t]&&(P.global[t]=e),P.global[t]}},L=P,$=L.globalVar("___DOM_API_EXTENSION_MAP___",{}),O=function(t,e){return function(n){let a=$[n.name];a||(a=$[n.name]={}),a[t]?console.warn('duplicated load of extension "'+t+'"!'):(a[t]=!0,e(n.prototype))}},k=O("EventSupport",(t=>{const e=/(\s+)|(\s*,\s*)/,n=t=>(t.__wrapperhandlemap__||(t.__wrapperhandlemap__=new Map),t.__wrapperhandlemap__),a=(t,a,i)=>{const{wrapper:r,option:s,events:o,handle:c}=a,l=s.capture;if(i){i="string"==typeof i?i.split(e):i;for(let e of i){const a=o.indexOf(e);a>=0&&(t.removeEventListener(e,r,l),o.splice(a,1)),0==o.length&&n(t).delete(c)}}else{for(let e of o)t.removeEventListener(e,r,l);n(t).delete(c)}};t.on=function(){if(arguments.length<2)throw new Error("Too less arguments!");const t=Array.from(arguments);let i="string"==typeof t[0]?t.shift().split(e):t.shift();const r="string"==typeof t[0]?t.shift():null,s=t.shift(),o=void 0===t[0]?{capture:!1,once:!1,passive:!1}:"boolean"==typeof t[0]?{capture:t.shift(),once:!1,passive:!1}:t.shift(),c=function(t){if(r){const e=t.target;if("function"==typeof e.is&&!e.is(r))return}const e=s.apply(null,arguments);return o.once&&a(this,c),e};n(this).set(s,{handle:s,wrapper:c,events:i,option:o});for(let t of i)this.addEventListener(t,c,o);return this},t.removeOn=function(t,e,i){const r=n(this).get(t);return r?a(this,r,e):this.removeEventListener(t,e,i),this},t.trigger=function(){const t=Array.from(arguments),e="number"==typeof t[0]?t.shift():-1;if(e>=0){const a=t[0],i=((n=this).___EVENTTRIGGERTIMEOUTS___||(n.___EVENTTRIGGERTIMEOUTS___={}),n.___EVENTTRIGGERTIMEOUTS___),r=i[a];r&&clearTimeout(r),i[a]=setTimeout((()=>{delete i[a],this.trigger.apply(this,t)}),e)}else{const e=t.shift(),n=t[0]instanceof Event?t.shift():null,a=t.length>=1?1==t.length?t.shift():t:n,i=a?new CustomEvent(e,{bubbles:!0,cancelable:!0,composed:!0,detail:a}):new Event(e,{bubbles:!0,cancelable:!0,composed:!0});n&&(i.delegatedEvent=n),this.dispatchEvent(i)}var n;return this}}));M(EventTarget,k);const V=O("DataSupport",(t=>{t.data=function(){const t={};if(void 0!==this.dataset)for(name in this.dataset)t[name]=this.dataset[name];return this.data=function(){return 0==arguments.length?t:1==arguments.length?t[arguments[0]]:(void 0===arguments[1]||null==arguments[1]?delete t[arguments[0]]:t[arguments[0]]=arguments[1],this)}.bind(this),this.data.apply(null,arguments)}})),R=O("ManipulationSupport",(t=>{t.empty=function(){let t=this.childNodes;for(;0!=t.length;)t[0].remove(!0);return this},t.content=function(){return this.childNodes},t.html=function(){return 0==arguments.length?this.innerHTML:1==arguments.length&&"boolean"==typeof arguments[0]?arguments[0]?this.outerHTML:this.innerHTML:(Array.from(arguments).forEach((t=>{this.empty(),("string"==typeof t||t instanceof Node||t instanceof NodeList||t instanceof HTMLCollection)&&this.append(t)})),this)};const e=function(){const e=t.appendChild.bind(this);for(let t=0;t<arguments.length;t++){let n=arguments[t];n instanceof Node?this.appendChild(n):"string"==typeof n?create(n).forEach(e):"function"==typeof n.forEach&&n.forEach(e)}};t.append=e;const n=function(t,e){this.insertBefore(e,t)};t.prepend=function(){if(0==this.childNodes.length)e.apply(this,arguments);else{const t=this.childNodes.first(),e=n.bind(this,t);for(let t=0;t<arguments.length;t++){const n=arguments[t];n instanceof Node?e(n):("string"==typeof n||"function"==typeof n.forEach)&&n.forEach(e)}}},t.replace=function(){if(arguments.length<1)throw new Error("Insufficient arguments! One or two nodes required!");const t=1==arguments.length?this.parentNode:this,e=1==arguments.length?this:arguments[0],n=1==arguments.length?arguments[0]:arguments[1];n instanceof Array||n instanceof NodeList||n instanceof HTMLCollection?(n.forEach((n=>t.insertBefore(n,e))),e.remove()):t.replaceChild(n,e)},t.after=function(){if(null==this.parentNode)throw new Error("Can't insert nodes after this node! Parent node not available!");const e=this.parentNode,n=this.nextSibling;n?t.before.apply(n,arguments):t.append.apply(e,arguments)},t.before=function(){if(null==this.parentNode)throw new Error("Can't insert nodes after this node! Parent node not available!");const t=this.parentNode,e=e=>{t.insertBefore(e,this)};for(let t=0;t<arguments.length;t++){const n=arguments[t];n instanceof Node?e(n):("string"==typeof n||"function"==typeof n.forEach)&&n.forEach(e)}}})),S=R;M(Node,V,S);const C=/:parent(\(\"([^\)]*)\"\))?/i,I=function(t,e){let n=C.exec(e);if(!n)return t.querySelectorAll(e);{let a=t;if(n.index>0&&(a=t.querySelectorAll(e.substr(0,n.index)),0==a.length))return;if(a=a.parent(n[2]),a){let t=e.substr(n.index+n[0].length).trim();return t.length>0&&(a=a.find(t)),a}}},H=O("QuerySupport",(t=>{t.find=function(){let t=[],e=Array.from(arguments),n=e.shift();for(;n;){if("string"==typeof n){let e=I(this,n);e&&t.push(e)}n=e.shift()}return NodeList.from.apply(null,t)},t.is=function(){if(this instanceof Document||this instanceof DocumentFragment)return!1;if(1==arguments.length){if("string"==typeof arguments[0])return this.matches(arguments[0]);if("number"==typeof arguments[0].length){let t=arguments[0];for(let e=0;e<t.length;e++)if(this.matches(t[e]))return!0}}else if(arguments.length>1)return this.is(Array.from(arguments));return!1},t.parent=function(t,e){if(!this.parentNode)return null;e="boolean"==typeof t?t:e,t="string"==typeof t?t:null;let n=this.parentNode;if(n instanceof ShadowRoot&&e&&(n=n.host),t){try{for(;n&&!n.is(t);)n=n.parent(t,e)}catch(t){console.error("this:",this,"parent:",n,"error:",t)}return n}return n},t.parents=function(){let e=new Array,n=t.parent.apply(this,arguments);for(;n;)e.push(n),n=t.parent.apply(n,arguments);return NodeList.from(e)},t.selector=function(){if(!(this instanceof Document||this instanceof DocumentFragment)){if(this.id)return"#"+this.id;{let t=this.tagName.toLowerCase(),e=this.parent();if(e){let n=e.find(":scope>"+t);if(n instanceof NodeList){let e=n.indexOf(this);e>0&&(t+=":nth-child("+(e+1)+")")}let a=e.selector();return a?a+">"+t:t}return t}}},t.closest=function(t){return this.closests(t).first()},t.closests=function(t){const e=this.find(t);if(0!=e.length)return e;const n=this.parentElement;return n?n.closests(t):NodeList.from([])},t.nested=function(t){if(this.is(t))return NodeList.from(this);let e=this.find(t);return e&&e.length>0?e:NodeList.from(this.parent(t))}})),j=H,z=O("AttributeSupport",(t=>{t.attr=function(){return 0==arguments.length?this.hasAttributes()?(()=>{const t={};return this.getAttributeNames().forEach((e=>{t[e]=this.getAttribute(e)})),t})():void 0:1==arguments.length?this.getAttribute(arguments[0]):(void 0===arguments[1]||null==arguments[1]?this.removeAttribute(arguments[0]):this.setAttribute(arguments[0],arguments[1]),this)}}));M(Element,j,z,S);const U=O("ReadyEventSupport",(t=>{t.ready=function(t,e){return this.on("ready",t,e),"complete"==document.readyState&&this.trigger("ready"),this}}));M(Document,j,U),document.addEventListener("DOMContentLoaded",(()=>document.trigger("ready"))),M(DocumentFragment,j,S);const _=O("HtmlClassSupport",(t=>{t.addClass=function(){return 1==arguments.length?arguments[0].split(/\s+/).forEach((t=>this.classList.add(t))):arguments.length>1&&Array.prototype.forEach.call(arguments,(t=>this.classList.add(t))),this},t.removeClass=function(){return 1==arguments.length?arguments[0].split(/\s+/).forEach((t=>this.classList.remove(t))):arguments.length>1&&Array.prototype.forEach.call(arguments,(t=>this.classList.remove(t))),this},t.toggleClass=function(){return 1==arguments.length?arguments[0].split(/\s+/).forEach((t=>this.classList.toggle(t))):arguments.length>1&&Array.prototype.forEach.call(arguments,(t=>this.classList.toggle(t))),this}})),q="none",F=t=>t.style.display===q,K=t=>{let e=F(t)?"":t.style.display;return t.show=function(){return this.style.display=e,this}.bind(t),t.hide=function(){return this.style.display=q,this}.bind(t),t},G=O("ShowHideSupport",(t=>{t.show=function(){return K(this).show.apply(null,arguments)},t.hide=function(){return K(this).hide.apply(null,arguments)},t.toggleShow=function(){return F(this)?this.show():this.hide()}}));M(HTMLElement,_,G);const B=[{selector:"select",get:function(){const t=[];return this.find("option").forEach((e=>{e.selected&&t.push(e.value)})),t},set:function(){let t=[];const e=Array.from(arguments);let n=e.shift();for(;n;)Array.isArray(n)?t=t.concat(n):t.push(n),n=e.shift();this.value=t,this.find("option").forEach((e=>e.selected=t.indexOf(e.value)>=0)),this.trigger("changed")}},{selector:'input[type="checkbox"], input[type="radio"]',get:function(){return"on"==this.value||"off"==this.value?this.checked:this.checked?this.value:void 0},set:function(t){"boolean"==typeof t?this.checked=t:"string"==typeof t?this.checked=this.value==t:Array.isArray(t)&&(this.checked=t.indexOf(this.value)>=0),this.trigger("changed")}}],X={get:function(){return this.value},set:function(t){this.value=t,this.trigger("input")}},J=O("ValueSupport",(t=>{t.val=function(){let t=function(t){for(let e=0;e<B.length;e++)if(t.is(B[e].selector))return B[e];return X}(this);return 0==arguments.length?t.get.apply(this,arguments):(t.set.apply(this,arguments),this)}}));M(HTMLInputElement,J),M(HTMLTextAreaElement,O("ValueSupport",(t=>{t.val=function(){return 0==arguments.length?this.value:(this.value=arguments[0],this)}}))),M(HTMLSelectElement,J);const W=function(){const t=Array.from(arguments),e=t.shift(),n=t.shift();t.forEach((t=>{Object.getOwnPropertyNames(t).forEach((a=>{const i=Object.getOwnPropertyDescriptor(t,a);void 0===n[a]&&"function"==typeof i.value&&(n[a]=function(){return e.call(this,a,arguments)})}))}))},Z=O("ListSupport",(t=>{t.indexOf=function(){for(let t=0;t<this.length;t++)if(this[t]==arguments[0])return t;return-1},t.forEach=function(){return Array.prototype.forEach.apply(Array.from(this),arguments)},t.map=function(){return Array.prototype.map.apply(Array.from(this),arguments)},t.filter=function(){return Array.prototype.filter.apply(Array.from(this),arguments)},t.first=function(){if(this.length>0)return this[0]},t.last=function(){if(this.length>0)return this[this.length-1]}}));M(NodeList,Z),NodeList.prototype.applyTo=function(){const t=Array.from(arguments),e=t.shift(),n="function"==typeof e,a=[];for(let i=0;i<this.length;i++){const r=this[i];let s;n?s=e.apply([r].concat(t)):"function"==typeof r[e]&&(s=r[e].apply(r,t)),s&&a.push(s)}return a},NodeList.prototype.val=function(){if(0==arguments.length){if(this.length>0){const t=new Map;return this.forEach((e=>{if("function"==typeof e.val){e.val()&&t.set(e.name||e.id||e.selector(),e.val())}})),t}}else NodeList.prototype.applyTo.apply(this,["val"].concat(Array.from(arguments)))},NodeList.from=function(){const t=Array.from(arguments),e={};let n=0;for(;t.length>0;){const a=t.shift();if(void 0!==a&&null!=a)if(a instanceof Node)e[n++]={value:a,enumerable:!0};else if(a instanceof NodeList||a instanceof HTMLCollection||a instanceof Array)for(let t=0;t<a.length;t++)a[t]&&a[t]instanceof Node&&(e[n++]={value:a[t],enumerable:!0})}return e.length={value:n},Object.create(NodeList.prototype,e)},W((function(t,e){let n=[];return this.forEach((a=>{if(a&&"function"==typeof a[t]){const i=a[t].apply(a,e);i&&(i instanceof NodeList?n=n.concat(Array.from(i)):n.push(i))}})),0===n.length?void 0:n[0]instanceof Node||n[0]instanceof NodeList?NodeList.from(n):n}),NodeList.prototype,Node.prototype,HTMLElement.prototype,HTMLInputElement.prototype,Element.prototype,EventTarget.prototype),M(HTMLCollection,Z),HTMLCollection.prototype.applyTo=function(){const t=Array.from(arguments),e=t.shift(),n="function"==typeof e,a=[];for(let i=0;i<this.length;i++){const r=this[i];let s;n?s=e.apply([r].concat(t)):"function"==typeof r[e]&&(s=r[e].apply(r,t)),s&&a.push(s)}return a},HTMLCollection.prototype.val=function(){if(0==arguments.length){if(this.length>0){const t=new Map;return this.forEach((e=>{if("function"==typeof e.val){e.val()&&t.set(e.name||e.id||e.selector(),e.val())}})),t}}else HTMLCollection.prototype.applyTo.apply(this,["val"].concat(Array.from(arguments)))},HTMLCollection.from=function(){const t=Array.from(arguments),e={};let n=0;for(;t.length>0;){const a=t.shift();if(void 0!==a&&null!=a)if(a instanceof HTMLElement)e[n++]={value:a,enumerable:!0};else if(a instanceof HTMLCollection||a instanceof NodeList||a instanceof Array)for(let t=0;t<a.length;t++)a[t]&&a[t]instanceof HTMLElement&&(e[n++]={value:a[t],enumerable:!0})}return e.length={value:n},Object.create(HTMLCollection.prototype,e)},W((function(t,e){let n=[];return this.forEach((a=>{if(a&&"function"==typeof a[t]){let i=a[t].apply(a,e);i&&(i instanceof HTMLCollection?n=n.concat(Array.from(i)):n.push(i))}})),0===n.length?void 0:n[0]instanceof HTMLElement||n[0]instanceof HTMLCollection?HTMLCollection.from.apply(null,n):n}),HTMLCollection.prototype,Node.prototype,HTMLElement.prototype,HTMLInputElement.prototype,Element.prototype,EventTarget.prototype),L.global.defaultjs=L.global.defaultjs||{},L.global.defaultjs.extdom=L.global.defaultjs.extdom||{VERSION:"${version}",utils:{Utils:L}},L.global.find=function(){return document.find.apply(document,arguments)},L.global.ready=function(){return document.ready.apply(document,arguments)},L.global.create=function(t,e){if("string"!=typeof arguments[0])throw new Error("The first argument must be a string!");const n=document.createElement("template");return n.innerHTML=t,e?n:document.importNode(n.content,!0).childNodes},L.global.script=function(t,e){return t instanceof Array?Promise.all(t.map((t=>L.global.script(t,e)))):"string"==typeof t?new Promise(((n,a)=>{const i=document.createElement("script");i.async=!0,i.onload=function(){n()},i.onerror=function(){throw new Error("load error!")},e?e.append(i):document.body.append(i),i.src=t})):Promise.reject("First parameter must be an array of strings or a string!")};class Q{constructor(t,e){this.key=t,this.context=e}get keyDefined(){return this.key in this.context}get hasValue(){return!!this.context[this.key]}get value(){return this.context[this.key]}set value(t){this.context[this.key]=t}set append(t){if(this.hasValue){const e=this.value;e instanceof Array?e.push(t):this.value=[this.value,t]}else this.value=t}remove(){delete this.context[this.key]}static load(t,e,n=!0){let a=t;const i=e.split(".");let r=i.shift().trim();for(;i.length>0;){if(!a[r]){if(!n)return null;a[r]={}}a=a[r],r=i.shift().trim()}return new Q(r,a)}}const Y=function(t){return void 0!==t&&null!=t&&"Object"===t.constructor.name},tt=function(t,...e){t||(t={});for(let n of e)Y(n)&&Object.getOwnPropertyNames(n).forEach((e=>{Y(t[e])?tt(t[e],n[e]):t[e]=n[e]}));return t},et=function(){const[t,e,{deep:n=!1,recursive:a=!0,parents:i=[]}={}]=arguments,r={};for(let s in t){const o=t[s],c=e(s,o,t);if(!c||n&&null!=o){if(c&&n){"object"!==typeof o||o instanceof Array||o instanceof Map||o instanceof Set||o instanceof RegExp||i.includes[o]||o==t?r[s]=o:r[s]=et(o,e,{deep:n,recursive:a,parents:i.concat(t)})}}else r[s]=o}return r},nt=(t,e,n)=>{Object.defineProperty(t,e,{value:n,writable:!1,configurable:!1,enumerable:!1})},at=(t,e,n)=>{Object.defineProperty(t,e,{get:n,configurable:!1,enumerable:!1})},it={isPojo:Y,append:function(t,e,n){if(void 0!==e){Q.load(n,t,!0).append=e}return n},merge:tt,filter:et,buildPropertyFilter:function({names:t,allowed:e}){return(n,a,i)=>t.includes(n)===e},defValue:nt,defGet:at,defGetSet:(t,e,n,a)=>{Object.defineProperty(t,e,{get:n,set:a,configurable:!1,enumerable:!1})}},rt=()=>{let t=null,e=null;const n=new Promise(((n,a)=>{t=n,e=a}));let a,i=!1,r=!1;return nt(n,"resolve",(n=>{a=n,i=!0,a instanceof Error?(r=!0,e(a)):t(a)})),at(n,"value",(()=>a)),at(n,"error",(()=>r)),at(n,"resolved",(()=>i)),n},st=(t,e)=>{let n="unsupported";if("string"==typeof e)n=e;else if(e instanceof HTMLElement)n=e.nodeName;else{if("string"!=typeof e.NODENAME)throw new Error(typeof e+' is not supported as parameter "node"!');n=e.NODENAME}return`${n.toLowerCase()}:${t}`},ot=(t,e)=>st(`attribute--${t}`,e),ct=new WeakMap,lt=t=>class extends t{#v=rt();constructor({shadowRoot:t=!1,content:e=null,createUID:n=!1,uidPrefix:a="id-",uidSuffix:i=""}={}){super(),n&&this.attr("id",n(a,i)),t&&this.attachShadow({mode:"open"}),e&&this.root.append("function"==typeof e?e(this):e)}get root(){return this.shadowRoot||this}get ready(){return this.#v}async init(){}async destroy(){this.ready.resolved&&(this.#v=rt())}connectedCallback(){this.ownerDocument==document&&this.isConnected&&(t=>{let e=ct.get(t);e&&clearTimeout(e),ct.get(t,setTimeout((async()=>{ct.delete(t);try{await t.init(),t.ready.resolve()}catch(e){console.error("Can't initialize component!",t,e),t.ready(resolve(e))}t.trigger(st("initialzed",t))}),10))})(this)}adoptedCallback(){this.connectedCallback()}attributeChangedCallback(t,e,n){e!=n&&this.isConnected&&(this.trigger(10,ot(t,this)),this.trigger(10,st("change",this)))}disconnectedCallback(){this.destroy()}},ut=new Map,ht=t=>{let e=ut.get(t);return null==e&&(e=lt(t),ut.set(t,e)),e},dt=ht(HTMLElement),pt=(t,e)=>"string"==typeof e?e+t:"d-"+t,ft=function(t,e){const n=t.NODENAME;customElements.get(n)||customElements.define(n,t,e)},gt=(t,e,n)=>{if(n(t))return{node:t,depth:e};let a=null;for(let i of t.childNodes){const t=gt(i,e+1,n);null!=t&&(null==a||a.depth>t.depth)&&(a=t)}return a},mt=(t,e)=>{const n=gt(t,0,e);return null!=n?n.node:null},yt=new WeakMap,wt=t=>{if(yt.has(t))return yt.get(t);const e={};return yt.set(t,e),e},vt=function(t,e,n){const a=wt(t);if(1===arguments.length)return a;if(2===arguments.length)return a[e];if(3!==arguments.length)throw new Error("Not allowed size of arguments!");a[e]=n},bt=t=>function(e,n){if(2!=arguments.length)return vt(e,t);vt(e,t,n)},xt=pt("route"),Et=`${xt}-init`,At=`${xt}-click`,Nt=`${xt}-activate`,Tt=`${xt}-deactivate`,Dt=pt("route-link"),Mt=Dt+"-to-route",Pt=void 0!==n.g?n.g:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{};class Lt{constructor(t){this.hasValue=1==arguments.length,this.value=t}}class $t{constructor(t,e){this.data=t,this.resolver=e,this.cache=new Map}updateData(t){this.data=t,this.cache=new Map}resetCache(){this.cache=new Map}getPropertyDef(t,e=!0){if(this.cache.has(t))return this.cache.get(t);let n=null;if(this.data&&t in this.data)n={data:this.data,resolver:this.resolver,defined:!0};else{if(!e)return null;n=((t,e)=>{for(;t;){const n=t.proxy.handle.getPropertyDef(e,!1);if(n)return n;t=t.parent}return{data:null,resolver:null,defined:!1}})(this.resolver.parent,t)}return n.defined&&this.cache.set(t,n),n}hasProperty(t){const{defined:e}=this.getPropertyDef(t);return e}getProperty(t){const{data:e}=this.getPropertyDef(t);return e?e[t]:void 0}setProperty(t,e){const{data:n,defined:a}=this.getPropertyDef(t);a?n[t]=e:(this.data||(this.data={}),this.data[t]=e,this.cache.set(t,{data:this.data,resolver:this.resolver,defined:!0}))}deleteProperty(t){throw new Error("unsupported function!")}}class Ot{constructor(t,e){this.handle=new $t(t,e),this.data=new Proxy(this.handle,{has:function(t,e){return t.hasProperty(e)},get:function(t,e){return t.getProperty(e)},set:function(t,e,n){return t.setProperty(e,n)},deleteProperty:function(t,e){return t.deleteProperty(e)}})}updateData(t){this.handle.updateData(t)}resetCache(){this.handle.resetCache()}}const kt=/(\\?)(\$\{(([a-zA-Z0-9\-_\s]+)::)?([^\{\}]+)\})/,Vt=new Lt,Rt=t=>t instanceof Lt?t:new Lt(t),St=async function(t,e,n,a){if(n&&t.name!=n)return t.parent?St(t.parent,e,n,a):null;const i=await async function(t,e){if("string"!=typeof t)return t;const n=new Function("context",`\nreturn (async (context) => {\n\ttry{ \n\t\twith(context){\n\t\t\t return ${t}\n\t\t}\n\t}catch(e){\n\t\tthrow e;\n\t}\n})(context)`);let a,i=setTimeout((()=>{i=null,console.warn("long running statement:",t,new Error)}),1e3);try{a=await n(e)}catch(t){}return i&&clearTimeout(i),a}(e,t.proxy.data);return null!=i?i:a instanceof Lt&&a.hasValue?a.value:void 0},Ct=async(t,e,n)=>e[1]?e[2]:St(t,e[5],It(e[4]),n),It=t=>t?0==(t=t.trim()).length?null:t:null;class Ht{constructor({context:t=Pt,parent:e=null,name:n=null}){this.parent=e instanceof Ht?e:null,this.name=n,this.context=t,this.proxy=new Ot(this.context,this)}get chain(){return this.parent?this.parent.chain+"/"+this.name:"/"+this.name}get effectiveChain(){return this.context?this.parent?this.parent.effectiveChain+"/"+this.name:"/"+this.name:this.parent?this.parent.effectiveChain:""}get contextChain(){const t=[];let e=this;for(;e;)e.context&&t.push(e.context),e=e.parent;return t}getData(t,e){if(t){if(!e||e==this.name){const e=Q.load(this.context,t,!1);return e?e.value:null}this.parent&&this.parent.getData(t,e)}}updateData(t,e,n){if(t)if(n&&n!=this.name)this.parent&&this.parent.updateData(t,e,n);else{null!=this.context&&void 0!==this.context||(this.context={},this.proxy.updateData(this.context));Q.load(this.context,t).value=e,this.proxy.resetCache()}}mergeContext(t,e){e&&e!=this.name?this.parent&&this.parent.mergeContext(t,e):this.context=this.context?it.merge(this.context,t):t}async resolve(t,e){const n=2==arguments.length?Rt(e):Vt;try{const e=kt.exec(t);return e?await Ct(this,e,n):await St(this,It(t),null,n)}catch(e){return console.error('error at executing statment"',t,'":',e),n.hasValue?n.value:t}}async resolveText(t,e){let n=t,a=t,i=kt.exec(n);const r=2==arguments.length?Rt(e):Vt;for(;null!=i;){const t=await Ct(this,i,r);a=a.split(i[0]).join(),n=n.split(i[0]).join(void 0===t?"undefined":null==t?"null":t),i=kt.exec(a)}return n}static async resolve(t,e,n,a){const i=new Ht({context:e}),r=arguments.length>2?Rt(n):Vt;return"number"==typeof a&&a>0?new Promise((e=>{setTimeout((()=>{e(i.resolve(t,r))}),a)})):i.resolve(t,r)}static async resolveText(t,e,n,a){const i=new Ht({context:e}),r=arguments.length>2?Rt(n):Vt;return"number"==typeof a&&a>0?new Promise((e=>{setTimeout((()=>{e(i.resolveText(t,r))}),a)})):i.resolveText(t,r)}static buildSecure({context:t,propFilter:e,option:n={deep:!0},name:a,parent:i}){return t=it.filter({data:t,propFilter:e,option:n}),new Ht({context:t,name:a,parent:i})}}n(609);const jt="template",zt={},Ut=async(t,e,n)=>_t(create(t,!0),e,n),_t=async(t,e,n)=>{let a=null;if(t instanceof HTMLTemplateElement)a=new qt(t,n);else{if(a=document.createElement("template"),!(t instanceof Node||t instanceof NodeList||t instanceof HTMLCollection||t instanceof Array))throw new Error("Template type is not supported!");a.content.append(t.cloneNode(!0)),a=new qt(a,n)}if(!a)throw new Error("Template can't loaded!");return e&&n&&(zt[n]=a),a};class qt{constructor(t,e){this.template=t,this.key=e}importContent(t=document){return t.importNode(this.template,!0).content.childNodes}remove(){this.key&&zt[this.key]&&delete zt[this.key]}static async fetch(t,e=!0,n=null){return"string"==typeof t?qt.load(new URL(t,loaction),e,n):t instanceof URL?qt.load(t,e,n):void new Error("The url isn't a allowed type! -> [String|URL] required!")}static async load(t,e=!0,n=null){if(t instanceof qt)return t;const a=((t,e,n)=>{if(!e)return null;let a=null;return n?a=n:"string"==typeof t?a=t:t instanceof URL?a=t.toString():t instanceof HTMLElement&&(a=t.selector()),a?a.hashcode():null})(t,e,n);return a&&zt[a]?zt[a]:"string"==typeof t?Ut(t,e,a):t instanceof URL?await(async(t,e,n)=>{const a=await fetch(t.toString()),i=await a.text();return Ut(i,e,n)})(t,e,a):t instanceof Node||t instanceof NodeList||t instanceof HTMLCollection||t instanceof HTMLTemplateElement?_t(t,e,a):void new Error("The template isn't a allowed type! -> [String|URL|Node|NodeList|HTMLCollection|Template] required!")}static async loadNodeTemplate(t,e,n,a){try{const e=(t=>{let e=t.find(":scope > template").first();if(e)return e;const n=t.attr(jt);if(!n)return null;try{if(e=find(n).first(),e)return e}catch(t){}return new URL(n,location)})(t);if(e)return qt.load(e,n,a)}catch(e){console.warn("Can't load template from node!",t,e)}return e}}const Ft="name",Kt="active",Gt="stateful",Bt="component-tag",Xt="component-tag-attributes",Jt="view",Wt=[Ft,jt,Bt,Xt,Gt,Jt],Zt=[At,Nt,Tt],Qt=bt(jt),Yt=async t=>{if(t.hasAttribute(jt)){let e=Qt(t);return e||(e=await qt.loadNodeTemplate(t,null,!1),Qt(t,e)),e}{const e=t.attr(Bt),n=customElements.get(e),a=await(async t=>{const e=t.attr(Xt)||"{}";return Ht.resolve(e,{},{})})(t),i=new n;for(let t in a){const e=a[t];"string"==typeof e&&i.attr(t,e)}return i}};class te extends dt{static get observedAttributes(){return Wt}static get NODENAME(){return xt}static get EVENTS(){return Zt}#b=!1;constructor(t){super(t||{}),this.on("click",(()=>{this.active||this.trigger(At)}))}async init(){await super.init(),this.#b||(this.#b=!0,this.trigger(Et),this.active&&this.trigger(At))}get name(){return this.attr(Ft)}get view(){return this.attr(Jt)}get active(){return this.hasAttribute(Kt)}set active(t){t!=this.active&&(this.attr(Kt,t?"":null),t?this.trigger(Nt):this.trigger(Tt))}get stateful(){return this.hasAttribute(Gt)}get context(){return this.attr("context")}get refresh(){return this.hasAttribute(ATTR_REFRESH)}async component(){return Yt(this)}}ft(te);const ee=te,ne="target",ae="context",ie=[ne,ae],re=[Mt];class se extends dt{static get observedAttributes(){return ie}static get NODENAME(){return Dt}static get EVENTS(){return re}constructor(t){super(t||{}),this.on("click",(t=>{t.preventDefault(),this.trigger(Mt)}))}async init(){}get view(){return this.attr("view")}get target(){return this.attr(ne)}get context(){return this.attr(ae)}get refresh(){return this.hasAttribute("refresh")}}ft(se);const oe=se,ce=pt("view"),le=[],ue={init:0,data:1,template:2,content:3,finish:4};class he{static get PHASE(){return ue}static get MIN_RANK(){return 0}static get MAX_RANK(){return 1e5}constructor(){}get name(){}get rank(){}get phase(){return ue.finish}async execute(t){return t}static define(t){(({directive:t})=>{if(!(t instanceof he))throw new Error("Implementation dosn't extend Directive class!");if(t.rank<he.MIN_RANK)throw new Error("The rank of a directive can't be lower as "+he.MIN_RANK+"!");if(t.rank>he.MAX_RANK)throw new Error("The rank of a directive can't be grater as "+he.MAX_RANK+"!");le.push(t),le.sort(((t,e)=>{const n=t.phase-e.phase;return 0==n?t.rank-e.rank:n}))})(t)}static get directives(){return le}}new Set,new Map;const de=t=>t instanceof qt?t.importContent():typeof t===String?create(t):t;let pe=0;class fe{#x;#E;#A;#N;#T;#D;#M;#P;#L;#$;#O;constructor({content:t=null,resolver:e,renderer:n,template:a,container:i,root:r,mode:s="replace",target:o=null,parent:c=null,wait:l=null,callbacks:u=null,ignoreDirective:h}){if(!e)throw new Error('Parameter "resolver" is required!');if(!n)throw new Error('Parameter "renderer" is required!');if(!a)throw new Error('Parameter "template" is required!');if(!i)throw new Error('Parameter "container" is required!');if(!r)throw new Error('Parameter "root" is required!');this.#x=c?`${c.id}->${pe++}`:"root::"+pe++,this.#E=c?c.depth+1:0,this.#A=c,this.#N=n,this.#T=r,this.#D=de(a),this.#M=s,this.#P=new Set,this.#L=l||rt(),this.#$=h instanceof Set?h:new Set,this.#O=u instanceof Array?u:[],this.content=t,this.container=i,this.target=o,this.resolver=e,this.stop=!1,this.ignore=!1,c&&c.subcontexts.add(this)}get id(){return this.#x}get depth(){return this.#E}get parent(){return this.#A}get renderer(){return this.#N}get root(){return this.#T}get template(){return this.#D}set template(t){this.#D=de(t)}get mode(){return this.#M}get subcontexts(){return this.#P}get closed(){return this.#L.resolved}ignoreDirective(t){const e=this.#$;t instanceof he?e.add(t.name):e.add(t)}acceptDirective(t){const e=this.#$;return t instanceof he?!(e.has(t.name)||e.has(t)):!e.has(t)}finished(t){this.parent?this.parent.finished(t):this.ready(t)}async ready(t){const e=this.#O;if(!t){const t=this.#L;if(!t.resolved){if(!this.ignore)for(let t of e)await t(this);for(let t of this.subcontexts)await t.ready();this.parent&&this.parent.subcontexts.delete(this),t.resolve(this)}return t}t instanceof Array?t.forEach((t=>this.wait.then(t))):t instanceof Promise?e.push((async()=>await t)):"function"==typeof t&&e.push(t)}subContext({resolver:t=this.resolver,renderer:e=this.renderer,template:n=this.template,container:a=this.container,root:i=this.root,mode:r=this.mode,target:s=this.target,ignoreDirective:o=null}={}){return new fe({resolver:t,renderer:e,template:n,container:a,mode:r,root:i,target:s,parent:this,ignoreDirective:o})}clone({content:t=this.content,template:e=this.template,container:n=this.container,root:a=this.root,mode:i=this.mode,target:r=this.target,ignoreDirective:s=this.#$}={}){return new fe({content:t,resolver:this.resolver,renderer:this.renderer,template:e,container:n,root:a,mode:i,target:r,ignoreDirective:s,wait:this.#L,callbacks:this.#O})}toRenderOption({resolver:t=this.resolver,renderer:e=this.renderer,template:n=this.template,container:a=this.container,root:i=this.root,mode:r=this.mode,target:s=this.target,ignoreDirective:o=null}={}){return{resolver:t,renderer:e,template:n,container:a,mode:r,root:i,target:s,parent:null,ignoreDirective:o}}}class ge extends HTMLElement{constructor(){super(),this.hidden=!0}async execute({template:t,context:e}){return e.content=t.cloneNode(!0),e}}class me extends ge{constructor(){super(),this.attachShadow({mode:"open"})}async execute({template:t,context:e}){return e}}try{customElements.define("jstl-replace",me)}catch(t){}he.define({directive:new class extends he{constructor(){super()}get name(){return"initial"}get rank(){return he.MIN_RANK}get phase(){return he.PHASE.init}async execute(t){const{template:e,renderer:n,resolver:a}=t;if(e instanceof Element)if(e.attr("jstl-ignore"))t.content=document.importNode(e,!0),t.stop=!0,t.ignore=!0;else if(e.attr("jstl-async")){t.content=new me,e.attr("jstl-async",null);const a=t.toRenderOption({mode:"replace",target:t.content});setTimeout((()=>{n.render(a)}),parseInt(e.attr("jstl-async")||"250")||250),t.stop=!0,t.ignore=!0}else if(e instanceof HTMLTemplateElement){t.content=document.createElement(e.tagName);const a=t.subContext({template:e.content.childNodes,container:t.content.content});await n.render(a),t.stop=!0,t.ignore=!0}else if(e.hasAttribute("jstl-tagname")){e.attr("jstl-tagname").trim().length>0?t.content=document.createElement(await a.resolveText(e.attr("jstl-tagname"))):(t.content=document.importNode(e,!0),t.stop=!0,t.ignore=!0)}else if(e.tagName){let n=e.attr("is");if(n){n=await a.resolveText(n);const i=document.createElement(e.tagName,{is:n});i.attr("is",n),t.content=i}else t.content=document.createElement(e.tagName)}else t.content=document.importNode(e,!0),t.stop=!0,t.ignore=!0;else t.content=document.importNode(e,!0);return t}}});const ye={remote:async({data:t,context:e})=>{const{resolver:n,template:a}=e;t=await n.resolveText(t),t=new URL(t,location.origin);let i=await n.resolveText(a.attr("jstl-data-option")||"{}");return i=JSON.parse(i),(t=await fetch(t.toString(),i)).json()},set:async({data:t,context:e})=>{const{resolver:n}=e;return t=await n.resolve(t)},direct:async({data:t,context:e})=>{const{resolver:n}=e;return t=await n.resolveText(t)}};he.define({directive:new class extends he{constructor(){super()}get name(){return"data"}get rank(){return 1e3}get phase(){return he.PHASE.data}async execute(t){if(!(t.template instanceof HTMLElement&&t.template.attr("jstl-data")))return t;try{const{template:e}=t,n=ye[e.attr("jstl-data-mode")||"remote"];if(!n)throw new Error("The jstl-data-mode is unsupported!");let a=e.attr("jstl-data");a=await n({data:a,context:t});const i=e.attr("jstl-data-var");t=(({varname:t,data:e,scope:n,context:a})=>{if(t)a.resolver.updateData(t,e,n);else if(n)a.resolver.mergeContext(e,n);else{const t=new Ht({context:e,name:"jstl-data",parent:a.resolver});a.resolver=t}return a})({varname:i,data:a,scope:e.attr("jstl-data-scope"),context:t})}catch(e){console.error(e,t.template)}return t}}});he.define({directive:new class extends he{constructor(){super()}get name(){return"if"}get rank(){return he.MIN_RANK+1e3}get phase(){return he.PHASE.init}async execute(t){const{template:e}=t;if(!(e instanceof HTMLElement&&e.attr("jstl-if")))return t;const n=e.attr("jstl-if"),a=t.resolver;return await a.resolve(n,!1)||(t.content=null,t.stop=!0,t.ignore=!0),t}}});he.define({directive:new class extends he{constructor(){super()}get name(){return"choose"}get rank(){return he.MIN_RANK+1}get phase(){return he.PHASE.template}async execute(t){if(!(t.template instanceof HTMLElement&&t.template.hasAttribute("jstl-choose")&&0!=t.template.children.length))return t;t.template=t.template.cloneNode(!0);const{template:e,resolver:n}=t;let a=!1;const i=e.find(":scope > [jstl-when]"),r=i.length;for(let t=0;t<r;t++){const e=i[t];!a&&await n.resolve(e.attr("jstl-when"),!1)?a=!0:e.remove()}return a&&e.find(":scope > [jstl-otherwise]").remove(),t}}});he.define({directive:new class extends he{constructor(){super()}get name(){return"include"}get rank(){return he.MIN_RANK}get phase(){return he.PHASE.template}async execute(t){if(!(t.template instanceof HTMLElement&&t.template.attr("jstl-include")))return t;try{const{template:e,resolver:n,renderer:a}=t;let i=e.attr("jstl-include");i=await n.resolveText(i),i=new URL(i,location),i=await qt.load(i);const r=e.attr("jstl-include-mode")||"replace",s=t.subContext({template:i,container:t.content,mode:r});return await a.render(s),await s.ready(),t.ignore=!0,t.stop=!0,t}catch(e){return console.error(e,t.template),t}}}});const we="jstl-foreach",ve="jstl-foreach-var",be="jstl-foreach-status",xe="jstl-foreach-count",Ee="jstl-foreach-start",Ae="jstl-foreach-step",Ne="jstl-foreach-condition",Te=async(t,e)=>{let{template:n,resolver:a,renderer:i,container:r,condition:s,context:o}=e;if(a=new Ht({context:t,name:"jstl-foreach",parent:a}),s=!!s&&await a.resolve(s,!1),s)return!1;const c=o.subContext({resolver:a,container:r,template:n,mode:"append"});return await i.render(c),await c.ready(),!0};he.define({directive:new class extends he{constructor(){super()}get name(){return"foreach"}get rank(){return he.MIN_RANK+2}get phase(){return he.PHASE.template}async execute(t){if(!(t.template instanceof HTMLElement)||!t.template.attr(we)&&!t.template.attr(xe))return t;t.ignore=!0;try{const{template:e,resolver:n,renderer:a,content:i}=t,r={data:(e.attr(we)||"").trim(),count:(e.attr(xe)||"").trim(),start:await n.resolve(e.attr(Ee)||"0"),step:await n.resolve(e.attr(Ae)||"1"),varname:(e.attr(ve)||"item").trim(),status:(e.attr(be)||"status").trim(),condition:e.attr(Ne),template:e.childNodes,resolver:n,renderer:a,container:i,context:t};r.data&&""!=r.data||!r.count?await(async t=>{let{data:e,start:n,step:a,count:i,varname:r,status:s,resolver:o}=t;e=await o.resolve(e);let c=e;e instanceof Array||(c=Object.getOwnPropertyNames(e)),i=""!=i?await o.resolve(i,0):null;const l=i?Math.min(n+i,c.length):c.length;let u=!1;for(let i=n;i<l&&!u;i+=a){const n={};n[r]=e[i],n[s]={index:i,number:i+1,count:l,data:e},u=!await Te(n,t)}})(r):await(async t=>{let{start:e,step:n,count:a,varname:i,status:r,resolver:s}=t;a=await s.resolve(a);const o=e+a*n;let c=!1;for(let s=e;s<o&&!c;s+=n){const e={};e[i]=s,e[r]={index:s,number:s+1,step:n,count:a},c=!await Te(e,t)}})(r)}catch(t){console.error("error at jstl-foreach:",t)}return t}}});const De="jstl-repeat",Me=new Set([De]),Pe={DATA:`${De}`,VAR:`${De}-var`,STATUS:`${De}-status`,COUNT:`${De}-count`,START:`${De}-start`,STEP:`${De}-step`,CONDITION:`${De}-condition`},Le=async(t,e)=>{let{template:n,resolver:a,renderer:i,condition:r,context:s}=e;if(a=new Ht({context:t,name:De,parent:a}),r=!!r&&await a.resolve(r,!1),r)return!1;const o=s.subContext({resolver:a,template:n,mode:"append",ignoreDirective:Me});return await i.render(o),await o.ready(),!0};he.define({directive:new class extends he{constructor(){super()}get name(){return De}get rank(){return he.MIN_RANK+3}get phase(){return he.PHASE.template}async execute(t){if(!(t.template instanceof HTMLElement)||!t.template.attr(Pe.DATA)&&!t.template.attr(Pe.COUNT))return t;try{const{template:e,resolver:n,renderer:a,content:i,container:r}=t,s={data:(e.attr(Pe.DATA)||"").trim(),count:(e.attr(Pe.COUNT)||"").trim(),start:await n.resolve(e.attr(Pe.START)||"0"),step:await n.resolve(e.attr(Pe.STEP)||"1"),varname:(e.attr(Pe.VAR)||"item").trim(),status:(e.attr(Pe.STATUS)||"status").trim(),condition:e.attr(Pe.CONDITION),template:e,tagname:i.tagName,resolver:n,renderer:a,container:r,context:t};s.data&&""!=s.data||!s.count?await(async t=>{let{data:e,start:n,step:a,count:i,varname:r,status:s,resolver:o}=t;e=await o.resolve(e);let c=e;e instanceof Array||(c=Object.getOwnPropertyNames(e)),i=""!=i?await o.resolve(i,0):null;const l=i?Math.min(n+i,c.length):c.length;let u=!1;for(let i=n;i<l&&!u;i+=a){const n={};n[r]=e[i],n[s]={index:i,number:i+1,count:l,data:e},u=!await Le(n,t)}})(s):await(async t=>{let{start:e,step:n,count:a,varname:i,status:r,resolver:s}=t;a=await s.resolve(a);const o=e+a*n;let c=!1;for(let s=e;s<o&&!c;s+=n){const e={};e[i]=s,e[r]={index:s,number:s+1,step:n,count:a},c=!await Le(e,t)}})(s)}catch(t){console.error("error at jstl-repeat:",t)}return t.content=null,t.stop=!0,t.ignore=!0,t}}});const $e={mode:"text",unsecure:!1,preventFormat:!1,maxLength:0},Oe={text:async(t,e)=>{const{content:n,resolver:a,template:i}=e;let r=await a.resolveText(i.textContent);r=create(r,!0).content.textContent,t.maxLength>0&&(r=((t,e)=>t.length>e?t.substring(0,e-3).trim()+"...":t)(r,t.maxLength)),n.textContent=r},html:async(t,e)=>{const{resolver:n,template:a}=e;let i=await n.resolveText(a.textContent);i=create(i,!0),i=document.importNode(i.content,!0),t.unsecure||i.find("script, style, body, html, head, object, link").remove(),e.content=i}};he.define({directive:new class extends he{constructor(){super()}get name(){return"text"}get rank(){return he.MIN_RANK+1}get phase(){return he.PHASE.content}async execute(t){const{template:e}=t;if(!(e instanceof Text)||0==e.textContent.trim().length||e.parentElement&&e.parentElement.hasAttribute("jstl-text-ignore"))return t;const n=e.parentElement,a=n?await(async(t,e)=>{const n=e.resolver;return{mode:await n.resolveText((t.attr("jstl-text-content-type")||"text").trim().toLowerCase()),unsecure:t.hasAttribute("jstl-text-unsecure"),preventFormat:!!t.attr("jstl-text-prevent-format")||!1,maxLength:parseInt(await n.resolveText(t.attr("jstl-text-trim-length")||"0"))}})(n,t):$e,i=Oe[a.mode];if(!i)throw new Error('Text mode "'+a.mode+'" is unsupported!');return await i(a,t),t}}});const ke=/(jstl)?(\?)?(@)?([^\?@]+)/i,Ve="default",Re="prevent-default",Se=["is"],Ce={delegate:async(t,e,n,a,i,r,s,o)=>{const c=await i.resolveText(e,e);r.on(t,Ue(c,n))},toggleclass:async(t,e,n,a,i,r,s,o)=>{const c=s.shift(),l=s.includes(Re),u=e?await i.resolveText(e,e):null;r.on(t,(t=>{l&&t.preventDefault(),u?r.closests(u).toggleClass(c):r.toggleClass(c)}))},toggleattribute:async(t,e,n,a,i,r,s,o)=>{const c=s.shift(),l=s.includes(Re),u=e?await i.resolveText(e,e):null;r.on(t,(t=>{l&&t.preventDefault(),u?r.closests(u).forEach((t=>{t.toggleAttribute(c)})):r.toggleAttribute(c)}))},[Ve]:async(t,e,n,a,i,r,s,o)=>{const c=e?await i.resolve(e,e):null;if(c){if("function"==typeof c)r.on(t,c);else if("string"==typeof c)r.on(t,Ue(c,n));else if("object"==typeof c){const{capture:e=!1,passive:n=!1,once:a=!1}=c;r.on(t,c.eventHandle,{capture:e,passive:n,once:a})}}else console.error(new Error("Can't resolve \""+e+'" to event handle!'))}},Ie=async({condition:t,name:e,value:n,context:a})=>{const{resolver:i,content:r,template:s}=a;let o=t?s.attr(e):n;t=t?n:s.attr("?"+e);const c=He(o);t&&c?!0===(t=await i.resolve(t,!1))&&r.attr(e,await i.resolveText(o,o)):t?!0===(t=await i.resolve(t,!1))&&r.attr(e,!0):c&&r.attr(e,await i.resolveText(o,o))},He=t=>null!=t&&void 0!==t,je=async({condition:t,name:e,value:n,context:a})=>{const{resolver:i,template:r,content:s}=a;let o=(t=t?n:r.attr("?@"+e))?r.attr("@"+e):n,c=e.split(":");const l=c.shift(),u=(c.shift()||Ve).toLowerCase();void 0!==o&&null!=o||console.error(`Definition of "${l}" - event handle at`,s,"is incorrect!"),o=o.trim();const h={bubble:!0};t?1==await i.resolve(t,!1)&&await ze(l,o,h,u,i,s,c,a):await ze(l,o,h,u,i,s,c,a)},ze=async(t,e,n,a,i,r,s,o)=>{const c=Ce[a];if(c)return c(t,e,n,a,i,r,s,o)},Ue=function(t,e){return function(e){e.preventDefault(),e.stopPropagation(),e.currentTarget?e.currentTarget.trigger(t,e):e.target.trigger(t,e)}};he.define({directive:new class extends he{constructor(){super()}get name(){return"attribute"}get rank(){return he.MIN_RANK}get phase(){return he.PHASE.content}async execute(t){const{template:e}=t;if(!(e instanceof HTMLElement))return t;const n=new Set(Se);for(const a of e.attributes){const[,e,i,r,s]=ke.exec(a.name);if(!e&&!n.has(s)){const e=a.value;r?await je({condition:i,event:r,name:s,value:e,context:t}):await Ie({condition:i,name:s,value:e,context:t})}n.add(s)}return t}}});const _e="jstl-attach-element",qe="replace",Fe=/^#.+$/;he.define({directive:new class extends he{constructor(){super()}get name(){return"attach-element"}get rank(){return he.MIN_RANK+1}get phase(){return he.PHASE.content}async execute(t){const{resolver:e,template:n,content:a}=t;if(!(n instanceof HTMLElement&&n.attr(_e)))return t;try{let i=await(async(t,e)=>{let n=(t.attr(_e)||"").trim();if(!Fe.test(n)){try{n=await e.resolve(n,n)}catch(t){}if(n instanceof HTMLElement)return n}try{n=find(n)}catch(t){}return n&&n.length>0?0==n.length?n.first():n:null})(n,e);if(i){const e=n.attr("jstl-attach-element-mode")||qe;e==qe?(a.empty().append(i),t.stop=!0,t.ignore=!0):t.ready((({content:t})=>{t&&("append"==e?t.append(i):"prepend"==e&&t.prepend(i))}))}}catch(e){console.log(e,{context:t})}return t}}});const Ke="on-finished",Ge=`jstl-${Ke}`,Be=`${Ge}-async`;he.define({directive:new class extends he{constructor(){super()}get name(){return Ke}get rank(){return he.MAX_RANK}get phase(){return he.PHASE.finish}async execute(t){const{template:e,content:n,root:a}=t;if(!(e instanceof HTMLElement&&e.hasAttribute(Ge)))return t;const i=e.attr(Ge),r=e.hasAttribute(Be),s=new Ht({context:{$element:n,$root:a,$template:e},name:"jstl-data",parent:t.resolver});return t.finished((async()=>{try{if(!r)return s.resolve(i,null);s.resolve(i,null)}catch(t){console.error(t)}})),t}}});const Xe="data",Je="render",We="container",Ze="node",Qe=new Ht({name:"application"}),Ye={replace:async({container:t,target:e=null,content:n})=>{e?e.replace(n):(t.empty(),t.append(n))},append:async({container:t,target:e=null,content:n})=>{e?e.after(n):t.append(n)},prepend:async({container:t,target:e=null,content:n})=>{e?e.before(n):t.prepend(n)}},tn=async t=>{try{let{template:e,renderer:n}=t;e instanceof ge?await e.execute(t):await en(t);const{ignore:a,content:i}=t;if(!a&&i){let{resolver:e}=t;const a=t.template.childNodes;if(a&&a.length>0){const r=new Ht({name:We,context:null,parent:e}),s=await n.render(t.subContext({container:i,template:a,resolver:r}));await s.ready()}}t.content&&t.content.tagName&&"JSTL"==t.content.tagName&&(t.content=t.content.childNodes)}catch(e){console.error("error at render node:",e,t)}return t},en=async t=>{const e=he.directives,n=e.length;for(let a=0;a<n&&!t.stop;a++){const n=e[a];try{t.acceptDirective(n)&&await n.execute(t)}catch(e){console.error("error at directive:",e,n,t)}}return t};class nn{constructor({template:t,data:e}={}){if(t&&!(t instanceof qt))throw new Error("template must be an instance of Template!");this.template=t,this.resolver=new Ht({name:Xe,context:e||{},parent:Qe})}async render(t){const e=t instanceof fe;if(e){if(t.closed)throw new Error("calling with closed context",t)}else{let{template:e=null,data:n=null,container:a,root:i,mode:r,target:s}=t;e=await(async(t,e)=>{if(t)return(t=await qt.load(t)).importContent();if(e.template)return await e.template.importContent();throw new Error("No content template specified!")})(e,this);const o=new Ht({name:Je,context:n,parent:this.resolver});t=new fe({resolver:o,renderer:this,template:e,container:a,root:i||a,mode:r||"replace",target:s})}return t.template instanceof Node?await tn(t):await(async t=>{let{template:e,resolver:n}=t;if(!e||0==e.length)return t;let a=[];for(let i of e){i.normalize();const e=new Ht({name:Ze,context:null,parent:n}),r=await tn(t.subContext({template:i,resolver:e}));await r.ready();const s=r.content;s&&(s instanceof Array&&(a=a.concat(s)),s instanceof NodeList||s instanceof HTMLCollection?a=a.concat(Array.from(s)):s instanceof Node&&a.push(s))}return t.content=0!=a.length?a:null,t})(t),await(async t=>{if(t.content){const e=Ye[t.mode];if(!e)throw new Error('The "'+t.mode+'" is not supported!');await e(t)}})(t),e||await t.ready(),t}static async build({template:t,data:e}={}){return t&&t instanceof Promise&&(t=await t),t=t?await qt.load(t):null,new nn({template:t,data:e})}static async render({container:t,data:e,template:n,mode:a,target:i}){return new nn({template:n,data:e}).render({container:t,mode:a,target:i})}}const an=bt("app"),rn=bt("route"),sn=new class{constructor(){nt(this,"weakmap",new WeakMap)}data(t){let e=this.weakmap.get(t);return e||(e={},this.weakmap.set(t,e)),e}value(t,e,n){if(2==arguments.length)return this.data(t)[e];void 0===n?delete this.data(t)[e]:this.data(t)[e]=n}destroy(){this.weakmap.delete(reference)}},on="name",cn=[on];class ln extends dt{static get observedAttributes(){return cn}static get NODENAME(){return ce}constructor(t){super(t||{})}get name(){return this.attr(on)}get app(){return an(this)}set app(t){an(this,t)}get route(){return rn(this)}async display({route:t,context:e,view:n,refresh:a=!1}){if(n)throw new Error("you must override the display function!");rn(this,t);const{root:i,app:r}=this;i.empty();let s=t.stateful?sn.value(t,"component"):null;a||!s?(s=await t.component(),s instanceof qt?(await nn.render({container:i,data:{$view:this,$app:r,$store:r.store,$route:t,$context:e},template:s}),s=NodeList.from(i.childNodes)):(s instanceof ln&&(s.app=r,s.ready.then((()=>{s.display({route:t,context:e,view:this})}))),i.append(s)),t.stateful&&sn.value(t,"component",s)):(s instanceof ln&&(s.app=r,s.ready.then((()=>{s.display({route:t,context:e,view:this})}))),i.append(s))}}ft(ln);const un=ln,hn=bt("view"),dn=bt("store"),pn=pt("application"),fn="route",gn="view",mn=(t,e)=>{const n=`${ee.NODENAME}[name="${e}"]`;return t.find(n).first()},yn=(t,e)=>{let n=null;if(e){const a=t.root.find(`d-view[name="${e}"]`).first();a&&1==a.length&&(n=a.first())}return n||(n=((t,e)=>mt(t.root,(t=>t instanceof un&&(null==e||t.name==e))))(t,e)),n&&(n.app=t),n},wn=async(t,e)=>{try{return Ht.resolve(t,e.store,null)}catch(t){return null}},vn=[fn,gn];class bn extends dt{static get observedAttributes(){return vn}static get NODENAME(){return pn}constructor(t){super(t||{}),this.root.on([At,Mt],(async t=>{this.route({route:t.target})})),this.on(ot(fn,this),(()=>{this.hasAttribute(fn)&&this.route({route:this.attr(fn)})}))}async init(){await super.init(),this.ready.then((()=>{this.hasAttribute(fn)&&this.route({route:this.attr(fn)})}))}async routes(){return this.root.find(ee.NODENAME)}async route({route:t,refresh:e=null,context:n=null,view:a=null}){if(await this.ready,0==arguments.length)return this.view.route;if("string"==typeof t)t=mn(this,t);else if(t instanceof oe)e=null!=e?e:t.refresh,null==n&&(n=await wn(t.context,this)),null==a&&(a=t.view),t=mn(this,t.target);else if(!(t instanceof ee))throw new Error("Unsupported route type!");null==e&&(e=!1),null==a&&(a=t.view),a=a?yn(this,a):this.view,(e||a.route!=t)&&(null==n&&(n=await wn(t.context,this)),a.route&&(a.route.active=!1),await a.display({route:t,context:n,refresh:e}),t.active=!0)}get view(){let t=hn(this);return t||(t=yn(this,this.attr(gn)),hn(this,t),t.app=this),t}get store(){let t=dn(this);return t||(t={},dn(this,t)),t}}ft(bn);if(window.Date.prototype.addDays=function(t){const e=new Date(this);return e.setDate(e.getDate()+t),e},"serviceWorker"in navigator){navigator.serviceWorker.register("./serviceworker.js",{scope:"./"}).then((t=>{t.installing?console.log("Service worker installing"):t.waiting?console.log("Service worker installed"):t.active&&console.log("Service worker active")})).catch((t=>{console.log("Registration failed with "+t)}))}class xn extends(ht(HTMLDialogElement)){static get NODENAME(){return"x-dialog"}constructor(){super(),this.on("click",(({target:t})=>{t.is("[close-modal]")&&this.close()}))}async init(){await super.init()}hide(){this.close()}}ft(xn,{extends:"dialog"});class En extends dt{static get NODENAME(){return"x-login-component"}constructor(){super()}async init(){await super.init();const t=await T();if(t){const e=this.attr("template");if(e){const n=await qt.load(new URL(e,location));await nn.render({container:this,data:{user:t},template:n})}}else this.textContent="kein Zugriff erlaubt"}}ft(En);const An="x-clan",Nn=new URL(`${u}/html-clan-element/root.tpl.html`,location);class Tn extends dt{static get NODENAME(){return An}#b=!1;#k=null;constructor(){super(),this.on(`${An}:sort-member-by-name`,(()=>{})),this.on(`${An}:sort-member-by-wtr`,(()=>{}))}async init(){if(await super.init(),!this.#b){const t=await qt.load(Nn);await nn.render({container:this.root,template:t,data:await this.clanData()})}}async clanData(){if(!this.#k){this.#k={id:this.attr("clan-id"),name:this.attr("clan-name"),tag:this.attr("clan-tag")};let t=await fetch(new URL(`/api/clans/${this.#k.id}/members`,location));t=await t.json(),this.#k.members=t.data}return this.#k}}ft(Tn);const Dn=async(t,e)=>{const n=await fetch((t=>t instanceof URL?t:new URL(t,location))(t),e);return n.ok&&n.status>=400?await T():n},Mn=async t=>{const e=await Dn(t,{headers:{"content-type":"application/json"}});if(e.status<204)return e.json()},Pn=async(t,e)=>{const n=await Dn(t,{method:"post",headers:{"content-type":"application/json"},body:JSON.stringify(e)});if(n.status<204)return n.json()},Ln=async t=>{await Dn(t,{method:"delete",headers:{"content-type":"application/json"}})},$n="/api/members";let On=!1;const kn=new Map,Vn=`${u}/html-member-element`,Rn=qt.load(new URL(`${Vn}/root.tpl.html`,location));class Sn extends dt{static get NODENAME(){return"x-member"}#b=!1;constructor(){super();this.root}async init(){await super.init(),this.#b||(await this.render(),this.#b=!0)}get memberId(){return parseInt(this.attr("member-id"))}async render(){const t=await Rn,e=await(async t=>{if(kn.has(t))return kn.get(t);const e=await Mn(`${$n}/${t}`);return e&&kn.set(e.id,e),e})(this.memberId);await nn.render({container:this.root,template:t,data:{member:e}})}}ft(Sn);const Cn="/api/campaigns",In=new Map,Hn=async()=>{let t=null;if(0==In.size){t=(await Mn(Cn)).data;for(const e of t)In.set(e.id,e)}else{t=[];for(const[e,n]of In)t.push(n)}return t},jn=async t=>{if(In.has(t))return In.get(t);const e=await Mn(`${Cn}/${t}`);return In.set(e.id,e),e},zn="d-",Un=500,_n=`${zn}form`,qn=`${zn}submit-action`,Fn=`${zn}page`,Kn=`${zn}field`,Gn=`${zn}container`,Bn=`${zn}list`,Xn=`${zn}rows`,Jn=`${zn}row`,Wn=`${zn}add-row`,Zn=`${zn}delete-row`,Qn=`${zn}progress-bar`,Yn=`${zn}step`,ta=`${zn}validation`,ea=`${zn}message`,na=`${zn}control`,aa=`${zn}control-back`,ia=`${zn}control-next`,ra=`${zn}control-summary`,sa=`${zn}control-submit`,oa="init",ca="validating",la="input",ua="summary",ha="finished",da="d-form-",pa=`${da}initialized`,fa=`${`${da}initialize`}submit-action`,ga=`${da}submit`,ma=`${da}submit-results`,ya=`${da}condition-state-changed`,wa=`${da}site-changed`,va=`${da}state-changed`,ba=`${da}field-input`,xa=`${da}list-row-add`,Ea=`${da}list-row-delete`,Aa=`${da}progress-bar-changed`,Na=`${da}field-initialized`,Ta=`${da}field-removed`,Da=`${da}page-initialized`,Ma=`${da}page-removed`,Pa=`${da}validation-initialized`,La=`${da}validation-removed`,$a=`${da}message-initialized`,Oa=`${da}message-removed`,ka=`${da}active-state-changed`,Va=`${da}valid-state-changed`,Ra=`${da}editable-state-changed`,Sa="$value",Ca="$item",Ia="name",Ha="endpoint",ja="method",za="state",Ua="step",_a="use-summary-page",qa="input-mode-after-submit",Fa="required",Ka="condition",Ga="active",Ba="disabled",Xa="editable",Ja="editable-condition",Wa="readonly",Za="no-value",Qa="valid",Ya="invalid",ti="evaluate",ei="condition-valid",ni="condition-invalid",ai="min",ii="max",ri="progress";const si=class{#V;#d;constructor(t){this.#V=t}get condition(){return this.#d||(this.#d=this.#V.attr(Ka)||!1),this.#d}async validate(t){const e=this.#V;let n=this.condition;const a=e.condition;return n=!n||await Ht.resolve(n,t,!1),n!=a&&(e.condition=n),n}};const oi=class{#V;#d=null;constructor(t){this.#V=t}get condition(){return null==this.#d&&(this.#d=this.#V.attr(Ja)||""),this.#d}async validate(t){let e=!0;const n=this.#V.editable;return this.condition&&(e=await Ht.resolve(this.condition,t,!1)),e!=n&&(this.#V.editable=e),e}};const ci=class{#V;#R=new Set;#S=new Set;constructor(t){this.#V=t,t.on(Pa,(t=>{t.stopPropagation(),this.#R.add(t.target)})),t.on(La,(t=>{t.stopPropagation(),this.#R.delete(t.target)}))}addCustomValidation(t){this.#S.add(t)}async validate(t){const e=this.#V,n=this.#S,a=this.#R,{hasValue:i,required:r,condition:s,editable:o}=(this.#V.valid,this.#V);let c=!0;if(s){c=!r||i,await(async(t,e,n)=>{let a=!0;for(let i of t)await i({data:e,base:n})||(a=!1);return a})(n,t,e)||(c=!1);for(let e of a)if(c&&i){const n=await Ht.resolve(e.condition,t,!0);e.active=!n,n||(c=!1)}else e.active=!1}return e.valid=c,c}};const li=class{#C=new Set;constructor(t){t.on($a,(t=>{t.preventDefault(),t.stopPropagation();const e=t.target;this.#C.add(e)})),t.on(Oa,(t=>{t.preventDefault(),t.stopPropagation();const e=t.target;this.#C.delete(e)}))}async validate(t){for(let e of this.#C)e.update(t)}},ui=t=>null==t||void 0===t,hi=async(t,e,n)=>(ui(n)||(e?fi(t,e,n):Object.assign(t,n)),t),di=async(t,e)=>{let n={};if(e)for(let a of e){const e=a.name,i=t.get(a);n=await hi(n,e,i)}else for(let[{name:e},a]of t)n=await hi(n,e,a);return n},pi=/\./g,fi=function(t,e,n){const a=e.split(pi);if(2==arguments.length)return mi(t,a);const i=ui(n);return ui(t)&&i?t:gi(i,t,n,a)},gi=(t,e,n,a)=>{if(ui(e)&&t)return null;const i=a.shift();return 0==a.length?t?delete e[i]:e[i]=n:(ui(e[i])&&(e[i]={}),gi(t,e[i],n,a)),e},mi=(t,e)=>{if(ui(t))return null;if(0==e.length)return t;const n=e.shift();return mi(t[n],e)},yi=(t,e,n=!1)=>{const a=t.active;e?t.attr(Ga,""):t.attr(Ga,null),(a!=e||n)&&t.trigger(ka)},wi=(t,e,n=!1)=>{const a=t.readonly;e?t.attr(Wa,""):t.attr(Wa,null),(a!=e||n)&&t.trigger(Ra)},vi=bt("form"),bi=[Ga,Wa,Ka,ei,ni,Ja];const xi=class extends dt{static get observedAttributes(){return bi}#I;#H;#j;#z;constructor(){super(),this.#z=new li(this),this.#I=new si(this),this.#H=new oi(this),this.#j=new ci(this)}addValidation(t){this.#j.addCustomValidation(t)}async validate(t){this.attr(ti,"");const e=Object.assign({},t,await(async t=>{await t.ready;const e={};e[Sa]=Ai(t);let n=t.parent(Jn),a=e;for(;n;)a[Ca]=await Ai(n),a=a[Ca],n=n.parent(Jn);return e})(this));return await this.#I.validate(e),await this.#H.validate(e),await this.#j.validate(e),this.attr(ti,null),await this.#z.validate(e),this.valid}get form(){let t=vi(this);return t||(t=this.parent(_n),vi(this,t)),t}get active(){return this.hasAttribute(Ga)}set active(t){this.active!=t&&(yi(this,t),this.activeUpdated())}async activeUpdated(){}get readonly(){return this.hasAttribute(Wa)}set readonly(t){this.editable?wi(this,t,!this.ready.resolved):wi(this,!0,!this.ready.resolved),this.readonlyUpdated()}async readonlyUpdated(){}get editable(){return this.hasAttribute(Xa)}set editable(t){((t,e,n=!1)=>{const a=t.editable;e?t.attr(Xa,""):t.attr(Xa,null),(a!=e||n)&&t.trigger(Ra)})(this,t,!this.ready.resolved),this.editableUpdated(),this.readonly=!t}async editableUpdated(){}set condition(t){var e,n;e=this,void 0===(n=t)||null==n?(e.attr(ni,null),e.attr(ei,null)):n?(e.attr(ni,null),e.attr(ei,"")):(e.attr(ei,null),e.attr(ni,"")),e.trigger(ya),this.conditionUpdated()}get condition(){return!this.hasAttribute(ni)}async conditionUpdated(){}set valid(t){((t,e)=>{void 0===e||null==e?(t.attr(Ya,null),t.attr(Qa,null)):e?(t.attr(Ya,null),t.attr(Qa,"")):(t.attr(Ya,""),t.attr(Qa,null)),t.trigger(Va)})(this,t),this.validUpdated()}get valid(){return this.hasAttribute(Qa)}async validUpdated(){}},Ei=bt("parent"),Ai=bt("value"),Ni=[Ia,Fa,Za];class Ti extends xi{static get observedAttributes(){return Ni.concat(xi.observedAttributes)}constructor(t={}){super(t);const{value:e}=t;Ai(this,e||null)}async init(){this.ready.then((()=>this.trigger(Na))),await super.init()}async destroy(){this.publishValue(null),await super.destroy(),this.trigger(Ta)}get parentField(){let t=Ei(this);return t||(t=(t=>{let e=t.parentNode;for(;e;){if(e instanceof Ti)return e;e=e.parentNode}return null})(this),Ei(this,t)),t}async conditionUpdated(){return this.active=this.condition,this.publishValue()}get name(){return this.getAttribute(Ia)}get required(){return this.hasAttribute(Fa)}get hasValue(){return!this.hasAttribute(Za)}async value(t){const{condition:e,valid:n,ready:a}=this;if(0==arguments.length)return e&&n?Ai(this):null;await a;const i=Ai(this);if(await this.acceptValue(t)&&i!=(t=await this.normalizeValue(t)||t)){const e=await this.updatedValue(t);void 0!==e&&(t=e),await this.publishValue(t)}}async validate(t){const e=this.condition,n=this.valid,a=await super.validate(t),i=this.condition;return this.validationStateChanged(e!=i,n!=a),a}async validationStateChanged(t,e){(t||e)&&this.publishValue()}async updatedValue(t){return t}async publishValue(t){await this.ready,0==arguments.length&&(t=Ai(this));const e=(t=>{if(ui(t))return!0;const e=typeof t;return"string"===e&&0==t.trim().length||!(t instanceof Date)&&(t instanceof Array&&0==t.length||t instanceof Set&&0==t.length||t instanceof Map&&0==t.length||"object"==e&&0==Object.getOwnPropertyNames(t).length)})(t),n=this.condition;var a;t=this.required&&e?null:t,n?Ai(this,t):t=null,a=!e,this.attr(Za,a?null:""),this.parentField?await this.parentField.childValueChanged(this,t):this.form&&await this.form.childValueChanged(this,t)}async acceptValue(t){return!0}async normalizeValue(t){return t}async childValueChanged(t,e){}}const Di=Ti,Mi=(t,e,n,a)=>{let i=null;const r="function"==typeof e?e:()=>e,s="function"==typeof n?n:()=>n;return e=>{r(e)&&e.preventDefault(),s(e)&&e.stopPropagation();const n=(t=>({type:t.type,target:t.target,detail:t.detail,currentTarget:t.currentTarget,explicitOriginalTarget:t.explicitOriginalTarget,originalTarget:t.originalTarget,srcElement:t.srcElement,timeStamp:t.timeStamp}))(e);i&&clearTimeout(i),i=setTimeout((()=>{i=null,t(n)}),a||10)}};class Pi{static findInput(t){return null}#U;constructor(t,e){this.field=t,this.input=e,this.init()}init(){}set readonly(t){}async acceptValue(t){return!0}async normalizeValue(t){return t}async updatedValue(){}get value(){return null}get valid(){return!0}}const Li="text",$i=t=>({accept:t=>"number"==typeof t,getValue:()=>t.valueAsNumber,setValue:e=>{t.valueAsNumber=e},normalize:t=>ui(t)||Number.isNaN(t)?null:t}),Oi=t=>({accept:t=>"string"==typeof t,getValue:()=>t.value,setValue:e=>{t.value=e},normalize:t=>t||null}),ki=new Intl.DateTimeFormat("default",{hour:"numeric",minute:"numeric"}),Vi={text:t=>({accept:t=>"string"==typeof t,getValue:()=>t.value,setValue:e=>t.value=e,normalize:t=>t&&(t=t.trim()).length>0?t:null}),number:$i,datetime:Oi,"datetime-locale":Oi,date:t=>({accept:t=>t instanceof Date,getValue:()=>t.valueAsDate,setValue:e=>{t.valueAsDate=e},normalize:t=>t||null}),time:t=>({accept:t=>t instanceof Date,getValue:()=>t.value?new Date(`1970-01-01T${t.value}`):null,setValue:e=>{t.value=ki.format(e)},normalize:t=>t||null}),range:$i};const Ri=bt("value"),Si=(t,e)=>new Promise(((n,a)=>{const i=new FileReader;i.addEventListener("loadend",(()=>{n({name:t.name,type:t.type,size:t.size,data:i.result})}),!1),i[e](t)})),Ci={"form-input":async t=>(t.format="form-input",t),"data-url-base64":async t=>{const e=await Si(t,"readAsDataURL");return e.format="data-url-base64",e},base64:async t=>{const e=await Si(t,"readAsDataURL");return e.data=e.data.substr(e.data.indexOf(",")+1),e.format="base64",e}},Ii=async(t,e,n)=>{let a=[];for(let n of t)a.push(await Ci[e](n));return 0==a.length?null:n?a:a[0]};const Hi=[class extends Pi{static findInput(t){return t.find('input:not([type="file"],[type="radio"],[type="checkbox"],[type="button"],[type="submit"],[type="reset"]),input:not([type]), textarea').first()}constructor(t,e){super(t,e)}init(){const{field:t,input:e}=this,n=(t.attr("input-type")||e.attr("type")||Li).trim().toLowerCase();this.type=(Vi[n]||Vi[Li])(e),e.on("input",Mi((()=>{t.trigger(ba,this.normalizeValue(this.value))}),!1,!0,Un)),t.trigger(ba,this.normalizeValue(this.value))}acceptValue(t){return null==t||void 0===t||this.type.accept(t)}normalizeValue(t){return null==t&&void 0===t?null:this.type.normalize(t)}async updatedValue(t){t!=this.type.getValue()&&this.type.setValue(t)}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){return this.type.getValue()}get valid(){return this.input.checkValidity()}},class extends Pi{static findInput(t){const e=t.find('input[type="checkbox"]');return 0==e.length?null:1==e.length?e.first():e}constructor(t,e){super(t,e)}init(){const{field:t,input:e}=this;this.multiple=e instanceof NodeList,e.on("input",Mi((()=>{t.trigger(ba,this.normalizeValue(this.value))}),!1,!0,Un)),t.trigger(ba,this.normalizeValue(this.value))}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){const t=this.input.val();if(!(t instanceof Map))return t;if(0==t.size)return null;const e=[];return t.forEach((t=>{e.push(t)})),e}normalizeValue(t){return t?this.multiple?0!=(t=t.filter((t=>!!t))).length?t:null:t:null}acceptValue(t){if(null==t||void 0===t)return!0;if(this.multiple)return t instanceof Array;{const e=typeof t;return"string"===e||"boolean"===e}}updatedValue(t){this.input.val(t||null)}},class extends Pi{static findInput(t){const e=t.find('input[type="radio"]');return 0==e.length?null:e}constructor(t,e){super(t,e)}init(){const{field:t,input:e}=this,n=t.name+Math.floor(Math.random()*Date.now());for(let t of e)t.name=n;e.on("input",Mi((()=>{t.trigger(ba,this.normalizeValue(this.value))}),!1,!0,Un)),t.trigger(ba,this.normalizeValue(this.value))}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){const t=this.input.val();return t instanceof Map?0==t.size?null:t.values().next().value:t}normalizeValue(t){return t||null}acceptValue(t){if(null==t||void 0===t)return!0;{const e=typeof t;return"string"===e||"boolean"===e}}updatedValue(t){this.input.val(t||null)}},class extends Pi{static findInput(t){return t.find('input[type="file"]').first()}constructor(t,e){super(t,e)}async init(){const{field:t,input:e}=this;this.multiple=e.multiple,this.format=t.attr("file-format")||"form-input",this.filenameTarget=t.attr("file-name-target"),this.filenameTarget=this.filenameTarget?t.find(this.filenameTarget).first():null;const{format:n,multiple:a}=this;e.on("input",Mi((async()=>{this.updatedValue(await Ii(e.files,n,a)),t.trigger(ba,this.value)}),!1,!0)),e.files&&0!=e.files.length&&this.updatedValue(await Ii(e.files,n,a)),t.trigger(ba,this.value)}set readonly(t){this.input.attr("disabled",t?"":null)}acceptValue(t){return null==t||void 0===t||(this.multiple?t instanceof Array:"object"==typeof t)}normalizeValue(t){return null==t||void 0===t?null:this.multiple?0!=t.length?t:null:t}updatedValue(t){if(t!=Ri(this)){Ri(this,t),t||(this.input.value=null);const e=this.filenameTarget;if(e&&(e.empty(),t))if(this.multiple)for(let n of t)e.append(`<span>${n.name}</span>`);else e.append(`<span>${t.name}</span>`)}}get value(){return Ri(this)}get valid(){return this.input.checkValidity()}},class extends Pi{static findInput(t){return t.find("select").first()}constructor(t,e){super(t,e)}init(){const{field:t,input:e}=this;e.on("input, changed",Mi((()=>{t.trigger(ba,this.value)}),!1,!0,Un))}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){return this.normalizeValue(this.input.multiple?this.input.val():this.input.value)}normalizeValue(t){return t?this.input.multiple?0!=(t=t.filter((t=>t&&t.trim().length>0))).length?t:null:0!=(t=t.trim()).length?t:null:null}acceptValue(t){return null==t||void 0===t||(this.input.multiple?t instanceof Array:"string"==typeof t)}updatedValue(t){const e=this.input.val();this.field.value!=this.value&&this.input.val(t||e)}}],ji=["file-format"];class zi extends Di{static get observedAttributes(){return ji.concat(Di.observedAttributes)}static get NODENAME(){return Kn}#b=!1;#_;constructor(t){super(t),this.on(ba,(t=>{t.preventDefault(),t.stopPropagation(),this.publishValue(t.detail||null)}))}async init(){await super.init(),this.#b||(this.#b=!0,this.#_=(t=>{for(let e of Hi){const n=e.findInput(t);if(n)return new e(t,n)}return null})(this),this.#_&&(this.addValidation((async()=>this.#_.valid)),this.publishValue(this.#_.value)))}readonlyUpdated(){this.#_&&(this.#_.readonly=this.readonly)}async acceptValue(t){return!!this.#_&&this.#_.acceptValue(t)}async normalizeValue(t){return this.#_?this.#_.normalizeValue(t):t}async updatedValue(t){await this.ready,t=await t;const e=this.#_;if(e){(e.value||null)!=t&&await e.updatedValue(t)}await super.updatedValue(t)}async validationStateChanged(t,e){if(t&&this.condition){const t=this.#_.value||null;Ai(this,t)}return super.validationStateChanged(t,e)}}ft(zi);const Ui=[Ga,Ka];class _i extends dt{static get observedAttributes(){return Ui}static get NODENAME(){return ta}constructor(){super()}async init(){await super.init(),this.active=!1,this.ready.then((()=>this.trigger(Pa)))}async destroy(){this.trigger(La),await super.destroy()}get active(){return this.hasAttribute(Ga)}set active(t){t?this.attr(Ga,""):this.attr(Ga,void 0)}get condition(){return this.attr(Ka)}}ft(_i);const qi=({root:t,filter:e})=>{let n=[];return t.children.forEach((t=>{const{accept:a,stop:i=!1}=e(t);if(a&&n.push(t),!i){const a=qi({root:t,filter:e});a instanceof Array?n=n.concat(a):a&&n.push(a)}})),n},Fi=async(t,e)=>(await Promise.all(e.map((e=>e.validate(t))))).reduce(((t,e)=>!!t&&e),!0),Ki=[];class Gi extends Di{static get observedAttributes(){return Ki.concat(Di.observedAttributes)}static get NODENAME(){return Gn}#q=null;#F=new Map;constructor(t){super(t);const e=this.root;e.on(Na,(t=>{const e=t.target;e!=this&&(!(e instanceof Di)||this.#q&&this.#q.has(e)||(this.#q=null),t.stopPropagation())})),e.on(Ta,(t=>{const e=t.target;e!=this&&(e instanceof Di&&this.#q&&this.#q.has(e)&&this.#q.delete(e),t.stopPropagation())})),this.addValidation((async({data:t})=>await Fi(t,this.fields)))}get fields(){return this.#q||(this.#q=new Set(qi({root:this,filter:t=>t instanceof Di?{accept:!0,stop:!0}:{accept:!1}}))),Array.from(this.#q)}readonlyUpdated(){const{readonly:t,fields:e}=this;if(e)for(let n of e)n.readonly=t}async updatedValue(t){await this.ready;const e=this.#F;e.clear();const n=this.fields;n&&await Promise.all(n.map((async n=>{const a=n.name?fi(t,n.name):t;ui(a)||e.set(n,a),await n.value(a)})));let a=await di(this.#F,n);return 0==Object.getOwnPropertyNames(a).length&&(a=null),a}async childValueChanged(t,e){e=await e;const n=this.#F;if(t){const a=n.has(t),i=null==n.get(t);if(a&&i==e)return;ui(e)?n.delete(t):n.set(t,e)}let a=await di(n,this.fields);0==Object.getOwnPropertyNames(a).length&&(a=null),await this.publishValue(a)}}ft(Gi);const Bi=Gi,Xi=[Ga,Ba];const Ji=class extends dt{static get observedAttributes(){return Xi}#b=!1;#K;constructor(){super(),this.on("click",(t=>{t.preventDefault(),t.stopPropagation(),this.active&&!this.disabled&&this.execute()}))}async init(){await super.init(),this.#b&&(this.active=!1,this.disabled=!1,this.#b=!0)}get form(){return this.#K||(this.#K=this.parent(_n)),this.#K}get active(){return this.hasAttribute(Ga)}set active(t){this.attr(Ga,t?"":null)}get disabled(){return this.hasAttribute(Ba)}set disabled(t){this.attr(Ba,t?"":null)}execute(){console.log("execute")}},Wi=[];class Zi extends Ji{static get observedAttributes(){return Wi.concat(Wi)}static get NODENAME(){return Zn}constructor(){super()}async init(){await super.init(),this.active=!0}execute(){this.trigger(Ea)}}ft(Zi);const Qi=[];class Yi extends Bi{static get observedAttributes(){return Qi.concat(Bi.observedAttributes)}static get NODENAME(){return Jn}constructor(t){super(t)}get active(){return!0}set active(t){}get condition(){return!0}get name(){return null}}customElements.define(Yi.NODENAME,Yi);const tr=`${Wn}:initialized`,er=[];class nr extends Ji{static get observedAttributes(){return er.concat(er)}static get NODENAME(){return Wn}constructor(){super(),this.ready.then((()=>this.trigger(tr)))}async init(){await super.init(),this.active=!0}execute(){this.trigger(xa)}}ft(nr);const ar=[];class ir extends dt{static get observedAttributes(){return ar}static get NODENAME(){return Xn}constructor(){super()}}ft(ir);const rr=[ai,ii],sr=async(t,e)=>{let n=[];for(let a of t)n.push(e.get(a));return 0==n.length&&(n=null),n};class or extends Di{static get observedAttributes(){return rr.concat(Di.observedAttributes)}static get NODENAME(){return Bn}#D;#G;#B=new Map;#X;#b=!1;constructor(t){super(t);const e=this.root;e.on(tr,(t=>{this.#X=t.target,t.stopPropagation()})),e.on(Na,(t=>{t.target!=this&&(t.preventDefault(),t.stopPropagation())})),e.on(xa,(t=>{t.preventDefault(),t.stopPropagation();const{readonly:e}=this;e||this.createRow()})),e.on(Ea,(t=>{t.preventDefault(),t.stopPropagation();const{rows:e,readonly:n}=this;if(!n){const n=t.target.parent(Jn);e.indexOf(n)>=0&&n.remove()}})),this.addValidation((async()=>{const{rows:t,min:e,max:n,readonly:a}=this,i=t.length;return this.#X&&!a&&(i==n?this.#X.disabled=!0:i<n&&(this.#X.disabled=!1)),e<=i&&i<=n})),this.addValidation((async t=>await Fi(t,this.rows)))}async init(){if(await super.init(),!this.#b){this.#b=!0;const t=this.find("template").first();t&&(this.#D=t.content),this.#G=this.find(Xn).first()}}readonlyUpdated(){const{readonly:t}=this;for(let e of this.rows)e.readonly=t}get rows(){return this.#G?Array.from(this.#G.children):[]}get min(){return this.hasAttribute(ai)?Math.max(0,parseInt(this.attr(ai))):0}get max(){return this.hasAttribute(ii)?parseInt(this.attr(ii)):Number.MAX_SAFE_INTEGER}acceptValue(t){return!t||t instanceof Array}normalizeValue(t){return t?t.filter((t=>!!t)):null}async createRow(t){const e=document.importNode(this.#D,!0).children[0];return await this.#G.append(e),t&&await e.value(t),e}async updatedValue(t){return this.#B.clear(),this.#G.empty(),t&&await Promise.all(t.map((t=>this.createRow(t)))),await sr(this.rows,this.#B)}async childValueChanged(t,e){e=await e;const n=this.#B;ui(e)?this.#B.delete(t):this.#B.set(t,e),await super.childValueChanged(t,e);const a=await sr(this.rows,n);await this.publishValue(a)}}ft(or);const cr=[Ua];class lr extends Bi{static get observedAttributes(){return cr.concat(Bi.observedAttributes)}static get NODENAME(){return Fn}constructor(t){super(t),this.ready.then((()=>this.trigger(Da)))}async destroy(){this.trigger(Ma),await super.destroy()}get step(){return this.attr(Ua)}conditionUpdated(){}}ft(lr);const ur="active",hr="condition",dr=[ur,hr];class pr extends dt{static get observedAttributes(){return dr}static get NODENAME(){return ea}constructor(){super()}async init(){await super.init(),this.trigger($a)}async destroy(){this.trigger(Oa),await super.destroy()}get active(){return this.hasAttribute(ur)}set active(t){t?this.attr(ur,""):this.attr(ur,void 0)}get condition(){return this.attr(hr)}async update(t){await this.ready,this.active=await Ht.resolve(this.condition,t,!1)}}ft(pr);const fr=[];class gr extends Ji{static get observedAttributes(){return fr}static get NODENAME(){return aa}constructor(){super()}execute(){this.form.toPrevPage()}}ft(gr);const mr=[];class yr extends Ji{static get observedAttributes(){return mr}static get NODENAME(){return ia}constructor(){super()}execute(){this.form.toNextPage()}}ft(yr);const wr=[];class vr extends Ji{static get observedAttributes(){return wr}static get NODENAME(){return ra}constructor(){super()}execute(){this.form.toNextPage()}}ft(vr);const br=[];class xr extends Ji{static get observedAttributes(){return br}static get NODENAME(){return sa}constructor(){super()}execute(){this.form.submit()}}ft(xr);const Er={active:!0,disabled:!0},Ar=[];class Nr extends dt{static get observedAttributes(){return Ar}static get NODENAME(){return na}#K;#J;#W;#Z;#Q;#b=!1;constructor(){super()}async init(){await super.init(),this.#b||(this.#K=this.parent(_n),this.#J=this.find(aa).first()||Er,this.#W=this.find(ia).first()||Er,this.#Z=this.find(ra).first()||Er,this.#Q=this.find(sa).first()||Er,this.#K.on([pa,va,wa],(()=>{this.update()})),this.#b=!0)}async update(){const t=this.#K,e=t.state,n=this.#J,a=this.#W,i=this.#Z,r=this.#Q;if(n.active=!0,n.disabled=!0,a.active=!1,a.disabled=!0,i.active=!1,i.disabled=!0,r.active=!1,r.disabled=!0,e==ca)return;const{activePageIndex:s,activePage:o,nextPage:c,pages:l,useSummaryPage:u}=t,h=null!=await c;e==ha?(n.disabled=!0,r.active=!0):e==ua?(n.disabled=!1,r.active=!0,r.disabled=!t.valid):e==la&&(n.disabled=s<=0,h||!o.valid&&s+1<l.length?(a.active=!0,a.disabled=!o.valid):u&&e==la?(i.active=!0,i.disabled=!o.valid):(r.active=!0,r.disabled=!t.valid))}}ft(Nr);const Tr=[Ia,Ga,Wa];class Dr extends dt{static get observedAttributes(){return Tr}static get NODENAME(){return Yn}constructor(){super()}get name(){return this.attr(Ia)}get active(){return this.hasAttribute(Ga)}set active(t){this.active!=t&&yi(this,t)}get readonly(){return this.hasAttribute(Wa)}set readonly(t){t?this.attr(Wa,""):this.attr(Wa,null)}}ft(Dr);const Mr=[ri];class Pr extends dt{static get observedAttributes(){return Mr}static get NODENAME(){return Qn}#K;#Y;#b=!1;constructor(){super(),this.on("click",(({target:t})=>{if(!this.#K)return;if(t==this)return;const e=t.is(Yn)?t:t.parent(Yn),n=this.#K;if(!e)return;const{state:a,pages:i,activePage:r}=n,s=e.name;if(a==la||a==ua){const t=((t,e,n)=>{for(let a of t){if(a.step==e&&a.condition)return a;if(a==n)return}return null})(i,s,r);t&&(n.activePage=t)}}))}async init(){if(await super.init(),this.progress=0,!this.#b){const t=this.#K=this.parent(_n);this.#Y=this.find(Yn),this.#K.on([wa,va],(()=>{const e=t.state;if(ca==e)return;const{activePageIndex:n,activePage:a,pages:i}=t;if(!a)return;const r=i.length,s=a?a.step:oa,o=Math.floor(100*n/r);for(let t of this.steps){const n=t.name;e==la?(t.active=n==s,t.readonly=!1):e==ua?(t.active=n==ua,t.readonly=!1):(t.active=n==ha,t.readonly=!0)}this.progress=e==ua||e==ha?100:o,this.trigger(Aa)})),this.#b=!0}}get steps(){return Array.from(this.#Y)}get progress(){return this.attr(ri)}set progress(t){this.style.setProperty&&this.style.setProperty("--progress",t+"%"),this.attr(ri,Math.max(0,Math.min(t,100)))}}ft(Pr);const Lr="success",$r="fail";const Or=class{static get STATE_SUCCESS(){return Lr}static get STATE_FAIL(){return $r}constructor(t,e,n,a){this.action=t,this.state=e,this.message=n,this.data=a}},kr=bt("form");const Vr=class extends dt{constructor(){super()}async init(){await super.init();const t=this.parent(_n);kr(this,t),t&&this.trigger(fa)}get form(){return kr(this)}async accept(t={}){const e=this.attr(Ka);return!e||await Ht.resolve(e,t,!1)}async execute(t={}){return new Or($r,"not implemented")}},Rr=`${qn}-default`;class Sr extends Vr{static get NODENAME(){return Rr}constructor(t,e){super(),this.endpoint=t,this.method=e}async execute(t){let e=this.endpoint;e=await ExpressionResolver.resolveText(e,t,e);const n=new URL(e,location),a=await fetch(n,{method:this.method,credentials:"include",mode:"cors",headers:{"content-type":"application/json"},body:JSON.stringify(t)});return new Or(this,a.ok?Lr:$r,a)}}ft(Sr);const Cr=Sr,Ir=bt("submitAction"),Hr=[Ia,_a,Ha,ja,za,qa],jr=(t,e)=>{for(let n of t.pages)n.readonly=e,n.active=e};class zr extends dt{static get observedAttributes(){return Hr}static get NODENAME(){return _n}#b=!1;#tt=oa;#et;#F=new Map;#nt={};#at=null;#it=!1;constructor(){super();const t=this.root;t.on(Da,(t=>{t.preventDefault(),t.stopPropagation()})),t.on(Ma,(t=>{const e=t.target;this.#et=null,this.childValueChanged(e,null),t.preventDefault(),t.stopPropagation()})),this.ready.then((()=>this.trigger(pa)))}async init(){await super.init(),this.#b||(this.#b=!0,this.activePageIndex=-1,this.state=oa,this.useSummaryPage=this.hasAttribute(_a),this.activePageIndex=-1,this.pages.length>0&&this.toNextPage())}get pages(){return this.#et||(this.#et=Array.from(this.root.find(Fn))),this.#et}get state(){return this.#tt}set state(t){const e=this.#tt;t!=ca&&(e==la&&t!=la?jr(this,!0):e!=la&&t==la&&(jr(this,!1),this.activePage&&(this.activePage.active=!0))),this.#tt=t,e!=t&&this.trigger(va),this.attr(za,t)}get valid(){for(let t of this.pages)if(t.condition&&!t.valid)return!1;return!0}async value(t){return await this.ready,this.#at&&await this.#at,0==arguments.length?this.#nt:this.state!=la?new Promise((e=>{const n=a=>{a.stopPropagation(),this.removeOn(n,va),e(this.value(t))};this.on(va,n)})):(await Promise.all(this.pages.map((e=>{const n=e.name;return n?e.value(fi(t,n)):e.value(t)}))),void await this.#rt())}get activePage(){return 0<=this.activePageIndex&&this.activePageIndex<this.pages.length?this.pages[this.activePageIndex]:null}set activePage(t){const e=this.activePage;t==e&&this.state==la||(e&&(e.active=!1),this.activePageIndex=this.pages.indexOf(t),t.active=!0,this.state!=la&&(this.state=la),this.scrollIntoView(),this.trigger(wa))}get prevPage(){return(async()=>{const t=this.pages,e=this.activePageIndex-1,n=await this.value();for(let a=e;a>=0;a--){const e=t[a];if(await e.validate(n),e.condition)return e}return null})()}get nextPage(){return(async()=>{const t=this.pages,e=this.activePageIndex+1,n=await this.value();if(t)for(let a=e;a<t.length;a++){const e=t[a];if(await e.validate(n),e.condition)return e}return null})()}async toPrevPage(){if(this.state!=la)this.state=la;else{const t=await this.prevPage;t&&(this.activePage=t)}}async toNextPage(){const t=await this.nextPage;t?(this.activePage=t,this.state=la):this.useSummaryPage?this.summary():this.submit()}async summary(){this.state=ua}get submitActions(){let t=Ir(this);if(!t){t=[];let e=this.attr(Ha);if(e){const t=this.attr(ja)||"post";this.append(new Cr(e,t))}const n=this.children;for(let e of n)e instanceof Vr&&t.push(e);Ir(this,t)}return t}async submit(){const t=await this.value();if(!await Fi(t,this.pages))return;this.hasAttribute(qa)||(this.state=ha);const e=this.submitActions;if(e){const n=await(async(t,e)=>{const n=[];for(let a of t)if(await a.accept(e))try{const t=await a.execute(e)||new Or(a,Lr);if(n.push(t),t.state==$r)return n}catch(t){return n.push(new Or(a,$r,t)),n}return n})(e,t);this.trigger(ma,n)}this.trigger(ga,t)}#rt(t){if(this.state==la)return this.state=ca,this.#at=new Promise((e=>{setTimeout((async()=>{const n=this.#nt,a=t?t.validate(n):await Fi(n,this.pages);this.#it||(this.state=la),this.validation=null,e(a)}),10)}));this.state==ca&&this.#at.then((async()=>{this.#it=!1,await this.#rt(t)}))}async childValueChanged(t,e){await this.ready,e=await e;const n=this.#F;t&&(ui(e)?n.delete(t):n.set(t,e)),this.#nt=await di(this.#F,this.pages);const a=this.activePage;a?await this.#rt(a):await this.#rt()}}ft(zr);const Ur=`${u}/html-campaigns-element`,_r=new URL(`${Ur}/root.tpl.html`,location),qr=new URL(`${Ur}/campaign-dialog.tpl.html`,location);class Fr extends dt{static get NODENAME(){return"x-campaigns"}#b=!1;#st;constructor(){super();const t=this.root;t.on(h,(t=>{t.stopPropagation(),this.render()})),t.on("action:create-campaign",(t=>{t.stopPropagation(),this.openCreateDialog()})),t.on("action:close-campaign-dialog",(t=>{t.stopPropagation(),this.#st&&this.#st.close()}))}async init(){await super.init(),this.#b||(await this.render(),this.#b=!0)}async render(){const t=await qt.load(_r);await nn.render({container:this.root,template:t,data:{accessRights:D(),campaigns:await Hn()}})}async openCreateDialog(){const t=this.root;if(!this.#st){const e=await qt.load(qr),n=await nn.render({template:e,container:t,data:{accessRights:D()},mode:"append"});this.#st=n.content[0],this.#st.on("d-form-submit",(t=>{t.preventDefault(),t.stopPropagation();const e=t.target;(async()=>{const t=await e.value();await(async t=>(t=await Pn(`${Cn}`,t),In.set(t.id,t),t))(t),this.#st.close(),await this.render()})()}))}this.#st.showModal()}}ft(Fr);const Kr=t=>`/api/campaigns/${t}/registrations`,Gr=new Map,Br=t=>Gr.get(t),Xr=t=>{if(!t)return;const{campaignid:e,memberid:n}=t;(Gr.has(e)||Gr.set(e,new Map),Gr.get(e)).set(n,t)},Jr=async t=>{if(Gr.has(t))return Array.from(Br(t).values());const e=(await Mn(Kr(t))).data;for(const t of e)Xr(t);return e},Wr=async t=>Zr(t,m.id),Zr=async(t,e)=>{let n=((t,e)=>{const n=Br(t);return n?n.get(e):null})(t,e);return n||(n=await Mn(((t,e)=>`${Kr(t)}/${e}`)(t,e)),Xr(n)),n},Qr=`${u}/html-campaign-element`,Yr=qt.load(new URL(`${Qr}/root.tpl.html`,location)),ts=qt.load(new URL(`${Qr}/registration.tpl.html`,location)),es=qt.load(new URL(`${Qr}/registrations.tpl.html`,location)),ns=(t,e)=>{t=t instanceof Date?t:new Date(t),e=e instanceof Date?e:new Date(e);const n=Math.ceil(Math.abs(t-e)/864e5),a=[];for(let e=0;e<n;e++)a.push(t.addDays(e));return a};class as extends dt{static get NODENAME(){return"x-campaign"}#b=!1;#ot=!1;constructor(){super();const t=this.root;t.on(h,(t=>{t.stopPropagation(),this.render()})),t.on("action:toogle-details",(t=>{t.stopPropagation();const{target:e}=t;e instanceof HTMLDetailsElement&&(this.#ot=e.open)})),t.on("action:show-registrations",(t=>{t.stopPropagation(),this.showRegistrations()})),t.on("action:delete-campaign",(t=>{t.stopPropagation(),(async()=>{await(async t=>{await Ln(`${Cn}/${t}`),In.delete(t)})(this.campaignId),this.remove()})()})),t.on("action:member-registrate",(t=>{t.stopPropagation(),this.openRegistrationDialog()}))}async init(){await super.init(),this.#b||(await this.render(),this.#b=!0)}get campaignId(){return parseInt(this.attr("campaign-id"))}async render(){const t=await Yr;await nn.render({container:this.root,template:t,data:{accessRights:D(),open:this.#ot,campaign:await jn(this.campaignId)}})}async openRegistrationDialog(){const t=await ts,e=await jn(this.campaignId),n={campaign:e,days:ns(e.startdate,e.enddate)},a=(await nn.render({template:t,container:this.root,data:n,mode:"append"})).content[0],i=a.find("d-form").first();i.on("d-form-submit",(t=>{console.log(t),t.stopPropagation(),(async()=>{const t=await i.value(),e=[];let n=!0;for(const a in t)n&&"full"!=t[a].available&&(n=!1),e.push(t[a]);await(async(t,e)=>(e=await Pn(Kr(t),e),Xr(e),e))(this.campaignId,{fullyavailable:n,availability:e}),a.hide(),a.remove()})()})),i.on("action:close-registration-dialog",(t=>{t.stopPropagation(),a.hide(),a.remove()}));const r=await Wr(this.campaignId);if(r){const t=r.availability||[],e={};for(let n=0;n<t.length;n++)e[`day${n+1}`]=t[n];await i.value(e)}a.showModal()}async showRegistrations(){const t=await es,e=await Jr(this.campaignId),n=(await nn.render({container:this,template:t,data:{registrations:e},mode:"append"})).content[0];n.on("close",(()=>{n.remove()})),n.showModal()}}ft(as);const is=`${u}/html-campaign-member-element`,rs=qt.load(new URL(`${is}/root.tpl.html`,location));class ss extends dt{static get NODENAME(){return"x-campaign-member"}#b=!1;constructor(){super()}async init(){await super.init(),this.#b||(this.#b=!0,this.render())}async render(){const t=await rs,e=await this.getRegistration();await nn.render({container:this.root,template:t,data:{registration:e}})}get campaignid(){return this.attr("campaign-id")}get memberid(){return this.attr("member-id")}async getRegistration(){const{campaignid:t,memberid:e}=this;return await Zr(t,e)}}ft(ss);const os="/api/teams",cs=new Map,ls=new Map,us=(t=null,e=!1)=>{const n=`${t||-1}`;if(ls.has(n))return ls.get(n);if(!e)return null;const a=new Map;return ls.set(n,a),a},hs=async t=>{if(cs.has(t))return cs.get(t);const e=await Mn(`${os}/${t}`);cs.set(e.id,e);return us(e.campaignid,!0).set(e.id,e),e},ds=async t=>{t=await Pn(`${os}`,t),cs.set(t.id,t);return us(t.campaignid,!0).set(t.id,t),t},ps=`${u}/html-team-element`,fs=qt.load(new URL(`${ps}/root.tpl.html`,location)),gs=qt.load(new URL(`${ps}/editor.tpl.html`,location));class ms extends dt{static get NODENAME(){return"x-team"}#b=!1;#ot=!1;constructor(){super();const t=this.root;t.on("action:toogle-details",(t=>{t.stopPropagation();const{target:e}=t;e instanceof HTMLDetailsElement&&(this.#ot=e.open)})),t.on("action:delete-team",(t=>{t.stopPropagation(),(async()=>{const t=this.teamId;await(async t=>{await Ln(`${os}/${t}`);const e=cs.get(t),n=us(e.campaignid,!1);n&&n.delete(t),cs.delete(t)})(t),this.trigger("info:team-deleted",t),this.remove()})()})),t.on("action:edit-team",(t=>{t.stopPropagation(),this.editorDialog()}))}async init(){await super.init(),this.#b||(this.render(),this.#b=!0)}get teamId(){return parseInt(this.attr("team-id"))}get campaignId(){return parseInt(this.attr("campaign-id"))}async render(){const t=await fs,e=await hs(this.teamId);await nn.render({template:t,container:this.root,data:{accessRights:D(),open:this.#ot,team:e}})}async editorDialog(){const{root:t,teamId:e}=this,n=await hs(e),a=await gs,i=document.createElement("div");await nn.render({container:i,template:a,data:{team:n}}),t.append(i.innerHTML);const r=t.find(":scope > dialog").last();r.on("d-form-submit",(t=>{t.stopPropagation();const e=t.target;(async()=>{const t=await e.value();await ds(t),r.close(),r.remove(),this.render()})()})),r.on("close",(t=>{t.stopPropagation(),r.remove()}));const s=r.find("d-form").first();await s.ready,await s.value(n),r.showModal()}}ft(ms);const ys=`${u}/html-teams-element`,ws=qt.load(new URL(`${ys}/root.tpl.html`,location));class vs extends dt{static get NODENAME(){return"x-teams"}#b=!1;constructor(){super();this.root.on("action:create-team",(t=>{t.stopPropagation(),(async()=>{const t=this.campaignId?parseInt(this.campaignId):null;await ds({name:"neues Team",campaignid:t}),this.render()})()}))}async init(){await super.init(),this.#b||(await this.render(),this.#b=!0)}get campaignId(){return this.attr("campaign-id")}async render(){const t=await ws,e=await(async(t=null)=>{let e=us(t);if(e)return Array.from(e.values());e=us(t,!0);const n=(await(async()=>Mn(t?`${os}/campaign/${t}`:os))()).data;for(let t of n)e.set(t.id,t),cs.set(t.id,t);return n})(this.campaignId);await nn.render({template:t,container:this.root,data:{accessRights:D(),teams:e}})}}ft(vs);const bs=`${u}/html-team-member-search-field-element`,xs=qt.load(new URL(`${bs}/root.tpl.html`,location)),Es=qt.load(new URL(`${bs}/dialog.tpl.html`,location));class As extends Di{static get NODENAME(){return"x-team-member-search-field"}#b=!1;#ct=null;constructor(){super();const t=this.root;t.on("action:show-selection-dialog",(t=>{t.stopPropagation(),this.readonly||this.showSelectionDialog()})),t.on("action:save-selection",(t=>{t.stopPropagation(),this.readonly||(async()=>{const t=this.#ct.find(".is-selected[member-id]"),e=await Promise.all(t.map((t=>t.attr("member-id"))));await this.publishValue(e),await this.render(),this.#ct.close(),this.#ct.remove(),this.#ct=null})()}))}async init(){await super.init(),this.#b||this.render()}async showSelectionDialog(){if(!this.#ct){const{root:t}=this,e=await Es,n=await(async()=>{const t=new Set,e=await this.value();if(e)for(const n of e)t.add(n);return t})(),a=this.campaignid,i=await(async()=>a?(await Jr(a)).map((t=>({id:t.memberid}))):(async()=>{let t=null;if(On)t=Array.from(kn.values());else{t=(await Mn($n)).data;for(const e of t)kn.set(e.id,e);On=!0}return t})())();await nn.render({template:e,container:t,data:{members:i,memberids:n,campaignid:a},mode:"append"}),this.#ct=t.find(":scope > dialog").first()}this.#ct.showModal()}async render(t){t=t||await this.value();const e=await xs;nn.render({template:e,container:this.root,data:{memberids:t||[],campaignid:this.campaignid}})}get campaignid(){return this.attr("campaign-id")}async acceptValue(t){return t instanceof Array||null==t}async readonlyUpdated(){}async updatedValue(t){this.#ct&&this.#ct.remove(),await this.render(t)}}ft(As);(t=>{const e=(t=new Date)=>{const e=t.getFullYear(),n=t.getMonth();return{date:t=t.getDate(),month:n,year:e,test:1e4*e+100*n+t}},n=(t,n)=>(t=e(t instanceof Date?t:Date.parse(t)),n=e(n instanceof Date?n:Date.parse(n)),t.test>=n.test);t.formUtils=t.formUtils||{date:{greaterEqual:n,greaterEqualNow:t=>n(t,new Date),greater:(t,n)=>(t=e(t instanceof Date?t:Date.parse(t)),n=e(n instanceof Date?n:Date.parse(n)),t.test>n.test)}}})(window),(t=>{const e=new Intl.DateTimeFormat("default",{weekday:"long",month:"long",day:"numeric"});t.DateFormats=t.DateFormats||{toDate:(t=new Date)=>e.format(t)}})(window);document.body.on("action:management:sync-all-data",(async t=>{console.log({event:t}),await fetch("/api/management/sync-data",location)}))})()})();
//# sourceMappingURL=index.d09d5ee6672535493306.min.js.map