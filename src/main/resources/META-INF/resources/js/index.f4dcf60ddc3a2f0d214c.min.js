(()=>{var t={609:()=>{String.prototype.hashcode||(String.prototype.hashcode=function(){if(0===this.length)return 0;let t=0;const e=this.length;for(let n=0;n<e;n++){t=(t<<5)-t+this.charCodeAt(n),t|=0}return t})}},e={};function n(a){var i=e[a];if(void 0!==i)return i.exports;var r=e[a]={exports:{}};return t[a](r,r.exports,n),r.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{"use strict";const t="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{},e=t.fetch,a=t.location.origin;const i=new class{#t={};#e={};#n={};#a=!1;#i=[];#r=[];#s;constructor(){}set ignoreDocumentOrigin(t){this.#a=t}addOriginToIgnore(t){if(t instanceof Array)for(let e of t)this.#n[e.toString()]=!0;else this.#n[t.toString()]=!0}addUrlToIgnore(t){if(t instanceof Array)for(let e of t)this.#e[e.toString()]=!0;else this.#e[t.toString()]=!0}setup(t){("function"==typeof t||t instanceof Promise)&&this.#r.push(t)}addInterceptor(t){if(t instanceof Array)return t.forEach((t=>this.addInterceptor(t)));if("object"!=typeof t)throw new Error("function required an interceptor");if("function"!=typeof t.doAccept)throw new Error('The interceptor required a "doAccept" function!');if("function"!=typeof t.doHandle)throw new Error('The interceptor required a "doHandle" function!');this.#i.push(t),this.reset()}get ready(){return(async()=>0==this.#r.length||(this.#s||(this.#s=(async()=>{for(;0!=this.#r.length;){const t=this.#r[0];if(t){const e=t instanceof Promise?await t:await t();e&&(e instanceof Array?e.forEach((t=>this.addInterceptor(t))):this.addInterceptor(e))}this.#r.shift()}return this.#s=null,this.ready})()),this.#s))()}async doIntercept(t){await this.ready;const e=t.metadata.origin;if(this.#o(e,t.url.toString()))return t;const{url:n,metadata:a}=t,i=await this.#l(e,{url:n,metadata:a});if(!i)return t;for(let e of i)t=await e.doHandle(t);return t}reset(){this.#t={}}async uncheckedFetch(t,n){return e(t,n)}#o(t,e){return!!this.#e[e]||(!(!this.#a||t!=a)||!!this.#n[t])}async#l(t,e){let n=this.#t[t];return n||(n=this.#c(t,e),this.#t[t]=n),n}async#c(t,e){const n=[];for(let t of this.#i)await t.doAccept(e)&&n.push(t);return n}};setTimeout((()=>i.ready),10);const r=i;if(void 0!==t.XMLHttpRequest){const e=t.XMLHttpRequest,n=function(t){e.prototype.open.call(this,t.request.method,t.url,t.metadata.async,t.metadata.username,t.metadata.password),void 0!==t.request.headers&&Object.getOwnPropertyNames(t.request.headers).forEach((n=>{e.prototype.setRequestHeader.call(this,n,t.request.headers[n])})),e.prototype.send.call(this,t.request.body)},a=function(){const a=new e(arguments);let i;return a.setRequestHeader=function(t,e){i.request.headers=i.request.headers||{},i.request.headers[t]=e},a.open=function(e,n,a,r,s){const o=new URL(n,t.location.origin);i={url:new URL(n,location),request:{method:e},metadata:{method:e,origin:o.origin,protocol:o.protocol,hostname:o.hostname,port:o.port,path:o.pathname,query:o.search,hash:o.hash,async:"boolean"!=typeof a||a,username:r,password:s}}},a.send=function(t){i.metadata.async?(i.request.body=t,r.doIntercept(i).then(n.bind(a)).catch(console.error)):n.call(a,i)},a};t.XMLHttpRequest=a,t.XMLHttpRequest.prototype=e.prototype,t.XMLHttpRequest.prototype.constructor=a}t.fetch=async function(n,a){const i=new URL(n,t.location),s=await r.doIntercept({url:new URL(n,location),request:a||{},metadata:{method:void 0===a?"GET":a.method||"GET",origin:i.origin,protocol:i.protocol,hostname:i.hostname,port:i.port,path:i.pathname,hash:i.hash,query:i.search,async:!0}});return e(s.url,s.request)};class s{async doAccept(t){}async doHandle(t){}async unceckedFetch(t,n){return e(t,n)}}const o=async(t,e)=>(e.request.headers=e.request.headers||{},e.request.headers.Authorization=`Bearer ${t}`,e);class l extends s{#u=null;#h={};#d;#p;#f;#g;#m;constructor({condition:t,fetchToken:e,appendToken:n,refreshInterval:a=6e4,refreshToken:i}){if(super(),"string"!=typeof t&&!(t instanceof Array)&&"function"!=typeof t)throw new Error('Parameter "condition" must be a "string", "array" or "function"!');if(this.#d=t,"function"!=typeof e)throw new Error('Parameter "fetchToken" must be a "function"!');if(this.#p=e,n&&"function"!=typeof n)throw new Error('Parameter "appendToken" must be a "function"!');this.#f=n||o,this.#g=a,this.#m=i}async doAccept(t){const e=typeof this.#d,n=this.#d,a=t.metadata.origin;return"function"===e?await n(t):"string"===e?n==a:n instanceof Array&&n.includes(a)}async doHandle(t){if(!this.#u){const{url:e,metadata:n}=t;this.#h={url:e,metadata:n},this.#u=this.#p({url:e,metadata:n}),this.#y()}return this.#w(t)}async#w(t){const e=this.#f,n=await this.#u,a=await e(n,t);return a||t}#y(){if(this.#g>0){this.#m;const t=async()=>{this.#m?await this.#m(this.#h):await this.#p(this.#h),setTimeout(t,this.#g)};setTimeout(t,this.#g)}}}const c={OAuthInterceptor:function(t){const e=t;return e.fetchToken=async()=>{const t=await fetch(e.login.url,{method:e.login.method||"get"});return t=await t.json(),t[e.login.response.valueSelector]},l(t)},TokenInterceptor:l};t.defaultjs=t.defaultjs||{},t.defaultjs.httpinterceptor=t.defaultjs.httpinterceptor||{VERSION:"${version}",Manager:r,Interceptor:s,interceptors:c};const u="/templates",h="global:action:reload-parent";new URL(location);let d,p,f,g=!1,m={};const y=async()=>{let t=await fetch(new URL("/api/system/access",location));if(401==t.status)return!1;if(403==t.status)return null;t=await t.json();const{member:e,accessToken:n,expireAt:a,accessRights:i}=t;return d=e,p=n,f=a,m=i,w(),!0},w=()=>{const t=f-(Date.now()+6e4);setTimeout((async()=>{await y()}),t)},v=()=>m;r.addInterceptor(new class extends s{constructor(){super()}async doAccept(t){return location.origin==t.metadata.origin}async doHandle(t){const e=p;return e&&(t.request.headers=t.request.headers||{},t.request.headers.Authorization=`Bearer ${e}`),t}});const b=function(){const t=Array.from(arguments),e=t.shift();for(;t.length>0;){t.shift()(e)}},x={global:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},globalVar:function(t,e){return 2===arguments.length&&void 0===x.global[t]&&(x.global[t]=e),x.global[t]}},E=x,A=E.globalVar("___DOM_API_EXTENSION_MAP___",{}),N=function(t,e){return function(n){let a=A[n.name];a||(a=A[n.name]={}),a[t]?console.warn('duplicated load of extension "'+t+'"!'):(a[t]=!0,e(n.prototype))}},T=N("EventSupport",(t=>{const e=/(\s+)|(\s*,\s*)/,n=t=>(t.__wrapperhandlemap__||(t.__wrapperhandlemap__=new Map),t.__wrapperhandlemap__),a=(t,a,i)=>{const{wrapper:r,option:s,events:o,handle:l}=a,c=s.capture;if(i){i="string"==typeof i?i.split(e):i;for(let e of i){const a=o.indexOf(e);a>=0&&(t.removeEventListener(e,r,c),o.splice(a,1)),0==o.length&&n(t).delete(l)}}else{for(let e of o)t.removeEventListener(e,r,c);n(t).delete(l)}};t.on=function(){if(arguments.length<2)throw new Error("Too less arguments!");const t=Array.from(arguments);let i="string"==typeof t[0]?t.shift().split(e):t.shift();const r="string"==typeof t[0]?t.shift():null,s=t.shift(),o=void 0===t[0]?{capture:!1,once:!1,passive:!1}:"boolean"==typeof t[0]?{capture:t.shift(),once:!1,passive:!1}:t.shift(),l=function(t){if(r){const e=t.target;if("function"==typeof e.is&&!e.is(r))return}const e=s.apply(null,arguments);return o.once&&a(this,l),e};n(this).set(s,{handle:s,wrapper:l,events:i,option:o});for(let t of i)this.addEventListener(t,l,o);return this},t.removeOn=function(t,e,i){const r=n(this).get(t);return r?a(this,r,e):this.removeEventListener(t,e,i),this},t.trigger=function(){const t=Array.from(arguments),e="number"==typeof t[0]?t.shift():-1;if(e>=0){const a=t[0],i=((n=this).___EVENTTRIGGERTIMEOUTS___||(n.___EVENTTRIGGERTIMEOUTS___={}),n.___EVENTTRIGGERTIMEOUTS___),r=i[a];r&&clearTimeout(r),i[a]=setTimeout((()=>{delete i[a],this.trigger.apply(this,t)}),e)}else{const e=t.shift(),n=t[0]instanceof Event?t.shift():null,a=t.length>=1?1==t.length?t.shift():t:n,i=a?new CustomEvent(e,{bubbles:!0,cancelable:!0,composed:!0,detail:a}):new Event(e,{bubbles:!0,cancelable:!0,composed:!0});n&&(i.delegatedEvent=n),this.dispatchEvent(i)}var n;return this}}));b(EventTarget,T);const D=N("DataSupport",(t=>{t.data=function(){const t={};if(void 0!==this.dataset)for(name in this.dataset)t[name]=this.dataset[name];return this.data=function(){return 0==arguments.length?t:1==arguments.length?t[arguments[0]]:(void 0===arguments[1]||null==arguments[1]?delete t[arguments[0]]:t[arguments[0]]=arguments[1],this)}.bind(this),this.data.apply(null,arguments)}})),M=N("ManipulationSupport",(t=>{t.empty=function(){let t=this.childNodes;for(;0!=t.length;)t[0].remove(!0);return this},t.content=function(){return this.childNodes},t.html=function(){return 0==arguments.length?this.innerHTML:1==arguments.length&&"boolean"==typeof arguments[0]?arguments[0]?this.outerHTML:this.innerHTML:(Array.from(arguments).forEach((t=>{this.empty(),("string"==typeof t||t instanceof Node||t instanceof NodeList||t instanceof HTMLCollection)&&this.append(t)})),this)};const e=function(){const e=t.appendChild.bind(this);for(let t=0;t<arguments.length;t++){let n=arguments[t];n instanceof Node?this.appendChild(n):"string"==typeof n?create(n).forEach(e):"function"==typeof n.forEach&&n.forEach(e)}};t.append=e;const n=function(t,e){this.insertBefore(e,t)};t.prepend=function(){if(0==this.childNodes.length)e.apply(this,arguments);else{const t=this.childNodes.first(),e=n.bind(this,t);for(let t=0;t<arguments.length;t++){const n=arguments[t];n instanceof Node?e(n):("string"==typeof n||"function"==typeof n.forEach)&&n.forEach(e)}}},t.replace=function(){if(arguments.length<1)throw new Error("Insufficient arguments! One or two nodes required!");const t=1==arguments.length?this.parentNode:this,e=1==arguments.length?this:arguments[0],n=1==arguments.length?arguments[0]:arguments[1];n instanceof Array||n instanceof NodeList||n instanceof HTMLCollection?(n.forEach((n=>t.insertBefore(n,e))),e.remove()):t.replaceChild(n,e)},t.after=function(){if(null==this.parentNode)throw new Error("Can't insert nodes after this node! Parent node not available!");const e=this.parentNode,n=this.nextSibling;n?t.before.apply(n,arguments):t.append.apply(e,arguments)},t.before=function(){if(null==this.parentNode)throw new Error("Can't insert nodes after this node! Parent node not available!");const t=this.parentNode,e=e=>{t.insertBefore(e,this)};for(let t=0;t<arguments.length;t++){const n=arguments[t];n instanceof Node?e(n):("string"==typeof n||"function"==typeof n.forEach)&&n.forEach(e)}}})),P=M;b(Node,D,P);const L=/:parent(\(\"([^\)]*)\"\))?/i,$=function(t,e){let n=L.exec(e);if(!n)return t.querySelectorAll(e);{let a=t;if(n.index>0&&(a=t.querySelectorAll(e.substr(0,n.index)),0==a.length))return;if(a=a.parent(n[2]),a){let t=e.substr(n.index+n[0].length).trim();return t.length>0&&(a=a.find(t)),a}}},V=N("QuerySupport",(t=>{t.find=function(){let t=[],e=Array.from(arguments),n=e.shift();for(;n;){if("string"==typeof n){let e=$(this,n);e&&t.push(e)}n=e.shift()}return NodeList.from.apply(null,t)},t.is=function(){if(this instanceof Document||this instanceof DocumentFragment)return!1;if(1==arguments.length){if("string"==typeof arguments[0])return this.matches(arguments[0]);if("number"==typeof arguments[0].length){let t=arguments[0];for(let e=0;e<t.length;e++)if(this.matches(t[e]))return!0}}else if(arguments.length>1)return this.is(Array.from(arguments));return!1},t.parent=function(t,e){if(!this.parentNode)return null;e="boolean"==typeof t?t:e,t="string"==typeof t?t:null;let n=this.parentNode;if(n instanceof ShadowRoot&&e&&(n=n.host),t){try{for(;n&&!n.is(t);)n=n.parent(t,e)}catch(t){console.error("this:",this,"parent:",n,"error:",t)}return n}return n},t.parents=function(){let e=new Array,n=t.parent.apply(this,arguments);for(;n;)e.push(n),n=t.parent.apply(n,arguments);return NodeList.from(e)},t.selector=function(){if(!(this instanceof Document||this instanceof DocumentFragment)){if(this.id)return"#"+this.id;{let t=this.tagName.toLowerCase(),e=this.parent();if(e){let n=e.find(":scope>"+t);if(n instanceof NodeList){let e=n.indexOf(this);e>0&&(t+=":nth-child("+(e+1)+")")}let a=e.selector();return a?a+">"+t:t}return t}}},t.closest=function(t){return this.closests(t).first()},t.closests=function(t){const e=this.find(t);if(0!=e.length)return e;const n=this.parentElement;return n?n.closests(t):NodeList.from([])},t.nested=function(t){if(this.is(t))return NodeList.from(this);let e=this.find(t);return e&&e.length>0?e:NodeList.from(this.parent(t))}})),k=V,O=N("AttributeSupport",(t=>{t.attr=function(){return 0==arguments.length?this.hasAttributes()?(()=>{const t={};return this.getAttributeNames().forEach((e=>{t[e]=this.getAttribute(e)})),t})():void 0:1==arguments.length?this.getAttribute(arguments[0]):(void 0===arguments[1]||null==arguments[1]?this.removeAttribute(arguments[0]):this.setAttribute(arguments[0],arguments[1]),this)}}));b(Element,k,O,P);const C=N("ReadyEventSupport",(t=>{t.ready=function(t,e){return this.on("ready",t,e),"complete"==document.readyState&&this.trigger("ready"),this}}));b(Document,k,C),document.addEventListener("DOMContentLoaded",(()=>document.trigger("ready"))),b(DocumentFragment,k,P);const R=N("HtmlClassSupport",(t=>{t.addClass=function(){return 1==arguments.length?arguments[0].split(/\s+/).forEach((t=>this.classList.add(t))):arguments.length>1&&Array.prototype.forEach.call(arguments,(t=>this.classList.add(t))),this},t.removeClass=function(){return 1==arguments.length?arguments[0].split(/\s+/).forEach((t=>this.classList.remove(t))):arguments.length>1&&Array.prototype.forEach.call(arguments,(t=>this.classList.remove(t))),this},t.toggleClass=function(){return 1==arguments.length?arguments[0].split(/\s+/).forEach((t=>this.classList.toggle(t))):arguments.length>1&&Array.prototype.forEach.call(arguments,(t=>this.classList.toggle(t))),this}})),S="none",I=t=>t.style.display===S,H=t=>{let e=I(t)?"":t.style.display;return t.show=function(){return this.style.display=e,this}.bind(t),t.hide=function(){return this.style.display=S,this}.bind(t),t},j=N("ShowHideSupport",(t=>{t.show=function(){return H(this).show.apply(null,arguments)},t.hide=function(){return H(this).hide.apply(null,arguments)},t.toggleShow=function(){return I(this)?this.show():this.hide()}}));b(HTMLElement,R,j);const z=[{selector:"select",get:function(){const t=[];return this.find("option").forEach((e=>{e.selected&&t.push(e.value)})),t},set:function(){let t=[];const e=Array.from(arguments);let n=e.shift();for(;n;)Array.isArray(n)?t=t.concat(n):t.push(n),n=e.shift();this.value=t,this.find("option").forEach((e=>e.selected=t.indexOf(e.value)>=0)),this.trigger("changed")}},{selector:'input[type="checkbox"], input[type="radio"]',get:function(){return"on"==this.value||"off"==this.value?this.checked:this.checked?this.value:void 0},set:function(t){"boolean"==typeof t?this.checked=t:"string"==typeof t?this.checked=this.value==t:Array.isArray(t)&&(this.checked=t.indexOf(this.value)>=0),this.trigger("changed")}}],U={get:function(){return this.value},set:function(t){this.value=t,this.trigger("input")}},_=N("ValueSupport",(t=>{t.val=function(){let t=function(t){for(let e=0;e<z.length;e++)if(t.is(z[e].selector))return z[e];return U}(this);return 0==arguments.length?t.get.apply(this,arguments):(t.set.apply(this,arguments),this)}}));b(HTMLInputElement,_),b(HTMLTextAreaElement,N("ValueSupport",(t=>{t.val=function(){return 0==arguments.length?this.value:(this.value=arguments[0],this)}}))),b(HTMLSelectElement,_);const q=function(){const t=Array.from(arguments),e=t.shift(),n=t.shift();t.forEach((t=>{Object.getOwnPropertyNames(t).forEach((a=>{const i=Object.getOwnPropertyDescriptor(t,a);void 0===n[a]&&"function"==typeof i.value&&(n[a]=function(){return e.call(this,a,arguments)})}))}))},F=N("ListSupport",(t=>{t.indexOf=function(){for(let t=0;t<this.length;t++)if(this[t]==arguments[0])return t;return-1},t.forEach=function(){return Array.prototype.forEach.apply(Array.from(this),arguments)},t.map=function(){return Array.prototype.map.apply(Array.from(this),arguments)},t.filter=function(){return Array.prototype.filter.apply(Array.from(this),arguments)},t.first=function(){if(this.length>0)return this[0]},t.last=function(){if(this.length>0)return this[this.length-1]}}));b(NodeList,F),NodeList.prototype.applyTo=function(){const t=Array.from(arguments),e=t.shift(),n="function"==typeof e,a=[];for(let i=0;i<this.length;i++){const r=this[i];let s;n?s=e.apply([r].concat(t)):"function"==typeof r[e]&&(s=r[e].apply(r,t)),s&&a.push(s)}return a},NodeList.prototype.val=function(){if(0==arguments.length){if(this.length>0){const t=new Map;return this.forEach((e=>{if("function"==typeof e.val){e.val()&&t.set(e.name||e.id||e.selector(),e.val())}})),t}}else NodeList.prototype.applyTo.apply(this,["val"].concat(Array.from(arguments)))},NodeList.from=function(){const t=Array.from(arguments),e={};let n=0;for(;t.length>0;){const a=t.shift();if(void 0!==a&&null!=a)if(a instanceof Node)e[n++]={value:a,enumerable:!0};else if(a instanceof NodeList||a instanceof HTMLCollection||a instanceof Array)for(let t=0;t<a.length;t++)a[t]&&a[t]instanceof Node&&(e[n++]={value:a[t],enumerable:!0})}return e.length={value:n},Object.create(NodeList.prototype,e)},q((function(t,e){let n=[];return this.forEach((a=>{if(a&&"function"==typeof a[t]){const i=a[t].apply(a,e);i&&(i instanceof NodeList?n=n.concat(Array.from(i)):n.push(i))}})),0===n.length?void 0:n[0]instanceof Node||n[0]instanceof NodeList?NodeList.from(n):n}),NodeList.prototype,Node.prototype,HTMLElement.prototype,HTMLInputElement.prototype,Element.prototype,EventTarget.prototype),b(HTMLCollection,F),HTMLCollection.prototype.applyTo=function(){const t=Array.from(arguments),e=t.shift(),n="function"==typeof e,a=[];for(let i=0;i<this.length;i++){const r=this[i];let s;n?s=e.apply([r].concat(t)):"function"==typeof r[e]&&(s=r[e].apply(r,t)),s&&a.push(s)}return a},HTMLCollection.prototype.val=function(){if(0==arguments.length){if(this.length>0){const t=new Map;return this.forEach((e=>{if("function"==typeof e.val){e.val()&&t.set(e.name||e.id||e.selector(),e.val())}})),t}}else HTMLCollection.prototype.applyTo.apply(this,["val"].concat(Array.from(arguments)))},HTMLCollection.from=function(){const t=Array.from(arguments),e={};let n=0;for(;t.length>0;){const a=t.shift();if(void 0!==a&&null!=a)if(a instanceof HTMLElement)e[n++]={value:a,enumerable:!0};else if(a instanceof HTMLCollection||a instanceof NodeList||a instanceof Array)for(let t=0;t<a.length;t++)a[t]&&a[t]instanceof HTMLElement&&(e[n++]={value:a[t],enumerable:!0})}return e.length={value:n},Object.create(HTMLCollection.prototype,e)},q((function(t,e){let n=[];return this.forEach((a=>{if(a&&"function"==typeof a[t]){let i=a[t].apply(a,e);i&&(i instanceof HTMLCollection?n=n.concat(Array.from(i)):n.push(i))}})),0===n.length?void 0:n[0]instanceof HTMLElement||n[0]instanceof HTMLCollection?HTMLCollection.from.apply(null,n):n}),HTMLCollection.prototype,Node.prototype,HTMLElement.prototype,HTMLInputElement.prototype,Element.prototype,EventTarget.prototype),E.global.defaultjs=E.global.defaultjs||{},E.global.defaultjs.extdom=E.global.defaultjs.extdom||{VERSION:"${version}",utils:{Utils:E}},E.global.find=function(){return document.find.apply(document,arguments)},E.global.ready=function(){return document.ready.apply(document,arguments)},E.global.create=function(t,e){if("string"!=typeof arguments[0])throw new Error("The first argument must be a string!");const n=document.createElement("template");return n.innerHTML=t,e?n:document.importNode(n.content,!0).childNodes},E.global.script=function(t,e){return t instanceof Array?Promise.all(t.map((t=>E.global.script(t,e)))):"string"==typeof t?new Promise(((n,a)=>{const i=document.createElement("script");i.async=!0,i.onload=function(){n()},i.onerror=function(){throw new Error("load error!")},e?e.append(i):document.body.append(i),i.src=t})):Promise.reject("First parameter must be an array of strings or a string!")};class K{constructor(t,e){this.key=t,this.context=e}get keyDefined(){return this.key in this.context}get hasValue(){return!!this.context[this.key]}get value(){return this.context[this.key]}set value(t){this.context[this.key]=t}set append(t){if(this.hasValue){const e=this.value;e instanceof Array?e.push(t):this.value=[this.value,t]}else this.value=t}remove(){delete this.context[this.key]}static load(t,e,n=!0){let a=t;const i=e.split(".");let r=i.shift().trim();for(;i.length>0;){if(!a[r]){if(!n)return null;a[r]={}}a=a[r],r=i.shift().trim()}return new K(r,a)}}const G=function(t){return void 0!==t&&null!=t&&"Object"===t.constructor.name},X=function(t,...e){t||(t={});for(let n of e)G(n)&&Object.getOwnPropertyNames(n).forEach((e=>{G(t[e])?X(t[e],n[e]):t[e]=n[e]}));return t},B=function(){const[t,e,{deep:n=!1,recursive:a=!0,parents:i=[]}={}]=arguments,r={};for(let s in t){const o=t[s],l=e(s,o,t);if(!l||n&&null!=o){if(l&&n){"object"!==typeof o||o instanceof Array||o instanceof Map||o instanceof Set||o instanceof RegExp||i.includes[o]||o==t?r[s]=o:r[s]=B(o,e,{deep:n,recursive:a,parents:i.concat(t)})}}else r[s]=o}return r},W=(t,e,n)=>{Object.defineProperty(t,e,{value:n,writable:!1,configurable:!1,enumerable:!1})},J=(t,e,n)=>{Object.defineProperty(t,e,{get:n,configurable:!1,enumerable:!1})},Z={isPojo:G,append:function(t,e,n){if(void 0!==e){K.load(n,t,!0).append=e}return n},merge:X,filter:B,buildPropertyFilter:function({names:t,allowed:e}){return(n,a,i)=>t.includes(n)===e},defValue:W,defGet:J,defGetSet:(t,e,n,a)=>{Object.defineProperty(t,e,{get:n,set:a,configurable:!1,enumerable:!1})}},Q=()=>{let t=null,e=null;const n=new Promise(((n,a)=>{t=n,e=a}));let a,i=!1,r=!1;return W(n,"resolve",(n=>{a=n,i=!0,a instanceof Error?(r=!0,e(a)):t(a)})),J(n,"value",(()=>a)),J(n,"error",(()=>r)),J(n,"resolved",(()=>i)),n},Y=(t,e)=>{let n="unsupported";if("string"==typeof e)n=e;else if(e instanceof HTMLElement)n=e.nodeName;else{if("string"!=typeof e.NODENAME)throw new Error(typeof e+' is not supported as parameter "node"!');n=e.NODENAME}return`${n.toLowerCase()}:${t}`},tt=(t,e)=>Y(`attribute--${t}`,e),et=new WeakMap,nt=t=>class extends t{#v=Q();constructor({shadowRoot:t=!1,content:e=null,createUID:n=!1,uidPrefix:a="id-",uidSuffix:i=""}={}){super(),n&&this.attr("id",n(a,i)),t&&this.attachShadow({mode:"open"}),e&&this.root.append("function"==typeof e?e(this):e)}get root(){return this.shadowRoot||this}get ready(){return this.#v}async init(){}async destroy(){this.ready.resolved&&(this.#v=Q())}connectedCallback(){this.ownerDocument==document&&this.isConnected&&(t=>{let e=et.get(t);e&&clearTimeout(e),et.get(t,setTimeout((async()=>{et.delete(t);try{await t.init(),t.ready.resolve()}catch(e){console.error("Can't initialize component!",t,e),t.ready(resolve(e))}t.trigger(Y("initialzed",t))}),10))})(this)}adoptedCallback(){this.connectedCallback()}attributeChangedCallback(t,e,n){e!=n&&this.isConnected&&(this.trigger(10,tt(t,this)),this.trigger(10,Y("change",this)))}disconnectedCallback(){this.destroy()}},at=new Map,it=t=>{let e=at.get(t);return null==e&&(e=nt(t),at.set(t,e)),e},rt=it(HTMLElement),st=(t,e)=>"string"==typeof e?e+t:"d-"+t,ot=function(t,e){const n=t.NODENAME;customElements.get(n)||customElements.define(n,t,e)},lt=(t,e,n)=>{if(n(t))return{node:t,depth:e};let a=null;for(let i of t.childNodes){const t=lt(i,e+1,n);null!=t&&(null==a||a.depth>t.depth)&&(a=t)}return a},ct=(t,e)=>{const n=lt(t,0,e);return null!=n?n.node:null},ut=new WeakMap,ht=t=>{if(ut.has(t))return ut.get(t);const e={};return ut.set(t,e),e},dt=function(t,e,n){const a=ht(t);if(1===arguments.length)return a;if(2===arguments.length)return a[e];if(3!==arguments.length)throw new Error("Not allowed size of arguments!");a[e]=n},pt=t=>function(e,n){if(2!=arguments.length)return dt(e,t);dt(e,t,n)},ft=st("route"),gt=`${ft}-init`,mt=`${ft}-click`,yt=`${ft}-activate`,wt=`${ft}-deactivate`,vt=st("route-link"),bt=vt+"-to-route",xt=void 0!==n.g?n.g:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{};class Et{constructor(t){this.hasValue=1==arguments.length,this.value=t}}class At{constructor(t,e){this.data=t,this.resolver=e,this.cache=new Map}updateData(t){this.data=t,this.cache=new Map}resetCache(){this.cache=new Map}getPropertyDef(t,e=!0){if(this.cache.has(t))return this.cache.get(t);let n=null;if(this.data&&t in this.data)n={data:this.data,resolver:this.resolver,defined:!0};else{if(!e)return null;n=((t,e)=>{for(;t;){const n=t.proxy.handle.getPropertyDef(e,!1);if(n)return n;t=t.parent}return{data:null,resolver:null,defined:!1}})(this.resolver.parent,t)}return n.defined&&this.cache.set(t,n),n}hasProperty(t){const{defined:e}=this.getPropertyDef(t);return e}getProperty(t){const{data:e}=this.getPropertyDef(t);return e?e[t]:void 0}setProperty(t,e){const{data:n,defined:a}=this.getPropertyDef(t);a?n[t]=e:(this.data||(this.data={}),this.data[t]=e,this.cache.set(t,{data:this.data,resolver:this.resolver,defined:!0}))}deleteProperty(t){throw new Error("unsupported function!")}}class Nt{constructor(t,e){this.handle=new At(t,e),this.data=new Proxy(this.handle,{has:function(t,e){return t.hasProperty(e)},get:function(t,e){return t.getProperty(e)},set:function(t,e,n){return t.setProperty(e,n)},deleteProperty:function(t,e){return t.deleteProperty(e)}})}updateData(t){this.handle.updateData(t)}resetCache(){this.handle.resetCache()}}const Tt=/(\\?)(\$\{(([a-zA-Z0-9\-_\s]+)::)?([^\{\}]+)\})/,Dt=new Et,Mt=t=>t instanceof Et?t:new Et(t),Pt=async function(t,e,n,a){if(n&&t.name!=n)return t.parent?Pt(t.parent,e,n,a):null;const i=await async function(t,e){if("string"!=typeof t)return t;const n=new Function("context",`\nreturn (async (context) => {\n\ttry{ \n\t\twith(context){\n\t\t\t return ${t}\n\t\t}\n\t}catch(e){\n\t\tthrow e;\n\t}\n})(context)`);let a,i=setTimeout((()=>{i=null,console.warn("long running statement:",t,new Error)}),1e3);try{a=await n(e)}catch(t){}return i&&clearTimeout(i),a}(e,t.proxy.data);return null!=i?i:a instanceof Et&&a.hasValue?a.value:void 0},Lt=async(t,e,n)=>e[1]?e[2]:Pt(t,e[5],$t(e[4]),n),$t=t=>t?0==(t=t.trim()).length?null:t:null;class Vt{constructor({context:t=xt,parent:e=null,name:n=null}){this.parent=e instanceof Vt?e:null,this.name=n,this.context=t,this.proxy=new Nt(this.context,this)}get chain(){return this.parent?this.parent.chain+"/"+this.name:"/"+this.name}get effectiveChain(){return this.context?this.parent?this.parent.effectiveChain+"/"+this.name:"/"+this.name:this.parent?this.parent.effectiveChain:""}get contextChain(){const t=[];let e=this;for(;e;)e.context&&t.push(e.context),e=e.parent;return t}getData(t,e){if(t){if(!e||e==this.name){const e=K.load(this.context,t,!1);return e?e.value:null}this.parent&&this.parent.getData(t,e)}}updateData(t,e,n){if(t)if(n&&n!=this.name)this.parent&&this.parent.updateData(t,e,n);else{null!=this.context&&void 0!==this.context||(this.context={},this.proxy.updateData(this.context));K.load(this.context,t).value=e,this.proxy.resetCache()}}mergeContext(t,e){e&&e!=this.name?this.parent&&this.parent.mergeContext(t,e):this.context=this.context?Z.merge(this.context,t):t}async resolve(t,e){const n=2==arguments.length?Mt(e):Dt;try{const e=Tt.exec(t);return e?await Lt(this,e,n):await Pt(this,$t(t),null,n)}catch(e){return console.error('error at executing statment"',t,'":',e),n.hasValue?n.value:t}}async resolveText(t,e){let n=t,a=t,i=Tt.exec(n);const r=2==arguments.length?Mt(e):Dt;for(;null!=i;){const t=await Lt(this,i,r);a=a.split(i[0]).join(),n=n.split(i[0]).join(void 0===t?"undefined":null==t?"null":t),i=Tt.exec(a)}return n}static async resolve(t,e,n,a){const i=new Vt({context:e}),r=arguments.length>2?Mt(n):Dt;return"number"==typeof a&&a>0?new Promise((e=>{setTimeout((()=>{e(i.resolve(t,r))}),a)})):i.resolve(t,r)}static async resolveText(t,e,n,a){const i=new Vt({context:e}),r=arguments.length>2?Mt(n):Dt;return"number"==typeof a&&a>0?new Promise((e=>{setTimeout((()=>{e(i.resolveText(t,r))}),a)})):i.resolveText(t,r)}static buildSecure({context:t,propFilter:e,option:n={deep:!0},name:a,parent:i}){return t=Z.filter({data:t,propFilter:e,option:n}),new Vt({context:t,name:a,parent:i})}}n(609);const kt="template",Ot={},Ct=async(t,e,n)=>Rt(create(t,!0),e,n),Rt=async(t,e,n)=>{let a=null;if(t instanceof HTMLTemplateElement)a=new St(t,n);else{if(a=document.createElement("template"),!(t instanceof Node||t instanceof NodeList||t instanceof HTMLCollection||t instanceof Array))throw new Error("Template type is not supported!");a.content.append(t.cloneNode(!0)),a=new St(a,n)}if(!a)throw new Error("Template can't loaded!");return e&&n&&(Ot[n]=a),a};class St{constructor(t,e){this.template=t,this.key=e}importContent(t=document){return t.importNode(this.template,!0).content.childNodes}remove(){this.key&&Ot[this.key]&&delete Ot[this.key]}static async fetch(t,e=!0,n=null){return"string"==typeof t?St.load(new URL(t,loaction),e,n):t instanceof URL?St.load(t,e,n):void new Error("The url isn't a allowed type! -> [String|URL] required!")}static async load(t,e=!0,n=null){if(t instanceof St)return t;const a=((t,e,n)=>{if(!e)return null;let a=null;return n?a=n:"string"==typeof t?a=t:t instanceof URL?a=t.toString():t instanceof HTMLElement&&(a=t.selector()),a?a.hashcode():null})(t,e,n);return a&&Ot[a]?Ot[a]:"string"==typeof t?Ct(t,e,a):t instanceof URL?await(async(t,e,n)=>{const a=await fetch(t.toString()),i=await a.text();return Ct(i,e,n)})(t,e,a):t instanceof Node||t instanceof NodeList||t instanceof HTMLCollection||t instanceof HTMLTemplateElement?Rt(t,e,a):void new Error("The template isn't a allowed type! -> [String|URL|Node|NodeList|HTMLCollection|Template] required!")}static async loadNodeTemplate(t,e,n,a){try{const e=(t=>{let e=t.find(":scope > template").first();if(e)return e;const n=t.attr(kt);if(!n)return null;try{if(e=find(n).first(),e)return e}catch(t){}return new URL(n,location)})(t);if(e)return St.load(e,n,a)}catch(e){console.warn("Can't load template from node!",t,e)}return e}}const It="name",Ht="active",jt="stateful",zt="component-tag",Ut="component-tag-attributes",_t="view",qt=[It,kt,zt,Ut,jt,_t],Ft=[mt,yt,wt],Kt=pt(kt),Gt=async t=>{if(t.hasAttribute(kt)){let e=Kt(t);return e||(e=await St.loadNodeTemplate(t,null,!1),Kt(t,e)),e}{const e=t.attr(zt),n=customElements.get(e),a=await(async t=>{const e=t.attr(Ut)||"{}";return Vt.resolve(e,{},{})})(t),i=new n;for(let t in a){const e=a[t];"string"==typeof e&&i.attr(t,e)}return i}};class Xt extends rt{static get observedAttributes(){return qt}static get NODENAME(){return ft}static get EVENTS(){return Ft}#b=!1;constructor(t){super(t||{}),this.on("click",(()=>{this.active||this.trigger(mt)}))}async init(){await super.init(),this.#b||(this.#b=!0,this.trigger(gt),this.active&&this.trigger(mt))}get name(){return this.attr(It)}get view(){return this.attr(_t)}get active(){return this.hasAttribute(Ht)}set active(t){t!=this.active&&(this.attr(Ht,t?"":null),t?this.trigger(yt):this.trigger(wt))}get stateful(){return this.hasAttribute(jt)}get context(){return this.attr("context")}get refresh(){return this.hasAttribute(ATTR_REFRESH)}async component(){return Gt(this)}}ot(Xt);const Bt=Xt,Wt="target",Jt="context",Zt=[Wt,Jt],Qt=[bt];class Yt extends rt{static get observedAttributes(){return Zt}static get NODENAME(){return vt}static get EVENTS(){return Qt}constructor(t){super(t||{}),this.on("click",(t=>{t.preventDefault(),this.trigger(bt)}))}async init(){}get view(){return this.attr("view")}get target(){return this.attr(Wt)}get context(){return this.attr(Jt)}get refresh(){return this.hasAttribute("refresh")}}ot(Yt);const te=Yt,ee=st("view"),ne=[],ae={init:0,data:1,template:2,content:3,finish:4};class ie{static get PHASE(){return ae}static get MIN_RANK(){return 0}static get MAX_RANK(){return 1e5}constructor(){}get name(){}get rank(){}get phase(){return ae.finish}async execute(t){return t}static define(t){(({directive:t})=>{if(!(t instanceof ie))throw new Error("Implementation dosn't extend Directive class!");if(t.rank<ie.MIN_RANK)throw new Error("The rank of a directive can't be lower as "+ie.MIN_RANK+"!");if(t.rank>ie.MAX_RANK)throw new Error("The rank of a directive can't be grater as "+ie.MAX_RANK+"!");ne.push(t),ne.sort(((t,e)=>{const n=t.phase-e.phase;return 0==n?t.rank-e.rank:n}))})(t)}static get directives(){return ne}}new Set,new Map;const re=t=>t instanceof St?t.importContent():typeof t===String?create(t):t;let se=0;class oe{#x;#E;#A;#N;#T;#D;#M;#P;#L;#$;#V;constructor({content:t=null,resolver:e,renderer:n,template:a,container:i,root:r,mode:s="replace",target:o=null,parent:l=null,wait:c=null,callbacks:u=null,ignoreDirective:h}){if(!e)throw new Error('Parameter "resolver" is required!');if(!n)throw new Error('Parameter "renderer" is required!');if(!a)throw new Error('Parameter "template" is required!');if(!i)throw new Error('Parameter "container" is required!');if(!r)throw new Error('Parameter "root" is required!');this.#x=l?`${l.id}->${se++}`:"root::"+se++,this.#E=l?l.depth+1:0,this.#A=l,this.#N=n,this.#T=r,this.#D=re(a),this.#M=s,this.#P=new Set,this.#L=c||Q(),this.#$=h instanceof Set?h:new Set,this.#V=u instanceof Array?u:[],this.content=t,this.container=i,this.target=o,this.resolver=e,this.stop=!1,this.ignore=!1,l&&l.subcontexts.add(this)}get id(){return this.#x}get depth(){return this.#E}get parent(){return this.#A}get renderer(){return this.#N}get root(){return this.#T}get template(){return this.#D}set template(t){this.#D=re(t)}get mode(){return this.#M}get subcontexts(){return this.#P}get closed(){return this.#L.resolved}ignoreDirective(t){const e=this.#$;t instanceof ie?e.add(t.name):e.add(t)}acceptDirective(t){const e=this.#$;return t instanceof ie?!(e.has(t.name)||e.has(t)):!e.has(t)}finished(t){this.parent?this.parent.finished(t):this.ready(t)}async ready(t){const e=this.#V;if(!t){const t=this.#L;if(!t.resolved){if(!this.ignore)for(let t of e)await t(this);for(let t of this.subcontexts)await t.ready();this.parent&&this.parent.subcontexts.delete(this),t.resolve(this)}return t}t instanceof Array?t.forEach((t=>this.wait.then(t))):t instanceof Promise?e.push((async()=>await t)):"function"==typeof t&&e.push(t)}subContext({resolver:t=this.resolver,renderer:e=this.renderer,template:n=this.template,container:a=this.container,root:i=this.root,mode:r=this.mode,target:s=this.target,ignoreDirective:o=null}={}){return new oe({resolver:t,renderer:e,template:n,container:a,mode:r,root:i,target:s,parent:this,ignoreDirective:o})}clone({content:t=this.content,template:e=this.template,container:n=this.container,root:a=this.root,mode:i=this.mode,target:r=this.target,ignoreDirective:s=this.#$}={}){return new oe({content:t,resolver:this.resolver,renderer:this.renderer,template:e,container:n,root:a,mode:i,target:r,ignoreDirective:s,wait:this.#L,callbacks:this.#V})}toRenderOption({resolver:t=this.resolver,renderer:e=this.renderer,template:n=this.template,container:a=this.container,root:i=this.root,mode:r=this.mode,target:s=this.target,ignoreDirective:o=null}={}){return{resolver:t,renderer:e,template:n,container:a,mode:r,root:i,target:s,parent:null,ignoreDirective:o}}}class le extends HTMLElement{constructor(){super(),this.hidden=!0}async execute({template:t,context:e}){return e.content=t.cloneNode(!0),e}}class ce extends le{constructor(){super(),this.attachShadow({mode:"open"})}async execute({template:t,context:e}){return e}}try{customElements.define("jstl-replace",ce)}catch(t){}ie.define({directive:new class extends ie{constructor(){super()}get name(){return"initial"}get rank(){return ie.MIN_RANK}get phase(){return ie.PHASE.init}async execute(t){const{template:e,renderer:n,resolver:a}=t;if(e instanceof Element)if(e.attr("jstl-ignore"))t.content=document.importNode(e,!0),t.stop=!0,t.ignore=!0;else if(e.attr("jstl-async")){t.content=new ce,e.attr("jstl-async",null);const a=t.toRenderOption({mode:"replace",target:t.content});setTimeout((()=>{n.render(a)}),parseInt(e.attr("jstl-async")||"250")||250),t.stop=!0,t.ignore=!0}else if(e instanceof HTMLTemplateElement){t.content=document.createElement(e.tagName);const a=t.subContext({template:e.content.childNodes,container:t.content.content});await n.render(a),t.stop=!0,t.ignore=!0}else if(e.hasAttribute("jstl-tagname")){e.attr("jstl-tagname").trim().length>0?t.content=document.createElement(await a.resolveText(e.attr("jstl-tagname"))):(t.content=document.importNode(e,!0),t.stop=!0,t.ignore=!0)}else if(e.tagName){let n=e.attr("is");if(n){n=await a.resolveText(n);const i=document.createElement(e.tagName,{is:n});i.attr("is",n),t.content=i}else t.content=document.createElement(e.tagName)}else t.content=document.importNode(e,!0),t.stop=!0,t.ignore=!0;else t.content=document.importNode(e,!0);return t}}});const ue={remote:async({data:t,context:e})=>{const{resolver:n,template:a}=e;t=await n.resolveText(t),t=new URL(t,location.origin);let i=await n.resolveText(a.attr("jstl-data-option")||"{}");return i=JSON.parse(i),(t=await fetch(t.toString(),i)).json()},set:async({data:t,context:e})=>{const{resolver:n}=e;return t=await n.resolve(t)},direct:async({data:t,context:e})=>{const{resolver:n}=e;return t=await n.resolveText(t)}};ie.define({directive:new class extends ie{constructor(){super()}get name(){return"data"}get rank(){return 1e3}get phase(){return ie.PHASE.data}async execute(t){if(!(t.template instanceof HTMLElement&&t.template.attr("jstl-data")))return t;try{const{template:e}=t,n=ue[e.attr("jstl-data-mode")||"remote"];if(!n)throw new Error("The jstl-data-mode is unsupported!");let a=e.attr("jstl-data");a=await n({data:a,context:t});const i=e.attr("jstl-data-var");t=(({varname:t,data:e,scope:n,context:a})=>{if(t)a.resolver.updateData(t,e,n);else if(n)a.resolver.mergeContext(e,n);else{const t=new Vt({context:e,name:"jstl-data",parent:a.resolver});a.resolver=t}return a})({varname:i,data:a,scope:e.attr("jstl-data-scope"),context:t})}catch(e){console.error(e,t.template)}return t}}});ie.define({directive:new class extends ie{constructor(){super()}get name(){return"if"}get rank(){return ie.MIN_RANK+1e3}get phase(){return ie.PHASE.init}async execute(t){const{template:e}=t;if(!(e instanceof HTMLElement&&e.attr("jstl-if")))return t;const n=e.attr("jstl-if"),a=t.resolver;return await a.resolve(n,!1)||(t.content=null,t.stop=!0,t.ignore=!0),t}}});ie.define({directive:new class extends ie{constructor(){super()}get name(){return"choose"}get rank(){return ie.MIN_RANK+1}get phase(){return ie.PHASE.template}async execute(t){if(!(t.template instanceof HTMLElement&&t.template.hasAttribute("jstl-choose")&&0!=t.template.children.length))return t;t.template=t.template.cloneNode(!0);const{template:e,resolver:n}=t;let a=!1;const i=e.find(":scope > [jstl-when]"),r=i.length;for(let t=0;t<r;t++){const e=i[t];!a&&await n.resolve(e.attr("jstl-when"),!1)?a=!0:e.remove()}return a&&e.find(":scope > [jstl-otherwise]").remove(),t}}});ie.define({directive:new class extends ie{constructor(){super()}get name(){return"include"}get rank(){return ie.MIN_RANK}get phase(){return ie.PHASE.template}async execute(t){if(!(t.template instanceof HTMLElement&&t.template.attr("jstl-include")))return t;try{const{template:e,resolver:n,renderer:a}=t;let i=e.attr("jstl-include");i=await n.resolveText(i),i=new URL(i,location),i=await St.load(i);const r=e.attr("jstl-include-mode")||"replace",s=t.subContext({template:i,container:t.content,mode:r});return await a.render(s),await s.ready(),t.ignore=!0,t.stop=!0,t}catch(e){return console.error(e,t.template),t}}}});const he="jstl-foreach",de="jstl-foreach-var",pe="jstl-foreach-status",fe="jstl-foreach-count",ge="jstl-foreach-start",me="jstl-foreach-step",ye="jstl-foreach-condition",we=async(t,e)=>{let{template:n,resolver:a,renderer:i,container:r,condition:s,context:o}=e;if(a=new Vt({context:t,name:"jstl-foreach",parent:a}),s=!!s&&await a.resolve(s,!1),s)return!1;const l=o.subContext({resolver:a,container:r,template:n,mode:"append"});return await i.render(l),await l.ready(),!0};ie.define({directive:new class extends ie{constructor(){super()}get name(){return"foreach"}get rank(){return ie.MIN_RANK+2}get phase(){return ie.PHASE.template}async execute(t){if(!(t.template instanceof HTMLElement)||!t.template.attr(he)&&!t.template.attr(fe))return t;t.ignore=!0;try{const{template:e,resolver:n,renderer:a,content:i}=t,r={data:(e.attr(he)||"").trim(),count:(e.attr(fe)||"").trim(),start:await n.resolve(e.attr(ge)||"0"),step:await n.resolve(e.attr(me)||"1"),varname:(e.attr(de)||"item").trim(),status:(e.attr(pe)||"status").trim(),condition:e.attr(ye),template:e.childNodes,resolver:n,renderer:a,container:i,context:t};r.data&&""!=r.data||!r.count?await(async t=>{let{data:e,start:n,step:a,count:i,varname:r,status:s,resolver:o}=t;e=await o.resolve(e);let l=e;e instanceof Array||(l=Object.getOwnPropertyNames(e)),i=""!=i?await o.resolve(i,0):null;const c=i?Math.min(n+i,l.length):l.length;let u=!1;for(let i=n;i<c&&!u;i+=a){const n={};n[r]=e[i],n[s]={index:i,number:i+1,count:c,data:e},u=!await we(n,t)}})(r):await(async t=>{let{start:e,step:n,count:a,varname:i,status:r,resolver:s}=t;a=await s.resolve(a);const o=e+a*n;let l=!1;for(let s=e;s<o&&!l;s+=n){const e={};e[i]=s,e[r]={index:s,number:s+1,step:n,count:a},l=!await we(e,t)}})(r)}catch(t){console.error("error at jstl-foreach:",t)}return t}}});const ve="jstl-repeat",be=new Set([ve]),xe={DATA:`${ve}`,VAR:`${ve}-var`,STATUS:`${ve}-status`,COUNT:`${ve}-count`,START:`${ve}-start`,STEP:`${ve}-step`,CONDITION:`${ve}-condition`},Ee=async(t,e)=>{let{template:n,resolver:a,renderer:i,condition:r,context:s}=e;if(a=new Vt({context:t,name:ve,parent:a}),r=!!r&&await a.resolve(r,!1),r)return!1;const o=s.subContext({resolver:a,template:n,mode:"append",ignoreDirective:be});return await i.render(o),await o.ready(),!0};ie.define({directive:new class extends ie{constructor(){super()}get name(){return ve}get rank(){return ie.MIN_RANK+3}get phase(){return ie.PHASE.template}async execute(t){if(!(t.template instanceof HTMLElement)||!t.template.attr(xe.DATA)&&!t.template.attr(xe.COUNT))return t;try{const{template:e,resolver:n,renderer:a,content:i,container:r}=t,s={data:(e.attr(xe.DATA)||"").trim(),count:(e.attr(xe.COUNT)||"").trim(),start:await n.resolve(e.attr(xe.START)||"0"),step:await n.resolve(e.attr(xe.STEP)||"1"),varname:(e.attr(xe.VAR)||"item").trim(),status:(e.attr(xe.STATUS)||"status").trim(),condition:e.attr(xe.CONDITION),template:e,tagname:i.tagName,resolver:n,renderer:a,container:r,context:t};s.data&&""!=s.data||!s.count?await(async t=>{let{data:e,start:n,step:a,count:i,varname:r,status:s,resolver:o}=t;e=await o.resolve(e);let l=e;e instanceof Array||(l=Object.getOwnPropertyNames(e)),i=""!=i?await o.resolve(i,0):null;const c=i?Math.min(n+i,l.length):l.length;let u=!1;for(let i=n;i<c&&!u;i+=a){const n={};n[r]=e[i],n[s]={index:i,number:i+1,count:c,data:e},u=!await Ee(n,t)}})(s):await(async t=>{let{start:e,step:n,count:a,varname:i,status:r,resolver:s}=t;a=await s.resolve(a);const o=e+a*n;let l=!1;for(let s=e;s<o&&!l;s+=n){const e={};e[i]=s,e[r]={index:s,number:s+1,step:n,count:a},l=!await Ee(e,t)}})(s)}catch(t){console.error("error at jstl-repeat:",t)}return t.content=null,t.stop=!0,t.ignore=!0,t}}});const Ae={mode:"text",unsecure:!1,preventFormat:!1,maxLength:0},Ne={text:async(t,e)=>{const{content:n,resolver:a,template:i}=e;let r=await a.resolveText(i.textContent);r=create(r,!0).content.textContent,t.maxLength>0&&(r=((t,e)=>t.length>e?t.substring(0,e-3).trim()+"...":t)(r,t.maxLength)),n.textContent=r},html:async(t,e)=>{const{resolver:n,template:a}=e;let i=await n.resolveText(a.textContent);i=create(i,!0),i=document.importNode(i.content,!0),t.unsecure||i.find("script, style, body, html, head, object, link").remove(),e.content=i}};ie.define({directive:new class extends ie{constructor(){super()}get name(){return"text"}get rank(){return ie.MIN_RANK+1}get phase(){return ie.PHASE.content}async execute(t){const{template:e}=t;if(!(e instanceof Text)||0==e.textContent.trim().length||e.parentElement&&e.parentElement.hasAttribute("jstl-text-ignore"))return t;const n=e.parentElement,a=n?await(async(t,e)=>{const n=e.resolver;return{mode:await n.resolveText((t.attr("jstl-text-content-type")||"text").trim().toLowerCase()),unsecure:t.hasAttribute("jstl-text-unsecure"),preventFormat:!!t.attr("jstl-text-prevent-format")||!1,maxLength:parseInt(await n.resolveText(t.attr("jstl-text-trim-length")||"0"))}})(n,t):Ae,i=Ne[a.mode];if(!i)throw new Error('Text mode "'+a.mode+'" is unsupported!');return await i(a,t),t}}});const Te=/(jstl)?(\?)?(@)?([^\?@]+)/i,De="default",Me="prevent-default",Pe=["is"],Le={delegate:async(t,e,n,a,i,r,s,o)=>{const l=await i.resolveText(e,e);r.on(t,Ce(l,n))},toggleclass:async(t,e,n,a,i,r,s,o)=>{const l=s.shift(),c=s.includes(Me),u=e?await i.resolveText(e,e):null;r.on(t,(t=>{c&&t.preventDefault(),u?r.closests(u).toggleClass(l):r.toggleClass(l)}))},toggleattribute:async(t,e,n,a,i,r,s,o)=>{const l=s.shift(),c=s.includes(Me),u=e?await i.resolveText(e,e):null;r.on(t,(t=>{c&&t.preventDefault(),u?r.closests(u).forEach((t=>{t.toggleAttribute(l)})):r.toggleAttribute(l)}))},[De]:async(t,e,n,a,i,r,s,o)=>{const l=e?await i.resolve(e,e):null;if(l){if("function"==typeof l)r.on(t,l);else if("string"==typeof l)r.on(t,Ce(l,n));else if("object"==typeof l){const{capture:e=!1,passive:n=!1,once:a=!1}=l;r.on(t,l.eventHandle,{capture:e,passive:n,once:a})}}else console.error(new Error("Can't resolve \""+e+'" to event handle!'))}},$e=async({condition:t,name:e,value:n,context:a})=>{const{resolver:i,content:r,template:s}=a;let o=t?s.attr(e):n;t=t?n:s.attr("?"+e);const l=Ve(o);t&&l?!0===(t=await i.resolve(t,!1))&&r.attr(e,await i.resolveText(o,o)):t?!0===(t=await i.resolve(t,!1))&&r.attr(e,!0):l&&r.attr(e,await i.resolveText(o,o))},Ve=t=>null!=t&&void 0!==t,ke=async({condition:t,name:e,value:n,context:a})=>{const{resolver:i,template:r,content:s}=a;let o=(t=t?n:r.attr("?@"+e))?r.attr("@"+e):n,l=e.split(":");const c=l.shift(),u=(l.shift()||De).toLowerCase();void 0!==o&&null!=o||console.error(`Definition of "${c}" - event handle at`,s,"is incorrect!"),o=o.trim();const h={bubble:!0};t?1==await i.resolve(t,!1)&&await Oe(c,o,h,u,i,s,l,a):await Oe(c,o,h,u,i,s,l,a)},Oe=async(t,e,n,a,i,r,s,o)=>{const l=Le[a];if(l)return l(t,e,n,a,i,r,s,o)},Ce=function(t,e){return function(e){e.preventDefault(),e.stopPropagation(),e.currentTarget?e.currentTarget.trigger(t,e):e.target.trigger(t,e)}};ie.define({directive:new class extends ie{constructor(){super()}get name(){return"attribute"}get rank(){return ie.MIN_RANK}get phase(){return ie.PHASE.content}async execute(t){const{template:e}=t;if(!(e instanceof HTMLElement))return t;const n=new Set(Pe);for(const a of e.attributes){const[,e,i,r,s]=Te.exec(a.name);if(!e&&!n.has(s)){const e=a.value;r?await ke({condition:i,event:r,name:s,value:e,context:t}):await $e({condition:i,name:s,value:e,context:t})}n.add(s)}return t}}});const Re="jstl-attach-element",Se="replace",Ie=/^#.+$/;ie.define({directive:new class extends ie{constructor(){super()}get name(){return"attach-element"}get rank(){return ie.MIN_RANK+1}get phase(){return ie.PHASE.content}async execute(t){const{resolver:e,template:n,content:a}=t;if(!(n instanceof HTMLElement&&n.attr(Re)))return t;try{let i=await(async(t,e)=>{let n=(t.attr(Re)||"").trim();if(!Ie.test(n)){try{n=await e.resolve(n,n)}catch(t){}if(n instanceof HTMLElement)return n}try{n=find(n)}catch(t){}return n&&n.length>0?0==n.length?n.first():n:null})(n,e);if(i){const e=n.attr("jstl-attach-element-mode")||Se;e==Se?(a.empty().append(i),t.stop=!0,t.ignore=!0):t.ready((({content:t})=>{t&&("append"==e?t.append(i):"prepend"==e&&t.prepend(i))}))}}catch(e){console.log(e,{context:t})}return t}}});const He="on-finished",je=`jstl-${He}`,ze=`${je}-async`;ie.define({directive:new class extends ie{constructor(){super()}get name(){return He}get rank(){return ie.MAX_RANK}get phase(){return ie.PHASE.finish}async execute(t){const{template:e,content:n,root:a}=t;if(!(e instanceof HTMLElement&&e.hasAttribute(je)))return t;const i=e.attr(je),r=e.hasAttribute(ze),s=new Vt({context:{$element:n,$root:a,$template:e},name:"jstl-data",parent:t.resolver});return t.finished((async()=>{try{if(!r)return s.resolve(i,null);s.resolve(i,null)}catch(t){console.error(t)}})),t}}});const Ue="data",_e="render",qe="container",Fe="node",Ke=new Vt({name:"application"}),Ge={replace:async({container:t,target:e=null,content:n})=>{e?e.replace(n):(t.empty(),t.append(n))},append:async({container:t,target:e=null,content:n})=>{e?e.after(n):t.append(n)},prepend:async({container:t,target:e=null,content:n})=>{e?e.before(n):t.prepend(n)}},Xe=async t=>{try{let{template:e,renderer:n}=t;e instanceof le?await e.execute(t):await Be(t);const{ignore:a,content:i}=t;if(!a&&i){let{resolver:e}=t;const a=t.template.childNodes;if(a&&a.length>0){const r=new Vt({name:qe,context:null,parent:e}),s=await n.render(t.subContext({container:i,template:a,resolver:r}));await s.ready()}}t.content&&t.content.tagName&&"JSTL"==t.content.tagName&&(t.content=t.content.childNodes)}catch(e){console.error("error at render node:",e,t)}return t},Be=async t=>{const e=ie.directives,n=e.length;for(let a=0;a<n&&!t.stop;a++){const n=e[a];try{t.acceptDirective(n)&&await n.execute(t)}catch(e){console.error("error at directive:",e,n,t)}}return t};class We{constructor({template:t,data:e}={}){if(t&&!(t instanceof St))throw new Error("template must be an instance of Template!");this.template=t,this.resolver=new Vt({name:Ue,context:e||{},parent:Ke})}async render(t){const e=t instanceof oe;if(e){if(t.closed)throw new Error("calling with closed context",t)}else{let{template:e=null,data:n=null,container:a,root:i,mode:r,target:s}=t;e=await(async(t,e)=>{if(t)return(t=await St.load(t)).importContent();if(e.template)return await e.template.importContent();throw new Error("No content template specified!")})(e,this);const o=new Vt({name:_e,context:n,parent:this.resolver});t=new oe({resolver:o,renderer:this,template:e,container:a,root:i||a,mode:r||"replace",target:s})}return t.template instanceof Node?await Xe(t):await(async t=>{let{template:e,resolver:n}=t;if(!e||0==e.length)return t;let a=[];for(let i of e){i.normalize();const e=new Vt({name:Fe,context:null,parent:n}),r=await Xe(t.subContext({template:i,resolver:e}));await r.ready();const s=r.content;s&&(s instanceof Array&&(a=a.concat(s)),s instanceof NodeList||s instanceof HTMLCollection?a=a.concat(Array.from(s)):s instanceof Node&&a.push(s))}return t.content=0!=a.length?a:null,t})(t),await(async t=>{if(t.content){const e=Ge[t.mode];if(!e)throw new Error('The "'+t.mode+'" is not supported!');await e(t)}})(t),e||await t.ready(),t}static async build({template:t,data:e}={}){return t&&t instanceof Promise&&(t=await t),t=t?await St.load(t):null,new We({template:t,data:e})}static async render({container:t,data:e,template:n,mode:a,target:i}){return new We({template:n,data:e}).render({container:t,mode:a,target:i})}}const Je=pt("app"),Ze=pt("route"),Qe=new class{constructor(){W(this,"weakmap",new WeakMap)}data(t){let e=this.weakmap.get(t);return e||(e={},this.weakmap.set(t,e)),e}value(t,e,n){if(2==arguments.length)return this.data(t)[e];void 0===n?delete this.data(t)[e]:this.data(t)[e]=n}destroy(){this.weakmap.delete(reference)}},Ye="name",tn=[Ye];class en extends rt{static get observedAttributes(){return tn}static get NODENAME(){return ee}constructor(t){super(t||{})}get name(){return this.attr(Ye)}get app(){return Je(this)}set app(t){Je(this,t)}get route(){return Ze(this)}async display({route:t,context:e,view:n,refresh:a=!1}){if(n)throw new Error("you must override the display function!");Ze(this,t);const{root:i,app:r}=this;i.empty();let s=t.stateful?Qe.value(t,"component"):null;a||!s?(s=await t.component(),s instanceof St?(await We.render({container:i,data:{$view:this,$app:r,$store:r.store,$route:t,$context:e},template:s}),s=NodeList.from(i.childNodes)):(s instanceof en&&(s.app=r,s.ready.then((()=>{s.display({route:t,context:e,view:this})}))),i.append(s)),t.stateful&&Qe.value(t,"component",s)):(s instanceof en&&(s.app=r,s.ready.then((()=>{s.display({route:t,context:e,view:this})}))),i.append(s))}}ot(en);const nn=en,an=pt("view"),rn=pt("store"),sn=st("application"),on="route",ln="view",cn=(t,e)=>{const n=`${Bt.NODENAME}[name="${e}"]`;return t.find(n).first()},un=(t,e)=>{let n=null;if(e){const a=t.root.find(`d-view[name="${e}"]`).first();a&&1==a.length&&(n=a.first())}return n||(n=((t,e)=>ct(t.root,(t=>t instanceof nn&&(null==e||t.name==e))))(t,e)),n&&(n.app=t),n},hn=async(t,e)=>{try{return Vt.resolve(t,e.store,null)}catch(t){return null}},dn=[on,ln];class pn extends rt{static get observedAttributes(){return dn}static get NODENAME(){return sn}constructor(t){super(t||{}),this.root.on([mt,bt],(async t=>{this.route({route:t.target})})),this.on(tt(on,this),(()=>{this.hasAttribute(on)&&this.route({route:this.attr(on)})}))}async init(){await super.init(),this.ready.then((()=>{this.hasAttribute(on)&&this.route({route:this.attr(on)})}))}async routes(){return this.root.find(Bt.NODENAME)}async route({route:t,refresh:e=null,context:n=null,view:a=null}){if(await this.ready,0==arguments.length)return this.view.route;if("string"==typeof t)t=cn(this,t);else if(t instanceof te)e=null!=e?e:t.refresh,null==n&&(n=await hn(t.context,this)),null==a&&(a=t.view),t=cn(this,t.target);else if(!(t instanceof Bt))throw new Error("Unsupported route type!");null==e&&(e=!1),null==a&&(a=t.view),a=a?un(this,a):this.view,(e||a.route!=t)&&(null==n&&(n=await hn(t.context,this)),a.route&&(a.route.active=!1),await a.display({route:t,context:n,refresh:e}),t.active=!0)}get view(){let t=an(this);return t||(t=un(this,this.attr(ln)),an(this,t),t.app=this),t}get store(){let t=rn(this);return t||(t={},rn(this,t)),t}}ot(pn);if(window.Date.prototype.addDays=function(t){const e=new Date(this);return e.setDate(e.getDate()+t),e},"serviceWorker"in navigator){navigator.serviceWorker.register("./serviceworker.js",{scope:"./"}).then((t=>{t.installing?console.log("Service worker installing"):t.waiting?console.log("Service worker installed"):t.active&&console.log("Service worker active")})).catch((t=>{console.log("Registration failed with "+t)}))}class fn extends(it(HTMLDialogElement)){static get NODENAME(){return"x-dialog"}constructor(){super(),this.on("click",(({target:t})=>{t.is("[close-modal]")&&this.close()}))}async init(){await super.init()}hide(){this.close()}}ot(fn,{extends:"dialog"});class gn extends rt{static get NODENAME(){return"x-login-component"}constructor(){super()}async init(){await super.init();const t=await(async()=>{if(!g){if(!await y())return location.href=new URL("/api/system/login",location).toString(),null;g=!0}return d})();if(t){const e=this.attr("template");if(e){const n=await St.load(new URL(e,location));await We.render({container:this,data:{user:t},template:n})}}else this.textContent="kein Zugriff erlaubt"}}ot(gn);const mn="x-clan",yn=new URL(`${u}/html-clan-element/root.tpl.html`,location);class wn extends rt{static get NODENAME(){return mn}#b=!1;#k=null;constructor(){super(),this.on(`${mn}:sort-member-by-name`,(()=>{})),this.on(`${mn}:sort-member-by-wtr`,(()=>{}))}async init(){if(await super.init(),!this.#b){const t=await St.load(yn);await We.render({container:this.root,template:t,data:await this.clanData()})}}async clanData(){if(!this.#k){this.#k={id:this.attr("clan-id"),name:this.attr("clan-name"),tag:this.attr("clan-tag")};const t=await fetch(new URL(`/api/clans/${this.#k.id}/members`,location)),e=await t.json();this.#k.members=e.members}return this.#k}}ot(wn);const vn=t=>t instanceof URL?t:new URL(t,location),bn=async t=>(await fetch(vn(t),{headers:{"content-type":"application/json"}})).json(),xn=async(t,e)=>{const n=await fetch(vn(t),{method:"post",headers:{"content-type":"application/json"},body:JSON.stringify(e)});if(n.status<204)return n.json()},En=async t=>{await fetch(vn(t),{method:"delete",headers:{"content-type":"application/json"}})},An="/api/members",Nn=new Map,Tn=`${u}/html-member-element`,Dn=St.load(new URL(`${Tn}/root.tpl.html`,location));class Mn extends rt{static get NODENAME(){return"x-member"}#b=!1;constructor(){super();this.root}async init(){await super.init(),this.#b||(await this.render(),this.#b=!0)}get memberId(){return parseInt(this.attr("member-id"))}async render(){const t=await Dn,e=await(async t=>{if(Nn.has(t))return Nn.get(t);const e=await bn(`${An}/${t}`);return console.log({member:e}),e&&Nn.set(e.id,e),e})(this.memberId);await We.render({container:this.root,template:t,data:{member:e}})}}ot(Mn);const Pn="/api/teams",Ln=new Map,$n=async t=>{if(Ln.has(t))return Ln.get(t);const e=await bn(`${Pn}/${t}`);return Ln.set(e.id,e),e},Vn=async t=>(t=await xn(`${Pn}`,t),Ln.set(t.id,t),t),kn="d-",On=500,Cn=`${kn}form`,Rn=`${kn}submit-action`,Sn=`${kn}page`,In=`${kn}field`,Hn=`${kn}container`,jn=`${kn}list`,zn=`${kn}rows`,Un=`${kn}row`,_n=`${kn}add-row`,qn=`${kn}delete-row`,Fn=`${kn}progress-bar`,Kn=`${kn}step`,Gn=`${kn}validation`,Xn=`${kn}message`,Bn=`${kn}control`,Wn=`${kn}control-back`,Jn=`${kn}control-next`,Zn=`${kn}control-summary`,Qn=`${kn}control-submit`,Yn="init",ta="validating",ea="input",na="summary",aa="finished",ia="d-form-",ra=`${ia}initialized`,sa=`${`${ia}initialize`}submit-action`,oa=`${ia}submit`,la=`${ia}submit-results`,ca=`${ia}condition-state-changed`,ua=`${ia}site-changed`,ha=`${ia}state-changed`,da=`${ia}field-input`,pa=`${ia}list-row-add`,fa=`${ia}list-row-delete`,ga=`${ia}progress-bar-changed`,ma=`${ia}field-initialized`,ya=`${ia}field-removed`,wa=`${ia}page-initialized`,va=`${ia}page-removed`,ba=`${ia}validation-initialized`,xa=`${ia}validation-removed`,Ea=`${ia}message-initialized`,Aa=`${ia}message-removed`,Na=`${ia}active-state-changed`,Ta=`${ia}valid-state-changed`,Da=`${ia}editable-state-changed`,Ma="$value",Pa="$item",La="name",$a="endpoint",Va="method",ka="state",Oa="step",Ca="use-summary-page",Ra="input-mode-after-submit",Sa="required",Ia="condition",Ha="active",ja="disabled",za="editable",Ua="editable-condition",_a="readonly",qa="no-value",Fa="valid",Ka="invalid",Ga="evaluate",Xa="condition-valid",Ba="condition-invalid",Wa="min",Ja="max",Za="progress";const Qa=class{#O;#d;constructor(t){this.#O=t}get condition(){return this.#d||(this.#d=this.#O.attr(Ia)||!1),this.#d}async validate(t){const e=this.#O;let n=this.condition;const a=e.condition;return n=!n||await Vt.resolve(n,t,!1),n!=a&&(e.condition=n),n}};const Ya=class{#O;#d=null;constructor(t){this.#O=t}get condition(){return null==this.#d&&(this.#d=this.#O.attr(Ua)||""),this.#d}async validate(t){let e=!0;const n=this.#O.editable;return this.condition&&(e=await Vt.resolve(this.condition,t,!1)),e!=n&&(this.#O.editable=e),e}};const ti=class{#O;#C=new Set;#R=new Set;constructor(t){this.#O=t,t.on(ba,(t=>{t.stopPropagation(),this.#C.add(t.target)})),t.on(xa,(t=>{t.stopPropagation(),this.#C.delete(t.target)}))}addCustomValidation(t){this.#R.add(t)}async validate(t){const e=this.#O,n=this.#R,a=this.#C,{hasValue:i,required:r,condition:s,editable:o}=(this.#O.valid,this.#O);let l=!0;if(s){l=!r||i,await(async(t,e,n)=>{let a=!0;for(let i of t)await i({data:e,base:n})||(a=!1);return a})(n,t,e)||(l=!1);for(let e of a)if(l&&i){const n=await Vt.resolve(e.condition,t,!0);e.active=!n,n||(l=!1)}else e.active=!1}return e.valid=l,l}};const ei=class{#S=new Set;constructor(t){t.on(Ea,(t=>{t.preventDefault(),t.stopPropagation();const e=t.target;this.#S.add(e)})),t.on(Aa,(t=>{t.preventDefault(),t.stopPropagation();const e=t.target;this.#S.delete(e)}))}async validate(t){for(let e of this.#S)e.update(t)}},ni=t=>null==t||void 0===t,ai=async(t,e,n)=>(ni(n)||(e?si(t,e,n):Object.assign(t,n)),t),ii=async(t,e)=>{let n={};if(e)for(let a of e){const e=a.name,i=t.get(a);n=await ai(n,e,i)}else for(let[{name:e},a]of t)n=await ai(n,e,a);return n},ri=/\./g,si=function(t,e,n){const a=e.split(ri);if(2==arguments.length)return li(t,a);const i=ni(n);return ni(t)&&i?t:oi(i,t,n,a)},oi=(t,e,n,a)=>{if(ni(e)&&t)return null;const i=a.shift();return 0==a.length?t?delete e[i]:e[i]=n:(ni(e[i])&&(e[i]={}),oi(t,e[i],n,a)),e},li=(t,e)=>{if(ni(t))return null;if(0==e.length)return t;const n=e.shift();return li(t[n],e)},ci=(t,e,n=!1)=>{const a=t.active;e?t.attr(Ha,""):t.attr(Ha,null),(a!=e||n)&&t.trigger(Na)},ui=(t,e,n=!1)=>{const a=t.readonly;e?t.attr(_a,""):t.attr(_a,null),(a!=e||n)&&t.trigger(Da)},hi=pt("form"),di=[Ha,_a,Ia,Xa,Ba,Ua];const pi=class extends rt{static get observedAttributes(){return di}#I;#H;#j;#z;constructor(){super(),this.#z=new ei(this),this.#I=new Qa(this),this.#H=new Ya(this),this.#j=new ti(this)}addValidation(t){this.#j.addCustomValidation(t)}async validate(t){this.attr(Ga,"");const e=Object.assign({},t,await(async t=>{await t.ready;const e={};e[Ma]=gi(t);let n=t.parent(Un),a=e;for(;n;)a[Pa]=await gi(n),a=a[Pa],n=n.parent(Un);return e})(this));return await this.#I.validate(e),await this.#H.validate(e),await this.#j.validate(e),this.attr(Ga,null),await this.#z.validate(e),this.valid}get form(){let t=hi(this);return t||(t=this.parent(Cn),hi(this,t)),t}get active(){return this.hasAttribute(Ha)}set active(t){this.active!=t&&(ci(this,t),this.activeUpdated())}async activeUpdated(){}get readonly(){return this.hasAttribute(_a)}set readonly(t){this.editable?ui(this,t,!this.ready.resolved):ui(this,!0,!this.ready.resolved),this.readonlyUpdated()}async readonlyUpdated(){}get editable(){return this.hasAttribute(za)}set editable(t){((t,e,n=!1)=>{const a=t.editable;e?t.attr(za,""):t.attr(za,null),(a!=e||n)&&t.trigger(Da)})(this,t,!this.ready.resolved),this.editableUpdated(),this.readonly=!t}async editableUpdated(){}set condition(t){var e,n;e=this,void 0===(n=t)||null==n?(e.attr(Ba,null),e.attr(Xa,null)):n?(e.attr(Ba,null),e.attr(Xa,"")):(e.attr(Xa,null),e.attr(Ba,"")),e.trigger(ca),this.conditionUpdated()}get condition(){return!this.hasAttribute(Ba)}async conditionUpdated(){}set valid(t){((t,e)=>{void 0===e||null==e?(t.attr(Ka,null),t.attr(Fa,null)):e?(t.attr(Ka,null),t.attr(Fa,"")):(t.attr(Ka,""),t.attr(Fa,null)),t.trigger(Ta)})(this,t),this.validUpdated()}get valid(){return this.hasAttribute(Fa)}async validUpdated(){}},fi=pt("parent"),gi=pt("value"),mi=[La,Sa,qa];class yi extends pi{static get observedAttributes(){return mi.concat(pi.observedAttributes)}constructor(t={}){super(t);const{value:e}=t;gi(this,e||null)}async init(){this.ready.then((()=>this.trigger(ma))),await super.init()}async destroy(){this.publishValue(null),await super.destroy(),this.trigger(ya)}get parentField(){let t=fi(this);return t||(t=(t=>{let e=t.parentNode;for(;e;){if(e instanceof yi)return e;e=e.parentNode}return null})(this),fi(this,t)),t}async conditionUpdated(){return this.active=this.condition,this.publishValue()}get name(){return this.getAttribute(La)}get required(){return this.hasAttribute(Sa)}get hasValue(){return!this.hasAttribute(qa)}async value(t){const{condition:e,valid:n,ready:a}=this;if(0==arguments.length)return e&&n?gi(this):null;await a;const i=gi(this);if(await this.acceptValue(t)&&i!=(t=await this.normalizeValue(t)||t)){const e=await this.updatedValue(t);void 0!==e&&(t=e),await this.publishValue(t)}}async validate(t){const e=this.condition,n=this.valid,a=await super.validate(t),i=this.condition;return this.validationStateChanged(e!=i,n!=a),a}async validationStateChanged(t,e){(t||e)&&this.publishValue()}async updatedValue(t){return t}async publishValue(t){await this.ready,0==arguments.length&&(t=gi(this));const e=(t=>{if(ni(t))return!0;const e=typeof t;return"string"===e&&0==t.trim().length||!(t instanceof Date)&&(t instanceof Array&&0==t.length||t instanceof Set&&0==t.length||t instanceof Map&&0==t.length||"object"==e&&0==Object.getOwnPropertyNames(t).length)})(t),n=this.condition;var a;t=this.required&&e?null:t,n?gi(this,t):t=null,a=!e,this.attr(qa,a?null:""),this.parentField?await this.parentField.childValueChanged(this,t):this.form&&await this.form.childValueChanged(this,t)}async acceptValue(t){return!0}async normalizeValue(t){return t}async childValueChanged(t,e){}}const wi=yi,vi=(t,e,n,a)=>{let i=null;const r="function"==typeof e?e:()=>e,s="function"==typeof n?n:()=>n;return e=>{r(e)&&e.preventDefault(),s(e)&&e.stopPropagation();const n=(t=>({type:t.type,target:t.target,detail:t.detail,currentTarget:t.currentTarget,explicitOriginalTarget:t.explicitOriginalTarget,originalTarget:t.originalTarget,srcElement:t.srcElement,timeStamp:t.timeStamp}))(e);i&&clearTimeout(i),i=setTimeout((()=>{i=null,t(n)}),a||10)}};class bi{static findInput(t){return null}#U;constructor(t,e){this.field=t,this.input=e,this.init()}init(){}set readonly(t){}async acceptValue(t){return!0}async normalizeValue(t){return t}async updatedValue(){}get value(){return null}get valid(){return!0}}const xi="text",Ei=t=>({accept:t=>"number"==typeof t,getValue:()=>t.valueAsNumber,setValue:e=>{t.valueAsNumber=e},normalize:t=>ni(t)||Number.isNaN(t)?null:t}),Ai=t=>({accept:t=>"string"==typeof t,getValue:()=>t.value,setValue:e=>{t.value=e},normalize:t=>t||null}),Ni=new Intl.DateTimeFormat("default",{hour:"numeric",minute:"numeric"}),Ti={text:t=>({accept:t=>"string"==typeof t,getValue:()=>t.value,setValue:e=>t.value=e,normalize:t=>t&&(t=t.trim()).length>0?t:null}),number:Ei,datetime:Ai,"datetime-locale":Ai,date:t=>({accept:t=>t instanceof Date,getValue:()=>t.valueAsDate,setValue:e=>{t.valueAsDate=e},normalize:t=>t||null}),time:t=>({accept:t=>t instanceof Date,getValue:()=>t.value?new Date(`1970-01-01T${t.value}`):null,setValue:e=>{t.value=Ni.format(e)},normalize:t=>t||null}),range:Ei};const Di=pt("value"),Mi=(t,e)=>new Promise(((n,a)=>{const i=new FileReader;i.addEventListener("loadend",(()=>{n({name:t.name,type:t.type,size:t.size,data:i.result})}),!1),i[e](t)})),Pi={"form-input":async t=>(t.format="form-input",t),"data-url-base64":async t=>{const e=await Mi(t,"readAsDataURL");return e.format="data-url-base64",e},base64:async t=>{const e=await Mi(t,"readAsDataURL");return e.data=e.data.substr(e.data.indexOf(",")+1),e.format="base64",e}},Li=async(t,e,n)=>{let a=[];for(let n of t)a.push(await Pi[e](n));return 0==a.length?null:n?a:a[0]};const $i=[class extends bi{static findInput(t){return t.find('input:not([type="file"],[type="radio"],[type="checkbox"],[type="button"],[type="submit"],[type="reset"]),input:not([type]), textarea').first()}constructor(t,e){super(t,e)}init(){const{field:t,input:e}=this,n=(t.attr("input-type")||e.attr("type")||xi).trim().toLowerCase();this.type=(Ti[n]||Ti[xi])(e),e.on("input",vi((()=>{t.trigger(da,this.normalizeValue(this.value))}),!1,!0,On)),t.trigger(da,this.normalizeValue(this.value))}acceptValue(t){return null==t||void 0===t||this.type.accept(t)}normalizeValue(t){return null==t&&void 0===t?null:this.type.normalize(t)}async updatedValue(t){t!=this.type.getValue()&&this.type.setValue(t)}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){return this.type.getValue()}get valid(){return this.input.checkValidity()}},class extends bi{static findInput(t){const e=t.find('input[type="checkbox"]');return 0==e.length?null:1==e.length?e.first():e}constructor(t,e){super(t,e)}init(){const{field:t,input:e}=this;this.multiple=e instanceof NodeList,e.on("input",vi((()=>{t.trigger(da,this.normalizeValue(this.value))}),!1,!0,On)),t.trigger(da,this.normalizeValue(this.value))}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){const t=this.input.val();if(!(t instanceof Map))return t;if(0==t.size)return null;const e=[];return t.forEach((t=>{e.push(t)})),e}normalizeValue(t){return t?this.multiple?0!=(t=t.filter((t=>!!t))).length?t:null:t:null}acceptValue(t){if(null==t||void 0===t)return!0;if(this.multiple)return t instanceof Array;{const e=typeof t;return"string"===e||"boolean"===e}}updatedValue(t){this.input.val(t||null)}},class extends bi{static findInput(t){const e=t.find('input[type="radio"]');return 0==e.length?null:e}constructor(t,e){super(t,e)}init(){const{field:t,input:e}=this,n=t.name+Math.floor(Math.random()*Date.now());for(let t of e)t.name=n;e.on("input",vi((()=>{t.trigger(da,this.normalizeValue(this.value))}),!1,!0,On)),t.trigger(da,this.normalizeValue(this.value))}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){const t=this.input.val();return t instanceof Map?0==t.size?null:t.values().next().value:t}normalizeValue(t){return t||null}acceptValue(t){if(null==t||void 0===t)return!0;{const e=typeof t;return"string"===e||"boolean"===e}}updatedValue(t){this.input.val(t||null)}},class extends bi{static findInput(t){return t.find('input[type="file"]').first()}constructor(t,e){super(t,e)}async init(){const{field:t,input:e}=this;this.multiple=e.multiple,this.format=t.attr("file-format")||"form-input",this.filenameTarget=t.attr("file-name-target"),this.filenameTarget=this.filenameTarget?t.find(this.filenameTarget).first():null;const{format:n,multiple:a}=this;e.on("input",vi((async()=>{this.updatedValue(await Li(e.files,n,a)),t.trigger(da,this.value)}),!1,!0)),e.files&&0!=e.files.length&&this.updatedValue(await Li(e.files,n,a)),t.trigger(da,this.value)}set readonly(t){this.input.attr("disabled",t?"":null)}acceptValue(t){return null==t||void 0===t||(this.multiple?t instanceof Array:"object"==typeof t)}normalizeValue(t){return null==t||void 0===t?null:this.multiple?0!=t.length?t:null:t}updatedValue(t){if(t!=Di(this)){Di(this,t),t||(this.input.value=null);const e=this.filenameTarget;if(e&&(e.empty(),t))if(this.multiple)for(let n of t)e.append(`<span>${n.name}</span>`);else e.append(`<span>${t.name}</span>`)}}get value(){return Di(this)}get valid(){return this.input.checkValidity()}},class extends bi{static findInput(t){return t.find("select").first()}constructor(t,e){super(t,e)}init(){const{field:t,input:e}=this;e.on("input, changed",vi((()=>{t.trigger(da,this.value)}),!1,!0,On))}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){return this.normalizeValue(this.input.multiple?this.input.val():this.input.value)}normalizeValue(t){return t?this.input.multiple?0!=(t=t.filter((t=>t&&t.trim().length>0))).length?t:null:0!=(t=t.trim()).length?t:null:null}acceptValue(t){return null==t||void 0===t||(this.input.multiple?t instanceof Array:"string"==typeof t)}updatedValue(t){const e=this.input.val();this.field.value!=this.value&&this.input.val(t||e)}}],Vi=["file-format"];class ki extends wi{static get observedAttributes(){return Vi.concat(wi.observedAttributes)}static get NODENAME(){return In}#b=!1;#_;constructor(t){super(t),this.on(da,(t=>{t.preventDefault(),t.stopPropagation(),this.publishValue(t.detail||null)}))}async init(){await super.init(),this.#b||(this.#b=!0,this.#_=(t=>{for(let e of $i){const n=e.findInput(t);if(n)return new e(t,n)}return null})(this),this.#_&&(this.addValidation((async()=>this.#_.valid)),this.publishValue(this.#_.value)))}readonlyUpdated(){this.#_&&(this.#_.readonly=this.readonly)}async acceptValue(t){return!!this.#_&&this.#_.acceptValue(t)}async normalizeValue(t){return this.#_?this.#_.normalizeValue(t):t}async updatedValue(t){await this.ready,t=await t;const e=this.#_;if(e){(e.value||null)!=t&&await e.updatedValue(t)}await super.updatedValue(t)}async validationStateChanged(t,e){if(t&&this.condition){const t=this.#_.value||null;gi(this,t)}return super.validationStateChanged(t,e)}}ot(ki);const Oi=[Ha,Ia];class Ci extends rt{static get observedAttributes(){return Oi}static get NODENAME(){return Gn}constructor(){super()}async init(){await super.init(),this.active=!1,this.ready.then((()=>this.trigger(ba)))}async destroy(){this.trigger(xa),await super.destroy()}get active(){return this.hasAttribute(Ha)}set active(t){t?this.attr(Ha,""):this.attr(Ha,void 0)}get condition(){return this.attr(Ia)}}ot(Ci);const Ri=({root:t,filter:e})=>{let n=[];return t.children.forEach((t=>{const{accept:a,stop:i=!1}=e(t);if(a&&n.push(t),!i){const a=Ri({root:t,filter:e});a instanceof Array?n=n.concat(a):a&&n.push(a)}})),n},Si=async(t,e)=>(await Promise.all(e.map((e=>e.validate(t))))).reduce(((t,e)=>!!t&&e),!0),Ii=[];class Hi extends wi{static get observedAttributes(){return Ii.concat(wi.observedAttributes)}static get NODENAME(){return Hn}#q=null;#F=new Map;constructor(t){super(t);const e=this.root;e.on(ma,(t=>{const e=t.target;e!=this&&(!(e instanceof wi)||this.#q&&this.#q.has(e)||(this.#q=null),t.stopPropagation())})),e.on(ya,(t=>{const e=t.target;e!=this&&(e instanceof wi&&this.#q&&this.#q.has(e)&&this.#q.delete(e),t.stopPropagation())})),this.addValidation((async({data:t})=>await Si(t,this.fields)))}get fields(){return this.#q||(this.#q=new Set(Ri({root:this,filter:t=>t instanceof wi?{accept:!0,stop:!0}:{accept:!1}}))),Array.from(this.#q)}readonlyUpdated(){const{readonly:t,fields:e}=this;if(e)for(let n of e)n.readonly=t}async updatedValue(t){await this.ready;const e=this.#F;e.clear();const n=this.fields;n&&await Promise.all(n.map((async n=>{const a=n.name?si(t,n.name):t;ni(a)||e.set(n,a),await n.value(a)})));let a=await ii(this.#F,n);return 0==Object.getOwnPropertyNames(a).length&&(a=null),a}async childValueChanged(t,e){e=await e;const n=this.#F;if(t){const a=n.has(t),i=null==n.get(t);if(a&&i==e)return;ni(e)?n.delete(t):n.set(t,e)}let a=await ii(n,this.fields);0==Object.getOwnPropertyNames(a).length&&(a=null),await this.publishValue(a)}}ot(Hi);const ji=Hi,zi=[Ha,ja];const Ui=class extends rt{static get observedAttributes(){return zi}#b=!1;#K;constructor(){super(),this.on("click",(t=>{t.preventDefault(),t.stopPropagation(),this.active&&!this.disabled&&this.execute()}))}async init(){await super.init(),this.#b&&(this.active=!1,this.disabled=!1,this.#b=!0)}get form(){return this.#K||(this.#K=this.parent(Cn)),this.#K}get active(){return this.hasAttribute(Ha)}set active(t){this.attr(Ha,t?"":null)}get disabled(){return this.hasAttribute(ja)}set disabled(t){this.attr(ja,t?"":null)}execute(){console.log("execute")}},_i=[];class qi extends Ui{static get observedAttributes(){return _i.concat(_i)}static get NODENAME(){return qn}constructor(){super()}async init(){await super.init(),this.active=!0}execute(){this.trigger(fa)}}ot(qi);const Fi=[];class Ki extends ji{static get observedAttributes(){return Fi.concat(ji.observedAttributes)}static get NODENAME(){return Un}constructor(t){super(t)}get active(){return!0}set active(t){}get condition(){return!0}get name(){return null}}customElements.define(Ki.NODENAME,Ki);const Gi=`${_n}:initialized`,Xi=[];class Bi extends Ui{static get observedAttributes(){return Xi.concat(Xi)}static get NODENAME(){return _n}constructor(){super(),this.ready.then((()=>this.trigger(Gi)))}async init(){await super.init(),this.active=!0}execute(){this.trigger(pa)}}ot(Bi);const Wi=[];class Ji extends rt{static get observedAttributes(){return Wi}static get NODENAME(){return zn}constructor(){super()}}ot(Ji);const Zi=[Wa,Ja],Qi=async(t,e)=>{let n=[];for(let a of t)n.push(e.get(a));return 0==n.length&&(n=null),n};class Yi extends wi{static get observedAttributes(){return Zi.concat(wi.observedAttributes)}static get NODENAME(){return jn}#D;#G;#X=new Map;#B;#b=!1;constructor(t){super(t);const e=this.root;e.on(Gi,(t=>{this.#B=t.target,t.stopPropagation()})),e.on(ma,(t=>{t.target!=this&&(t.preventDefault(),t.stopPropagation())})),e.on(pa,(t=>{t.preventDefault(),t.stopPropagation();const{readonly:e}=this;e||this.createRow()})),e.on(fa,(t=>{t.preventDefault(),t.stopPropagation();const{rows:e,readonly:n}=this;if(!n){const n=t.target.parent(Un);e.indexOf(n)>=0&&n.remove()}})),this.addValidation((async()=>{const{rows:t,min:e,max:n,readonly:a}=this,i=t.length;return this.#B&&!a&&(i==n?this.#B.disabled=!0:i<n&&(this.#B.disabled=!1)),e<=i&&i<=n})),this.addValidation((async t=>await Si(t,this.rows)))}async init(){if(await super.init(),!this.#b){this.#b=!0;const t=this.find("template").first();t&&(this.#D=t.content),this.#G=this.find(zn).first()}}readonlyUpdated(){const{readonly:t}=this;for(let e of this.rows)e.readonly=t}get rows(){return this.#G?Array.from(this.#G.children):[]}get min(){return this.hasAttribute(Wa)?Math.max(0,parseInt(this.attr(Wa))):0}get max(){return this.hasAttribute(Ja)?parseInt(this.attr(Ja)):Number.MAX_SAFE_INTEGER}acceptValue(t){return!t||t instanceof Array}normalizeValue(t){return t?t.filter((t=>!!t)):null}async createRow(t){const e=document.importNode(this.#D,!0).children[0];return await this.#G.append(e),t&&await e.value(t),e}async updatedValue(t){return this.#X.clear(),this.#G.empty(),t&&await Promise.all(t.map((t=>this.createRow(t)))),await Qi(this.rows,this.#X)}async childValueChanged(t,e){e=await e;const n=this.#X;ni(e)?this.#X.delete(t):this.#X.set(t,e),await super.childValueChanged(t,e);const a=await Qi(this.rows,n);await this.publishValue(a)}}ot(Yi);const tr=[Oa];class er extends ji{static get observedAttributes(){return tr.concat(ji.observedAttributes)}static get NODENAME(){return Sn}constructor(t){super(t),this.ready.then((()=>this.trigger(wa)))}async destroy(){this.trigger(va),await super.destroy()}get step(){return this.attr(Oa)}conditionUpdated(){}}ot(er);const nr="active",ar="condition",ir=[nr,ar];class rr extends rt{static get observedAttributes(){return ir}static get NODENAME(){return Xn}constructor(){super()}async init(){await super.init(),this.trigger(Ea)}async destroy(){this.trigger(Aa),await super.destroy()}get active(){return this.hasAttribute(nr)}set active(t){t?this.attr(nr,""):this.attr(nr,void 0)}get condition(){return this.attr(ar)}async update(t){await this.ready,this.active=await Vt.resolve(this.condition,t,!1)}}ot(rr);const sr=[];class or extends Ui{static get observedAttributes(){return sr}static get NODENAME(){return Wn}constructor(){super()}execute(){this.form.toPrevPage()}}ot(or);const lr=[];class cr extends Ui{static get observedAttributes(){return lr}static get NODENAME(){return Jn}constructor(){super()}execute(){this.form.toNextPage()}}ot(cr);const ur=[];class hr extends Ui{static get observedAttributes(){return ur}static get NODENAME(){return Zn}constructor(){super()}execute(){this.form.toNextPage()}}ot(hr);const dr=[];class pr extends Ui{static get observedAttributes(){return dr}static get NODENAME(){return Qn}constructor(){super()}execute(){this.form.submit()}}ot(pr);const fr={active:!0,disabled:!0},gr=[];class mr extends rt{static get observedAttributes(){return gr}static get NODENAME(){return Bn}#K;#W;#J;#Z;#Q;#b=!1;constructor(){super()}async init(){await super.init(),this.#b||(this.#K=this.parent(Cn),this.#W=this.find(Wn).first()||fr,this.#J=this.find(Jn).first()||fr,this.#Z=this.find(Zn).first()||fr,this.#Q=this.find(Qn).first()||fr,this.#K.on([ra,ha,ua],(()=>{this.update()})),this.#b=!0)}async update(){const t=this.#K,e=t.state,n=this.#W,a=this.#J,i=this.#Z,r=this.#Q;if(n.active=!0,n.disabled=!0,a.active=!1,a.disabled=!0,i.active=!1,i.disabled=!0,r.active=!1,r.disabled=!0,e==ta)return;const{activePageIndex:s,activePage:o,nextPage:l,pages:c,useSummaryPage:u}=t,h=null!=await l;e==aa?(n.disabled=!0,r.active=!0):e==na?(n.disabled=!1,r.active=!0,r.disabled=!t.valid):e==ea&&(n.disabled=s<=0,h||!o.valid&&s+1<c.length?(a.active=!0,a.disabled=!o.valid):u&&e==ea?(i.active=!0,i.disabled=!o.valid):(r.active=!0,r.disabled=!t.valid))}}ot(mr);const yr=[La,Ha,_a];class wr extends rt{static get observedAttributes(){return yr}static get NODENAME(){return Kn}constructor(){super()}get name(){return this.attr(La)}get active(){return this.hasAttribute(Ha)}set active(t){this.active!=t&&ci(this,t)}get readonly(){return this.hasAttribute(_a)}set readonly(t){t?this.attr(_a,""):this.attr(_a,null)}}ot(wr);const vr=[Za];class br extends rt{static get observedAttributes(){return vr}static get NODENAME(){return Fn}#K;#Y;#b=!1;constructor(){super(),this.on("click",(({target:t})=>{if(!this.#K)return;if(t==this)return;const e=t.is(Kn)?t:t.parent(Kn),n=this.#K;if(!e)return;const{state:a,pages:i,activePage:r}=n,s=e.name;if(a==ea||a==na){const t=((t,e,n)=>{for(let a of t){if(a.step==e&&a.condition)return a;if(a==n)return}return null})(i,s,r);t&&(n.activePage=t)}}))}async init(){if(await super.init(),this.progress=0,!this.#b){const t=this.#K=this.parent(Cn);this.#Y=this.find(Kn),this.#K.on([ua,ha],(()=>{const e=t.state;if(ta==e)return;const{activePageIndex:n,activePage:a,pages:i}=t;if(!a)return;const r=i.length,s=a?a.step:Yn,o=Math.floor(100*n/r);for(let t of this.steps){const n=t.name;e==ea?(t.active=n==s,t.readonly=!1):e==na?(t.active=n==na,t.readonly=!1):(t.active=n==aa,t.readonly=!0)}this.progress=e==na||e==aa?100:o,this.trigger(ga)})),this.#b=!0}}get steps(){return Array.from(this.#Y)}get progress(){return this.attr(Za)}set progress(t){this.style.setProperty&&this.style.setProperty("--progress",t+"%"),this.attr(Za,Math.max(0,Math.min(t,100)))}}ot(br);const xr="success",Er="fail";const Ar=class{static get STATE_SUCCESS(){return xr}static get STATE_FAIL(){return Er}constructor(t,e,n,a){this.action=t,this.state=e,this.message=n,this.data=a}},Nr=pt("form");const Tr=class extends rt{constructor(){super()}async init(){await super.init();const t=this.parent(Cn);Nr(this,t),t&&this.trigger(sa)}get form(){return Nr(this)}async accept(t={}){const e=this.attr(Ia);return!e||await Vt.resolve(e,t,!1)}async execute(t={}){return new Ar(Er,"not implemented")}},Dr=`${Rn}-default`;class Mr extends Tr{static get NODENAME(){return Dr}constructor(t,e){super(),this.endpoint=t,this.method=e}async execute(t){let e=this.endpoint;e=await ExpressionResolver.resolveText(e,t,e);const n=new URL(e,location),a=await fetch(n,{method:this.method,credentials:"include",mode:"cors",headers:{"content-type":"application/json"},body:JSON.stringify(t)});return new Ar(this,a.ok?xr:Er,a)}}ot(Mr);const Pr=Mr,Lr=pt("submitAction"),$r=[La,Ca,$a,Va,ka,Ra],Vr=(t,e)=>{for(let n of t.pages)n.readonly=e,n.active=e};class kr extends rt{static get observedAttributes(){return $r}static get NODENAME(){return Cn}#b=!1;#tt=Yn;#et;#F=new Map;#nt={};#at=null;#it=!1;constructor(){super();const t=this.root;t.on(wa,(t=>{t.preventDefault(),t.stopPropagation()})),t.on(va,(t=>{const e=t.target;this.#et=null,this.childValueChanged(e,null),t.preventDefault(),t.stopPropagation()})),this.ready.then((()=>this.trigger(ra)))}async init(){await super.init(),this.#b||(this.#b=!0,this.activePageIndex=-1,this.state=Yn,this.useSummaryPage=this.hasAttribute(Ca),this.activePageIndex=-1,this.pages.length>0&&this.toNextPage())}get pages(){return this.#et||(this.#et=Array.from(this.root.find(Sn))),this.#et}get state(){return this.#tt}set state(t){const e=this.#tt;t!=ta&&(e==ea&&t!=ea?Vr(this,!0):e!=ea&&t==ea&&(Vr(this,!1),this.activePage&&(this.activePage.active=!0))),this.#tt=t,e!=t&&this.trigger(ha),this.attr(ka,t)}get valid(){for(let t of this.pages)if(t.condition&&!t.valid)return!1;return!0}async value(t){return await this.ready,this.#at&&await this.#at,0==arguments.length?this.#nt:this.state!=ea?new Promise((e=>{const n=a=>{a.stopPropagation(),this.removeOn(n,ha),e(this.value(t))};this.on(ha,n)})):(await Promise.all(this.pages.map((e=>{const n=e.name;return n?e.value(si(t,n)):e.value(t)}))),void await this.#rt())}get activePage(){return 0<=this.activePageIndex&&this.activePageIndex<this.pages.length?this.pages[this.activePageIndex]:null}set activePage(t){const e=this.activePage;t==e&&this.state==ea||(e&&(e.active=!1),this.activePageIndex=this.pages.indexOf(t),t.active=!0,this.state!=ea&&(this.state=ea),this.scrollIntoView(),this.trigger(ua))}get prevPage(){return(async()=>{const t=this.pages,e=this.activePageIndex-1,n=await this.value();for(let a=e;a>=0;a--){const e=t[a];if(await e.validate(n),e.condition)return e}return null})()}get nextPage(){return(async()=>{const t=this.pages,e=this.activePageIndex+1,n=await this.value();if(t)for(let a=e;a<t.length;a++){const e=t[a];if(await e.validate(n),e.condition)return e}return null})()}async toPrevPage(){if(this.state!=ea)this.state=ea;else{const t=await this.prevPage;t&&(this.activePage=t)}}async toNextPage(){const t=await this.nextPage;t?(this.activePage=t,this.state=ea):this.useSummaryPage?this.summary():this.submit()}async summary(){this.state=na}get submitActions(){let t=Lr(this);if(!t){t=[];let e=this.attr($a);if(e){const t=this.attr(Va)||"post";this.append(new Pr(e,t))}const n=this.children;for(let e of n)e instanceof Tr&&t.push(e);Lr(this,t)}return t}async submit(){const t=await this.value();if(!await Si(t,this.pages))return;this.hasAttribute(Ra)||(this.state=aa);const e=this.submitActions;if(e){const n=await(async(t,e)=>{const n=[];for(let a of t)if(await a.accept(e))try{const t=await a.execute(e)||new Ar(a,xr);if(n.push(t),t.state==Er)return n}catch(t){return n.push(new Ar(a,Er,t)),n}return n})(e,t);this.trigger(la,n)}this.trigger(oa,t)}#rt(t){if(this.state==ea)return this.state=ta,this.#at=new Promise((e=>{setTimeout((async()=>{const n=this.#nt,a=t?t.validate(n):await Si(n,this.pages);this.#it||(this.state=ea),this.validation=null,e(a)}),10)}));this.state==ta&&this.#at.then((async()=>{this.#it=!1,await this.#rt(t)}))}async childValueChanged(t,e){await this.ready,e=await e;const n=this.#F;t&&(ni(e)?n.delete(t):n.set(t,e)),this.#nt=await ii(this.#F,this.pages);const a=this.activePage;a?await this.#rt(a):await this.#rt()}}ot(kr);const Or=`${u}/html-team-element`,Cr=St.load(new URL(`${Or}/root.tpl.html`,location)),Rr=St.load(new URL(`${Or}/editor.tpl.html`,location));class Sr extends rt{static get NODENAME(){return"x-team"}#b=!1;#st=!1;constructor(){super();const t=this.root;t.on("action:toogle-details",(t=>{t.stopPropagation();const{target:e}=t;e instanceof HTMLDetailsElement&&(this.#st=e.open)})),t.on("action:delete-team",(t=>{t.stopPropagation(),(async()=>{const t=this.teamId;await(async t=>{await En(`${Pn}/${t}`),Ln.delete(t)})(t),this.trigger("info:team-deleted",t),this.remove()})()})),t.on("action:edit-team",(t=>{t.stopPropagation(),this.editorDialog()}))}async init(){await super.init(),this.#b||(await this.render(),this.#b=!0)}get teamId(){return parseInt(this.attr("team-id"))}get campaignId(){return parseInt(this.attr("campaign-id"))}async render(){const t=await Cr;await We.render({template:t,container:this.root,data:{accessRights:v(),open:this.#st,team:await $n(this.teamId)}})}async editorDialog(){const{root:t,teamId:e}=this,n=await $n(e),a=await Rr,i=document.createElement("div");await We.render({container:i,template:a,data:{team:n}}),t.append(i.innerHTML);const r=t.find(":scope > dialog").last();r.on("d-form-submit",(t=>{t.stopPropagation();const e=t.target;(async()=>{const t=await e.value();await Vn(t),r.close(),r.remove(),this.render()})()})),r.on("close",(t=>{t.stopPropagation(),r.remove()}));const s=r.find("d-form").first();await s.ready,await s.value(n),r.showModal()}}ot(Sr);const Ir="/api/campaigns",Hr=new Map,jr=async()=>{let t=null;if(0==Hr.size){t=await bn(Ir);for(const e of t)Hr.set(e.id,e)}else{t=[];for(const[e,n]of Hr)t.push(n)}return console.log({campaigns:t}),t},zr=async t=>{if(Hr.has(t))return Hr.get(t);const e=await bn(`${Ir}/${t}`);return Hr.set(e.id,e),console.log({campaign:e}),e},Ur=async t=>(t=await xn(`${Ir}`,t),Hr.set(t.id,t),console.log({campaign:t}),t),_r=`${u}/html-campaigns-element`,qr=new URL(`${_r}/root.tpl.html`,location),Fr=new URL(`${_r}/campaign-dialog.tpl.html`,location);class Kr extends rt{static get NODENAME(){return"x-campaigns"}#b=!1;#ot;constructor(){super();const t=this.root;t.on(h,(t=>{t.stopPropagation(),this.render()})),t.on("action:create-campaign",(t=>{t.stopPropagation(),this.openCreateDialog()})),t.on("action:close-campaign-dialog",(t=>{t.stopPropagation(),this.#ot&&this.#ot.close()}))}async init(){await super.init(),this.#b||(await this.render(),this.#b=!0)}async render(){const t=await St.load(qr);await We.render({container:this.root,template:t,data:{accessRights:v(),campaigns:await jr()}})}async openCreateDialog(){const t=this.root;if(!this.#ot){const e=await St.load(Fr),n=await We.render({template:e,container:t,data:{accessRights:v()},mode:"append"});this.#ot=n.content[0],this.#ot.on("d-form-submit",(t=>{t.preventDefault(),t.stopPropagation();const e=t.target;(async()=>{const t=await e.value();await Ur(t),this.#ot.close(),await this.render()})()}))}this.#ot.showModal()}}ot(Kr);const Gr=t=>`/api/campaigns/${t}/registrations`,Xr=new Map,Br=t=>Xr.get(t),Wr=t=>{if(!t)return;const{campaignid:e,memberid:n}=t;(Xr.has(e)||Xr.set(e,new Map),Xr.get(e)).set(n,t)},Jr=async t=>{if(Xr.has(t))return Array.from(Br(t).values());const e=await bn(Gr(t));for(const t of e)Wr(t);return e},Zr=async t=>Qr(t,d.id),Qr=async(t,e)=>{let n=((t,e)=>{const n=Br(t);return n?n.get(e):null})(t,e);return n||(n=await bn(((t,e)=>`${Gr(t)}/${e}`)(t,e)),Wr(n)),n},Yr=`${u}/html-campaign-element`,ts=St.load(new URL(`${Yr}/root.tpl.html`,location)),es=St.load(new URL(`${Yr}/registration.tpl.html`,location)),ns=St.load(new URL(`${Yr}/registrations.tpl.html`,location)),as=(t,e)=>{t=t instanceof Date?t:new Date(t),e=e instanceof Date?e:new Date(e);const n=Math.ceil(Math.abs(t-e)/864e5),a=[];for(let e=0;e<n;e++)a.push(t.addDays(e));return a};class is extends rt{static get NODENAME(){return"x-campaign"}#b=!1;#st=!1;constructor(){super();const t=this.root;t.on(h,(t=>{t.stopPropagation(),this.render()})),t.on("action:toogle-details",(t=>{t.stopPropagation();const{target:e}=t;e instanceof HTMLDetailsElement&&(this.#st=e.open)})),t.on("action:show-registrations",(t=>{t.stopPropagation(),this.showRegistrations()})),t.on("action:delete-campaign",(t=>{t.stopPropagation(),(async()=>{await(async t=>{await En(`${Ir}/${t}`),Hr.delete(t)})(this.campaignId),this.remove()})()})),t.on("action:create-team",(t=>{t.stopPropagation(),(async()=>{const t=this.campaignId,e=await Vn({name:"neues Team",campaignid:t}),n=await zr(t);n.payload=n.payload||{},n.payload.teams=n.payload.teams||[];n.payload.teams.push(e.id),await Ur(n),this.render()})()})),t.on("info:team-deleted",(t=>{t.stopPropagation();const e=t.detail;(async()=>{const t=await zr(this.campaignId),n=t.payload.teams;n.splice(n.indexOf(e),1),await Ur(t)})()})),t.on("action:member-registrate",(t=>{t.stopPropagation(),this.openRegistrationDialog()}))}async init(){await super.init(),this.#b||(await this.render(),this.#b=!0)}get campaignId(){return parseInt(this.attr("campaign-id"))}async render(){const t=await ts;await We.render({container:this.root,template:t,data:{accessRights:v(),open:this.#st,campaign:await zr(this.campaignId)}})}async openRegistrationDialog(){const t=await es,e=await zr(this.campaignId),n={campaign:e,days:as(e.startdate,e.enddate)},a=(await We.render({template:t,container:this.root,data:n,mode:"append"})).content[0],i=a.find("d-form").first();i.on("d-form-submit",(t=>{console.log(t),t.stopPropagation(),(async()=>{const t=await i.value(),e=[];let n=!0;for(const a in t)n&&"full"!=t[a].available&&(n=!1),e.push(t[a]);await(async(t,e)=>(e=await xn(Gr(t),e),Wr(e),e))(this.campaignId,{fullyavailable:n,availability:e}),a.hide(),a.remove()})()})),i.on("action:close-registration-dialog",(t=>{t.stopPropagation(),a.hide(),a.remove()}));const r=await Zr(this.campaignId);if(r){const t=r.availability||[],e={};for(let n=0;n<t.length;n++)e[`day${n+1}`]=t[n];await i.value(e)}a.showModal()}async showRegistrations(){const t=await ns,e=await Jr(this.campaignId),n=(await We.render({container:this,template:t,data:{registrations:e},mode:"append"})).content[0];n.on("close",(()=>{n.remove()})),n.showModal()}}ot(is);const rs=`${u}/html-campaign-member-element`,ss=St.load(new URL(`${rs}/root.tpl.html`,location));class os extends rt{static get NODENAME(){return"x-campaign-member"}#b=!1;constructor(){super()}async init(){await super.init(),this.#b||(this.#b=!0,this.render())}async render(){const t=await ss,e=await this.getRegistration();await We.render({container:this.root,template:t,data:{registration:e}})}get campaignid(){return parseInt(this.attr("campaign-id"))}get memberid(){return parseInt(this.attr("member-id"))}async getRegistration(){const{campaignid:t,memberid:e}=this;return await Qr(t,e)}}ot(os);const ls=`${u}/html-campaign-member-search-field-element`,cs=St.load(new URL(`${ls}/root.tpl.html`,location)),us=St.load(new URL(`${ls}/dialog.tpl.html`,location));class hs extends wi{static get NODENAME(){return"x-campaign-member-search-field"}#b=!1;#lt=null;#ct=null;constructor(){super();const t=this.root;t.on("action:show-selection-dialog",(t=>{t.stopPropagation(),this.readonly||this.showSelectionDialog()})),t.on("action:save-selection",(t=>{t.stopPropagation(),this.readonly||(async()=>{const t=this.#ct.find(".is-selected x-campaign-member"),e=await Promise.all(t.map((async t=>(await t.getRegistration()).memberid)));await this.publishValue(e),await this.render(),this.#ct.close(),this.#ct.remove(),this.#ct=null})()}))}async init(){await super.init(),this.#b||(this.#lt=await Jr(this.campaignid),this.render())}async showSelectionDialog(){if(!this.#ct){const{root:t}=this,e=await us,n=await(async()=>{const t=new Set,e=await this.value();if(e)for(const n of e)t.add(n);return t})();await We.render({template:e,container:t,data:{registrations:this.#lt,memberids:n,campaignid:this.campaignid},mode:"append"}),this.#ct=t.find(":scope > dialog").first()}this.#ct.showModal()}async render(t){t=t||await this.value();const e=await cs;We.render({template:e,container:this.root,data:{memberids:t||[],campaignid:this.campaignid}})}get campaignid(){return parseInt(this.attr("campaign-id"))}async acceptValue(t){return t instanceof Array||null==t}async readonlyUpdated(){}async updatedValue(t){this.#ct&&this.#ct.remove(),await this.render(t)}}ot(hs);(t=>{const e=(t=new Date)=>{const e=t.getFullYear(),n=t.getMonth();return{date:t=t.getDate(),month:n,year:e,test:1e4*e+100*n+t}},n=(t,n)=>(t=e(t instanceof Date?t:Date.parse(t)),n=e(n instanceof Date?n:Date.parse(n)),t.test>=n.test);t.formUtils=t.formUtils||{date:{greaterEqual:n,greaterEqualNow:t=>n(t,new Date),greater:(t,n)=>(t=e(t instanceof Date?t:Date.parse(t)),n=e(n instanceof Date?n:Date.parse(n)),t.test>n.test)}}})(window),(t=>{const e=new Intl.DateTimeFormat("default",{weekday:"long",month:"long",day:"numeric"});t.DateFormats=t.DateFormats||{toDate:(t=new Date)=>e.format(t)}})(window);document.body.on("action:management:sync-all-data",(async t=>{console.log({event:t}),await fetch("/api/management/sync-data",location)}))})()})();
//# sourceMappingURL=index.f4dcf60ddc3a2f0d214c.min.js.map